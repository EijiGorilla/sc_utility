"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[9290],{25810:(e,t,n)=>{n.d(t,{Z:()=>h});var i=n(27366),a=(n(59486),n(48805)),s=n(11582),o=n(17768),r=n(46784),l=n(49861),d=n(89125),c=(n(84936),n(93169),n(69912)),u=n(25243),p=n(848);let m=class extends((0,r.eC)(s.j)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=a.n.Direct,this.offset=0,this.orientation=0}};(0,i._)([(0,l.Cb)({type:["length"],json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,i._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],m.prototype,"startPoint",void 0),(0,i._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],m.prototype,"endPoint",void 0),(0,i._)([(0,l.Cb)({type:a.V,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"measureType",void 0),(0,i._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"offset",void 0),(0,i._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,d.p)((e=>o.BV.normalize((0,u.q9)(e),0,!0)))],m.prototype,"orientation",void 0),m=(0,i._)([(0,c.j)("esri.analysis.LengthDimension")],m);const h=m},48805:(e,t,n)=>{var i;n.d(t,{V:()=>a,n:()=>i}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));const a=[i.Horizontal,i.Vertical,i.Direct]},89290:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ft});var i,a=n(27366),s=n(7138),o=n(42537),r=(n(93169),n(32718)),l=n(92026),d=n(94172),c=n(49861),u=(n(84936),n(69912)),p=n(98074),m=n(48805),h=n(68860),g=n(74177),f=n(16889),_=n(47898),v=n(29134),y=n(7025),S=n(32035),M=n(12400),w=n(14320),C=n(51378),b=n(55946),P=n(37818),D=n(9052),T=n(59418),O=n(4914),A=n(47072);function H(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:a,orientation:s}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i,measureType:a,orientation:s}}function R(e,t){let{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,offset:a,measureType:s,orientation:o}=e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==n||null==i)return null;const l=k(r?.directSegment??new D.y,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i},t),d=r?.primaryOffsetAxis??(0,M.Ue)();E(d,{measureType:s,elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,orientation:o,renderCoordsHelper:t});const c=r?.dimensionSegment??new D.y;return L({elevationAlignedStartPoint:n,elevationAlignedEndPoint:i})&&s===m.n.Vertical?((0,S.c)(c.startRenderSpace,l.startRenderSpace),(0,S.c)(c.endRenderSpace,l.endRenderSpace)):Z(c,{offsetAxis:d,offset:a,relativeToSegment:l,renderCoordsHelper:t}),{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,dimensionSegment:c,primaryOffsetAxis:d,spatialReference:t.spatialReference}}function x(e,t,n,a){return t===i.Start?((0,S.c)(e.startRenderSpace,n.startRenderSpace),(0,S.c)(e.endRenderSpace,a.startRenderSpace)):((0,S.c)(e.startRenderSpace,n.endRenderSpace),(0,S.c)(e.endRenderSpace,a.endRenderSpace)),e}function z(e,t,n,i){switch(t){case m.n.Direct:return k(e,n,i);case m.n.Horizontal:case m.n.Vertical:{const{elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,dimension:o,geometry:r}=n;let l;o.measureType===m.n.Direct?(l=function(e,t){const n=e.directSegment.eval(.5,C.WM.get()),i=t.worldUpAtPosition(n,C.WM.get()),a=e.dimensionSegment.eval(.5,C.WM.get()),s=(0,S.a)(C.WM.get(),a,n);return!(0,S.H)(s,M.AG)&&(0,S.f)(s,i)>0}(r,i)===a.z>s.z,t===m.n.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:i,endRenderSpace:a}=e.directSegment;return(0,S.y)(i,t)<(0,S.y)(a,n)}(r);const[d,c]=l?[a,s]:[s,a],u=(0,P.WG)(c,V);return t===m.n.Horizontal?u.z=d.z:(u.x=d.x,u.y=d.y),i.toRenderCoords(d,e.startRenderSpace),i.toRenderCoords(u,e.endRenderSpace),e}}}function k(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(i||(i={}));const V=(0,b.T)(0,0,0,null);const G=new D.y;function E(e,t){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:a,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:r,renderCoordsHelper:l}=t,d=r.eval(.5,C.WM.get()),c=l.worldUpAtPosition(d,C.WM.get()),u=l.worldBasisAtPosition(d,w.R.Y,C.WM.get());switch(n){case m.n.Horizontal:(0,S.c)(e,c);break;case m.n.Vertical:(0,S.f)(s,c)<(0,S.f)(o,c)?(0,S.a)(e,o,s):(0,S.a)(e,s,o),(0,S.e)(e,e,c),(0,S.e)(e,e,c);break;case m.n.Direct:{const n=t.orientation??0;if(L({elevationAlignedStartPoint:i,elevationAlignedEndPoint:a}))(0,v.Us)(U,-(0,f.Vl)(n),c),(0,S.t)(e,u,U);else{const t=(0,S.a)(C.WM.get(),o,s),i=(0,S.e)(C.WM.get(),t,c);(0,S.e)(i,i,t),(0,v.Us)(U,(0,f.Vl)(n),t),(0,S.t)(e,i,U)}break}}return(0,S.H)(e,M.AG)?(0,S.c)(e,u):(0,S.n)(e,e)}const U=(0,y.Ue)();function L(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;return null!=t&&null!=n&&t.x===n.x&&t.y===n.y}function Z(e,t){const{offsetAxis:n,offset:i,relativeToSegment:{startRenderSpace:a,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:r}=t,l=i/r.unitInMeters,[d,c]=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=(0,S.f)(t,n),s=(0,S.f)(e,n),o=Math.abs(a-s)+i;return a>s?[o,i]:[i,o]}(a,s,n,l);return(0,S.b)(e.startRenderSpace,o.startRenderSpace,n,d),(0,S.b)(e.endRenderSpace,o.endRenderSpace,n,c),e}function j(e,t,n){const i=t.directSegment.eval(.5,C.WM.get());return n.worldUpAtPosition(i,e)}function I(e,t){const{startRenderSpace:n,endRenderSpace:i}=t.directSegment;return(0,S.a)(e,i,n)}function W(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:i,endRenderSpace:a}=t.dimensionSegment;return n.invert?(0,S.a)(e,i,a):(0,S.a)(e,a,i)}function Y(e,t){const n=e.directSegment.eval(.5,C.WM.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}const F=(0,M.Ue)();function X(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;if(null==t||null==n)return!1;const i=(0,O.Z1)(t,n);return null!=i&&(0,_.nn)(i,"meters").value>A.Yo}function B(e){return null!=e.geometry}let N=class extends s.Z{constructor(e){super(e)}initialize(){const e=(0,d.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._watchComputation(t)}));this.addHandles((0,o.ed)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.R)(this.view)}_watchComputation(e){return(0,d.YP)((()=>H(e)),(t=>{const{measureType:n}=t;if(X(t)&&n!==m.n.Direct){const t=Math.round((0,h.En)(A.Yo,"meters","kilometers"));return r.Z.getLogger(this).warnOnce(`A ${n} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const i=R(t,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=function(e,t,n){if(null==e)return null;let i;if(t===m.n.Horizontal)i=(0,T.Qw)(e.elevationAlignedStartPoint,e.elevationAlignedEndPoint);else{const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment;i=(0,O.FN)(t,n,e.spatialReference)}if(null==i)return null;const a=t===m.n.Vertical?(0,h.yv)(i.value,i.unit,n):(0,h.wd)(i.value,i.unit,n);return(0,_.nn)(i,a)}(i,n,this._defaultUnit)}),d.tX)}};(0,a._)([(0,c.Cb)({constructOnly:!0})],N.prototype,"analysisViewData",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],N.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],N.prototype,"analysis",null),(0,a._)([(0,c.Cb)()],N.prototype,"_defaultUnit",null),N=(0,a._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionController")],N);n(59486);var q=n(84702),Q=n(51995),J=n(17768),K=n(17842),$=n(86361),ee=n(55652),te=n(86950);function ne(e){return(0,te.G)(e.accentColor,.5)}const ie=new Q.Z([127,127,127,.5]),ae=6,se=5;var oe=n(35284),re=n(83639),le=n(40508),de=n(51328),ce=n(2522),ue=n(91526),pe=n(2952),me=n(70619),he=n(56529),ge=n(4760),fe=n(8080),_e=n(58901),ve=n(74229),ye=n(99034),Se=n(848);class Me{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of m.V)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case m.n.Direct:return this.direct;case m.n.Horizontal:return this.horizontal;case m.n.Vertical:return this.vertical}}}class we extends oe.Z{constructor(e,t){const n=(0,re.EA)(Q.Z.toUnitRGBA(ne(e.effectiveTheme))),i=[new le.r((0,me.PI)(n,1,32,32),Le)];super({view:e,renderObjects:i,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,d.YP)((()=>({color:Q.Z.toUnitRGBA(ne(e.effectiveTheme))})),(e=>n.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class Ce extends oe.Z{constructor(e,t){let{lineSizePt:n,material:i,metadata:a}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:a}),this._options={calloutColor:(0,$.Ue)(),lineSizePt:n,material:i},this._themeHandle=(0,d.YP)((()=>Q.Z.toUnitRGBA(ne(e.effectiveTheme))),(e=>{this._options.calloutColor=e,Ue(this,be({...this._options,metadata:this.metadata}))}),d.nn)}update(e){let{lineSizePt:t,material:n}=e;this._options.lineSizePt=t,this._options.material=n,Ue(this,be({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function be(e){let{calloutColor:t,lineSizePt:n,material:i,metadata:a}=e;return{calloutLength:.25*ce.M_*.8*(0,K.F2)(n)+18,calloutColor:t,calloutWidth:2,customStateMask:Le,discScale:.3,focusMultiplier:2,material:i,metadata:a}}function Pe(e,t){let{computation:n,view:i}=t;return[(0,ve.Xd)(e,((e,t,a)=>{De({cancel:a,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,n){const{dimension:i,geometry:a}=t;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==a)return;const{renderCoordsHelper:s}=n,o=R({...H(t),orientation:90},s),r=R({...H(t),orientation:270},s);if(null==o||null==r)return;const l=Y(o,s),d=Y(r,s),c=Ae(a,n),u=J.BV.shortestSignedDiff(c,l),p=J.BV.shortestSignedDiff(c,d);i.orientation=Math.abs(u)<Math.abs(p)?90:270,e.stopPropagation()}(e,n,i)}))]}function De(e){const{cancel:t,computation:n,settingHeading:i,steps:a,view:s}=e;if(!B(n))return;const{renderCoordsHelper:o}=s,{dimension:r,geometry:l}=n,d=(0,M.Ue)(),c=ze((0,M.Ue)(),l,l.directSegment,o),u=ke(C.WM.get(),{forHeading:i,geometry:l,renderCoordsHelper:o}),p=(0,ee.Yq)(c,u,(0,ee.Ue)()),m=i?r.orientation??Y(l,s.renderCoordsHelper):r.orientation??0;a.next((0,de._N)(s,p)).next((e=>{"start"===e.action&&(0,S.c)(d,e.renderStart);const t=(0,ee.st)(p),n=(0,re.Gd)(d,e.renderEnd,c,t);let a=m-(0,f.BV)(n);i||(a=function(e){const t=J.BV.normalize(e)%90;return t<se?e-t:90-t<se?e+(90-t):e}(a)),r.orientation=a})),t.next((0,ve.di)(r,["orientation"]))}function Te(e,t){let{computation:n,manipulatorMeasureType:i,view:a}=t,s=m.n.Direct,o=0,r=0;return[e.events.on("grab-changed",(t=>{if("start"!==t.action||!B(n))return;const{dimension:l,geometry:d}=n;s=l.measureType,o=l.offset,r=l.orientation;const c=(0,S.c)(C.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){const{directSegment:a}=n,s=E(C.WM.get(),{measureType:t,directSegment:a,renderCoordsHelper:i}),o=Z(G,{offsetAxis:s,offset:0,relativeToSegment:a,renderCoordsHelper:i}).eval(.5,C.WM.get()),r=(0,S.a)(C.WM.get(),e,o);return(0,S.f)(r,s)*i.unitInMeters}(c,i,d,a.renderCoordsHelper),l.orientation=0})),(0,ve.Xd)(e,((e,t,l)=>{if(!B(n))return;const{geometry:d,dimension:c}=n,{renderCoordsHelper:u}=a,p=z(We,i,n,u),m=E(C.WM.get(),{measureType:i,directSegment:d.directSegment,renderCoordsHelper:u}),h=(0,de.J4)(e);t.next(h).next(Oe(a,c,p,m)),l.next(h).next((e=>(c.measureType=s,c.offset=o,c.orientation=r,e)))}))]}function Oe(e,t,n,i){const a=(0,S.d)(C.WM.get(),n.endRenderSpace,n.startRenderSpace);(0,S.e)(a,a,i);const s=(0,ee.Yq)(n.startRenderSpace,a,(0,ee.Ue)()),o=(0,ee.Yq)(n.startRenderSpace,i,(0,ee.Ue)()),r=t.offset;let l,d=0;const c=new ve.hM;return c.next((0,de._N)(e,s)).next((n=>{"start"===n.action&&(d=(0,ee.jH)(o,n.renderStart));const i=((0,ee.jH)(o,n.renderEnd)-d)*e.renderCoordsHelper.unitInMeters;t.offset=r+i,l=n})),e=>(c.execute(e),l)}function Ae(e,t){const{directSegment:n}=e,{renderCoordsHelper:i}=t,a=j(C.WM.get(),e,i),s=I(C.WM.get(),e),o=(0,S.e)(C.WM.get(),s,a),{viewForward:r}=t.state.camera;(0,S.f)(o,r)>0&&(0,S.h)(o,o,-1);const l=n.eval(.5,C.WM.get());return i.headingAtPosition(l,o)}function He(e,t,n,i){let{forHeading:a}=i;const{dimension:s,geometry:o}=t,{primaryOffsetAxis:r}=o,l=(0,S.h)(Re,r,s.offset>=0?1:-1),d=ke(xe,{forHeading:a,geometry:o,renderCoordsHelper:n});(0,S.e)(d,d,l);const c=(0,re.Aq)(l,d,M.AG,Ie);e.modelTransform=c,e.renderLocation=ze(Ze,o,o.dimensionSegment,n)}const Re=(0,M.Ue)(),xe=(0,M.Ue)();function ze(e,t,n,i){const{startRenderSpace:a,endRenderSpace:s}=n,o=function(e,t){const n=I(Ve,e),i=j(Ge,e,t);return(0,S.f)(n,i)>0}(t,i)?a:s;return(0,S.c)(e,o)}function ke(e,t){let{forHeading:n,geometry:i,renderCoordsHelper:a}=t;return n?j(e,i,a):W(e,i,{invert:!0})}const Ve=(0,M.Ue)(),Ge=(0,M.Ue)();function Ee(e){return(0,K.F2)(e)+ae}function Ue(e,t){const n=t.material??new fe.j({writeDepth:!1,textureId:t.texture?.id,renderOccluded:he.yD.Opaque,isDecoration:!0}),i=t.focusMultiplier??re.rotateManipulatorDefaults.focusMultiplier,a=t.calloutLength??re.rotateManipulatorDefaults.calloutLength,s=re.rotateManipulatorDefaults.discRadius*(t.discScale??1),o=s*i,r=(e,t)=>{const n=[0,1,2,2,3,0];return new pe.Z(t,[[ge.T.POSITION,new ue.a([a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],n,3,!0)],[ge.T.UV0,new ue.a([0,0,1,0,1,1,0,1],n,2,!0)]])},l=t.calloutWidth??re.rotateManipulatorDefaults.calloutWidth,d=new _e.U({width:l,color:t.calloutColor,renderOccluded:he.yD.OccludeAndTransparent,isDecoration:!0}),c=(0,me.rh)(d,[[0,0,0],[a-s,0,0]]),u=(0,me.rh)(d,[[0,0,0],[a-o,0,0]]),p=t.customStateMask??ye.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[a,0,0]},e.focusMultiplier=i,e.metadata=t.metadata,e.radius=s,e.renderObjects=[new le.r(r(s,n),ye.Q9.Unfocused|p),new le.r(c,ye.Q9.Unfocused|p),new le.r(r(o,n),ye.Q9.Focused|p),new le.r(u,ye.Q9.Focused|p)]}const Le=ye.jg.Custom1,Ze=(0,M.Ue)(),je=(0,M.Ue)(),Ie=(0,y.Ue)(),We=new D.y;var Ye,Fe=n(25810),Xe=n(100),Be=n(84652),Ne=n(97942),qe=n(66978),Qe=n(46634);function Je(e,t,n){const{constraint:i,elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:r}=n,{dimension:l,previousConstraint:d,preConstraintProperties:c}=e;if(null==a||null==s)return;const u=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)u(),null!=d&&null!=c&&(l.measureType=c.measureType,l.orientation=c.orientation);else switch(l.measureType=m.n.Direct,i){case Ye.Horizontal:if(i!==d&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=s.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=a.z),l.endPoint=e}break;case Ye.Vertical:if(i!==d&&(l.orientation=Ae(o,r)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=s.x,e.y=s.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=a.x,e.y=a.y),l.endPoint=e}break;case Ye.Direct:i!==d&&null!=c&&(l.orientation=c.orientation),u()}e.previousConstraint=i,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Ye||(Ye={}));var Ke=n(11526),$e=n(29255),et=n(33837),tt=n(27676),nt=n(86700),it=n(14813),at=n(84954),st=n(17877),ot=n(34019),rt=n(80151),lt=n(34010),dt=n(71040),ct=n(64674);let ut=class extends s.Z{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new Xe.Z,this._orientationManipulatorTexture=null,this._updatingHandles=new Qe.R,this._getSnappingContext=(0,Ne.H)((e=>new ot.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new st.c(new at.XE("point",(0,it.Y6)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new $e._})));const{view:t}=e;this._snappingManagerResult=(0,lt.u)(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,nt.z5)(2)}),this._constraintSnappingIndicator=new et.r({view:t,attached:!0,width:1,renderOccluded:he.yD.OccludeAndTransparent,stipplePattern:(0,nt.z5)(5),isDecoration:!0});const n=Q.Z.toUnitRGBA(ie);this._stagedStartIndicator=new tt.j({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:he.yD.OccludeAndTransparent,isDecoration:!0})}initialize(){const{view:e}=this;this._snappingOperation=new dt.y({view:e});const t=!e._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._orientationManipulatorMaterial=new fe.j({writeDepth:!1,renderOccluded:he.yD.Opaque,isDecoration:!0}),this.addHandles((0,d.YP)((()=>{return{accentColor:ne(e.effectiveTheme),contrastColor:(t=e.effectiveTheme,(0,te.mj)(t.accentColor))};var t}),(n=>{let{accentColor:i,contrastColor:a}=n;const s=this._orientationManipulatorTexture,o=(0,Ke.O)(e.textures,{accentColor:i,contrastColor:a,preMultiplyAlpha:t});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,s?.release();const r=Q.Z.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:r}),this._focusedOffsetManipulatorMaterial.setParameters({color:r}),this._thinOffsetManipulatorMaterial.setParameters({color:r}),this._constraintSnappingIndicator.color=r}),d.nn));const n=(0,d.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createManipulators(t)}));this.addHandles((0,o.ed)(n)),this.addHandles([(0,d.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(e=>{let{stagedPoint:t,stagedComputation:n}=e;if(null==n||null==t)return;const i=(0,P.WG)(t,new Se.Z);this._applyPointUpdate(n,{endPoint:i})}),d.Z_),(0,d.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:a}=e;if(n===t?.stagedDimension&&a===t?.firstGrabbedManipulator){for(const s of[i,t?.selectedComputation])if(null!=s){const t=this._computationManipulators.get(s);null!=t&&this._updateManipulators(s,t,e)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,e)}),d.tX),(0,d.YP)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),d.nn),(0,d.YP)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,d.YP)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,n=(0,M.Ue)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ct.Ob)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,qe.R8)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:n}=this._computationManipulators.get(e);if(t.grabbing||n.grabbing){!function(e,t,n){let{constraint:i,view:a}=n;const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:o,spatialReference:r}=a,{startRenderSpace:l,endRenderSpace:d}=s.directSegment,c=o.fromRenderCoords(l,new Se.Z({spatialReference:r})),u=o.fromRenderCoords(d,new Se.Z({spatialReference:r}));let p;p="start"===t?{startPoint:c}:{endPoint:u},Je(e,p,{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:a})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){this._snappingOperation=(0,l.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorTexture?.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){const e=this._stagedDimension,t=this.analysisViewData.computations.at(-1)?.computation;return null==e||null==t||t.dimension!==e?null:t}get _constraintHandles(){return[(0,d.gx)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...d.tX,equals:Be.fS}),(0,d.YP)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:n}=e.dimension;return{measureType:t,orientation:n,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:n,computation:i}=e;switch(i.previousConstraint){case Ye.Horizontal:i.preConstraintProperties={measureType:m.n.Horizontal,orientation:0};break;case Ye.Vertical:i.preConstraintProperties={measureType:m.n.Vertical,orientation:0};break;case Ye.Direct:i.preConstraintProperties={measureType:m.n.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:t,orientation:n}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),d.Z_)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,d.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(t=>{let{stagedComputation:n,activeComputation:i}=t;const a=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=i)if(i===n)a.attached=!0;else{const{start:t,end:n}=this._computationManipulators.get(i),s=()=>{a.attached=t.grabbing||n.grabbing};s(),this.addHandles([t.events.on("grab-changed",s),n.events.on("grab-changed",s)],e)}else a.attached=!1})),(0,d.YP)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(e=>{let{geometry:t,constraint:n}=e;const i=this._constraintSnappingIndicator;null!=t&&null!=n&&n!==Ye.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:n}=e;if("touch"===n)return;const i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,qe.R8)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:n}=e,i=t;if("mouse"===n){const e=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:e})}const a=new Fe.Z({startPoint:(0,P.WG)(i,new Se.Z),endPoint:null,measureType:m.n.Horizontal});return this._stagedDimension=a,this._resetSnappingState(),a}_onStagedClick(e){let{mapPoint:t,pointerType:n}=e;const i=this._stagedComputation;if(null==i)return;let a=t;if("mouse"===n){const e=this._getSnappingContext(n);a=this._snappingManager.update({point:t,context:e})}const s=(0,P.WG)(a,new Se.Z);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),a=this._setupHeadingManipulator(e),s=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,m.n.Direct),r=this._setupMeasureTypeManipulator(e,m.n.Horizontal),l=this._setupMeasureTypeManipulator(e,m.n.Vertical),d=new Me({start:t,end:n,offset:i,heading:a,rotation:s,direct:o,horizontal:r,vertical:l});return this._setupComputationToManipulatorsSync(e,d),this._computationManipulators.set(e,d),this.manipulators.addMany(d.values()),{manipulators:d,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of d.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,d.YP)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...d.tX,equals:Be.fS})],e)}_setupPointManipulator(e,t){const{view:n}=this,{dimension:i}=e,a=new we(n,{metadata:i}),s=function(e,t){let{isStart:n,createSnappingPipelineStep:i,dimension:a,onUpdate:s,view:o}=t;const r=n?"startPoint":"endPoint",l=(0,ve.Xd)(e,((e,t,n,l)=>{const d=(0,de.J4)(e),{snappingStep:c,cancelSnapping:u}=i(l);n=n.next(d).next((0,ve.di)(a,[r,"measureType","orientation"])).next(u),t.next(d).next((0,de.gv)(o)).next(...c).next((e=>{const t=(0,P.WG)(e.mapEnd,new Se.Z);s("startPoint"===r?{startPoint:t}:{endPoint:t})}))}));return[l]}(a,{isStart:t.isStart,createSnappingPipelineStep:e=>(0,rt.W)({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:t=>this._applyPointUpdate(e,t),view:n});return this._computationHandles.add(s,e),a}_setupOffsetManipulator(e){const{view:t}=this,n=function(e,t){const n=[(0,M.al)(-.5,0,0),(0,M.al)(.5,0,0)],i=(0,me.rh)(t.unfocusedMaterial,n.map((e=>(0,S.h)((0,M.Ue)(),e,.5)))),a=i.instantiate({material:t.focusedMaterial});return new oe.Z({view:e,renderObjects:[new le.r(i,ye.Q9.Unfocused|ye.Q9.Selected|Le),new le.r(a,ye.Q9.Focused|Le)],collisionType:{type:"line",paths:[n]},radius:Ee(t.lineSizePt)/2,metadata:t.metadata,available:!1,...re.X9})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,ve.Xd)(e,((e,t,a)=>{if(!B(n)||!e.selected)return;const{geometry:s,dimension:o}=n,r=(0,de.J4)(e);t.next(r).next(Oe(i,o,s.dimensionSegment,s.primaryOffsetAxis)),a.next(r).next((0,ve.di)(o,["offset"]))}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupHeadingManipulator(e){const{view:t}=this,n=new Ce(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,ve.Xd)(e,((e,t,a)=>{De({cancel:a,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupRotationManipulator(e){const{view:t}=this,n=new Ce(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=Pe(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupMeasureTypeManipulator(e,t){const{view:n}=this,i=function(e,t){const n=[(0,M.al)(-.5,0,0),(0,M.al)(.5,0,0)],i=(0,me.rh)(t.thinOffsetManipulatorMaterial,n),a=(0,me.rh)(t.unfocusedMaterial,n.map((e=>(0,S.h)((0,M.Ue)(),e,.5)))),s=a.instantiate({material:t.focusedMaterial});return new oe.Z({view:e,renderObjects:[new le.r(a,ye.Q9.Unfocused|Le),new le.r(s,ye.Q9.Focused|Le),new le.r(i,Le)],collisionType:{type:"line",paths:[n]},radius:Ee(t.lineSizePt)/2,available:!1,metadata:t.metadata,...re.X9})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),a=Te(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(a,e),i}_updateManipulators(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:i,selectedComputation:a,firstGrabbedManipulator:s}=n,{start:o,end:r,offset:l,heading:d,rotation:c}=t,u=a===e,p=B(e),{dimension:h}=e;for(const m of t.values()){const e=p&&null==i&&(null==s||m===s);m===l?(m.available=e,m.selected=u):m.available=e&&u}if(!p)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(h.measureType).available=!1;for(const _ of[d,c])h.measureType===m.n.Direct&&0!==h.offset||(_.available=!1);L(e)?c.available=!1:d.available=!1;const{geometry:g}=e;o.renderLocation=g.directSegment.startRenderSpace,r.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:f}=this.view;(function(e,t,n){const{dimensionSegment:i,primaryOffsetAxis:a}=t,s=W(Ze,t),o=(0,S.p)(s,M.AG)?(0,v.yR)(Ie):(0,re.Aq)(s,a,M.AG,Ie),r=Math.max((0,S.l)(s),.1/n.unitInMeters);(0,v.bA)(o,o,(0,S.i)(Ze,r,r,r)),e.modelTransform=o,e.renderLocation=i.eval(.5,Ze)})(l,g,f),d.available&&function(e,t,n){He(e,t,n,{forHeading:!0})}(d,e,f),c.available&&function(e,t,n){He(e,t,n,{forHeading:!1})}(c,e,f),t.forEachMeasureTypeManipulator(((t,n)=>{t.available&&function(e,t,n,i){const{geometry:a}=t,s=z(We,n,t,i),o=E(Ze,{measureType:n,directSegment:a.directSegment,renderCoordsHelper:i}),r=(0,S.a)(je,s.endRenderSpace,s.startRenderSpace),l=(0,re.Aq)(r,o,M.AG,Ie),d=(0,S.l)(r);(0,v.bA)(l,l,(0,S.i)(je,d,d,d)),e.modelTransform=l,e.renderLocation=s.eval(.5,je)}(t,e,n,f)}))}_updateManipulatorStyle(e){const t=function(e){return(0,K.F2)(e)+4}(e),n=Ee(e),i={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:a,heading:s,rotation:o}of this._computationManipulators.values())a.radius=n/2,s.update(i),o.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(e,t){const{view:n}=this,i=H(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);const a=R(i,n.renderCoordsHelper);if(null==a)return;const s=this._computeConstraint({...i,geometry:a});Je(e,t,{...i,constraint:s,unconstrainedGeometry:a,view:n}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,pt);const{state:t,renderCoordsHelper:n}=this.view,i=t.camera.computeScreenPixelSizeAt(pt);e.dimension.offset=50*i*n.unitInMeters}_computeConstraint(e){return function(e,t){if(X(e))return Ye.Direct;if(!e.enabled)return null;const{geometry:n}=e;if(null==n||(0,S.p)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=t.state,a=j(C.WM.get(),n,t.renderCoordsHelper),s=I(C.WM.get(),n),o=(0,S.h)(C.WM.get(),a,(0,S.f)(s,a)),r=(0,S.d)(C.WM.get(),s,o),l=(0,S.k)(r),d=(0,S.k)(o),{startRenderSpace:c,endRenderSpace:u}=n.directSegment,p=Math.max(10*i.computeScreenPixelSizeAt(c),10*i.computeScreenPixelSizeAt(u))**2;return l<p?Ye.Vertical:d<p?Ye.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new _e.U({width:1,renderOccluded:he.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){}};(0,a._)([(0,c.Cb)({constructOnly:!0})],ut.prototype,"analysis",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],ut.prototype,"analysisViewData",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],ut.prototype,"manipulators",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],ut.prototype,"parentTool",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],ut.prototype,"view",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],ut.prototype,"updating",null),(0,a._)([(0,c.Cb)()],ut.prototype,"firstGrabbedManipulator",null),(0,a._)([(0,c.Cb)()],ut.prototype,"hasGrabbedManipulators",null),(0,a._)([(0,c.Cb)()],ut.prototype,"snappingOptions",null),(0,a._)([(0,c.Cb)()],ut.prototype,"_stagedDimension",void 0),(0,a._)([(0,c.Cb)()],ut.prototype,"_activeComputation",null),(0,a._)([(0,c.Cb)()],ut.prototype,"_stagedComputation",null),ut=(0,a._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],ut);const pt=(0,M.Ue)();var mt,ht=n(86509),gt=n(87888),ft=n(81298),_t=n(72612);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(mt||(mt={}));let vt=class extends ht.f{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,ft.w)(this.view.state.viewingMode),this._lengthDimensionSubTool=new ut({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.ed)(this._lengthDimensionSubTool),(0,o.kB)((()=>this._clearPointerMoveTimeout())),(0,d.YP)((()=>this.state),(e=>{e===mt.Created&&this.finishToolCreation()}),d.tX),(0,d.gx)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),d.tX),(0,d.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),d.tX)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?mt.Creating:mt.Created:mt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(gt.Sn.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else gt.Sn.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,_t.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const n=this._intersector.results.min,i=C.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new Se.Z({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=Le)),this._prevPointerMoveTimeout=q.m.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~Le))}),this._pointerMoveTimerMs)}get testInfo(){}};(0,a._)([(0,c.Cb)({constructOnly:!0})],vt.prototype,"view",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],vt.prototype,"analysis",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],vt.prototype,"state",null),(0,a._)([(0,c.Cb)({readOnly:!0})],vt.prototype,"updating",null),(0,a._)([(0,c.Cb)({readOnly:!0})],vt.prototype,"cursor",null),(0,a._)([(0,c.Cb)({constructOnly:!0})],vt.prototype,"analysisViewData",void 0),(0,a._)([(0,c.Cb)()],vt.prototype,"selectedDimension",null),(0,a._)([(0,c.Cb)()],vt.prototype,"automaticManipulatorSelection",void 0),(0,a._)([(0,c.Cb)()],vt.prototype,"_activeSubTool",void 0),(0,a._)([(0,c.Cb)()],vt.prototype,"_lengthDimensionSubTool",void 0),vt=(0,a._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionTool")],vt);n(59166);var yt=n(58935),St=n(27210),Mt=n(99894),wt=n(52168),Ct=n(79685),bt=n(21317);class Pt extends wt._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=he.yD.OccludeAndTransparent,this._width=1,this._color=(0,Mt.al)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=(0,v.vc)(Dt,n),this._normal=t;const{points:i}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,Mt.d9)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new bt.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Ct.c)(this.geometry,this.normal)){const n=(0,Ct.Y)(this._material,t);e.addGeometry(n)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const Dt=(0,y.Ue)();class Tt{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new Xe.Z,this._messages=null,this._labelSegment=new D.y;const{analysis:t,computation:n,view:i,messages:a,isDecoration:s}=e;this.analysis=t,this.computation=n,this.view=i,this._messages=a;const o=e.visible,r={view:i,attached:o,isDecoration:s},{fontSize:l,textColor:c,textBackgroundColor:u}=t.style;this._visualElements=new Rt({marker:new Pt(r,e.markerMaterial),dimension:new et.r(r,e.dimensionLineMaterial),startOffset:new et.r(r,e.offsetLineMaterial),endOffset:new et.r(r,e.offsetLineMaterial),dimensionSmall:new et.r(r,e.smallDimensionLineMaterial),startOffsetSmall:new et.r(r,e.smallOffsetLineMaterial),endOffsetSmall:new et.r(r,e.smallOffsetLineMaterial),label:new St.K({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,K.F2)(l),textColor:c.clone(),backgroundColor:u.clone(),isDecoration:s})}),this._handles.add([(0,d.YP)((()=>n.geometry),(e=>{this.updateCameraDependentElements(i.state.camera,e,t.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...d.nn,equals:Be.fS}),(0,d.YP)((()=>n.length),(e=>this._updateLabelContent(e)),d.nn)])}destroy(){this.destroyed=!0,this._handles=(0,l.SC)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){}_updateLines(e){const t=x(Ot,i.Start,e.directSegment,e.dimensionSegment),n=x(At,i.End,e.directSegment,e.dimensionSegment),a=this._visualElements;a.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),a.dimension.setGeometryFromSegment(e.dimensionSegment),a.startOffset.setGeometryFromSegment(t),a.endOffset.setGeometryFromSegment(n),a.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),a.startOffsetSmall.setGeometryFromSegment(t),a.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const i=this._visualElements;if(null==t){for(const e of i.values())e.visible=!1;return}const a=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Ht)),s=function(e,t){return(0,S.k)(W(F,e))/t**2}(t,a),o=s<(2*(0,K.F2)(n.lineSize))**2,r=!o;i.marker.visible=r,i.dimension.visible=r,i.startOffset.visible=r,i.endOffset.visible=r,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,K.F2)(n.fontSize),{label:d}=i;if(d.visible=s>=l**2,!d.visible)return;const{dimensionSegment:c,primaryOffsetAxis:u}=t,{offset:p}=this.computation.dimension,m=(Math.sign(p)>=0?1:-1)*function(e){return 1.5*(0,K.F2)(e.fontSize)+20+(0,K.F2)(e.lineSize/2)}(n)*a;(function(e,t,n,i){(0,S.b)(e.startRenderSpace,t.startRenderSpace,n,i),(0,S.b)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,c,u,m),d.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,K.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,yt.VG)(this._messages,e,e.unit):t.text=""}}const Ot=new D.y,At=new D.y,Ht=(0,M.Ue)();class Rt{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var xt=n(33720),zt=n(36257),kt=n(41201);let Vt=class extends s.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new bt.X({width:1,anchor:xt.i5.Tip,color:$.AG,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:he.yD.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new _e.U({width:1,color:$.AG,renderOccluded:he.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new _e.U({width:1,color:$.AG,renderOccluded:he.yD.OccludeAndTransparent,stipplePattern:(0,nt.z5)(5),isDecoration:e}),this._smallDimensionLineMaterial=new _e.U({width:1,color:$.AG,renderOccluded:he.yD.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new _e.U({width:1,color:$.AG,renderOccluded:he.yD.OccludeAndTransparent,stipplePattern:(0,nt.z5)(5),isDecoration:e});for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles((0,o.kB)((()=>{this.view._stage?.remove(n)})));const t=(0,d.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createVisualization(t)}));this._dimensionVisualizations=t,this.addHandles([(0,o.ed)(t),(0,d.YP)((()=>Q.Z.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),d.tX),(0,d.YP)((()=>this.analysis.style.lineSize),(e=>{const t=(0,K.F2)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:n})}),d.tX),(0,d.YP)((()=>({camera:this.view.state.camera,style:Gt(this.analysis)})),(e=>{let{camera:t,style:n}=e;for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(t,i.computation.geometry,n),i.updateLabelStyle(n)})),(0,d.YP)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,zt.qe)((()=>this._updateMessageBundle())),(0,d.gx)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),d.Z_)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(e){const t=new Tt({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,kt.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Gt(e){const{fontSize:t,lineSize:n,textColor:i,textBackgroundColor:a}=e.style;return{fontSize:t,lineSize:n,textBackgroundColor:a.clone(),textColor:i.clone()}}(0,a._)([(0,c.Cb)({constructOnly:!0})],Vt.prototype,"analysisViewData",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Vt.prototype,"view",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],Vt.prototype,"isDecoration",void 0),(0,a._)([(0,c.Cb)()],Vt.prototype,"analysis",null),(0,a._)([(0,c.Cb)()],Vt.prototype,"visible",null),(0,a._)([(0,c.Cb)()],Vt.prototype,"loadingMessages",void 0),Vt=(0,a._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Vt);let Et=class extends s.Z{constructor(e){super(e),this.dimension=null,this.length=null}};(0,a._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Et.prototype,"dimension",void 0),(0,a._)([(0,c.Cb)()],Et.prototype,"length",void 0),Et=(0,a._)([(0,u.j)("esri.views.analysis.LengthDimensionResult")],Et);const Ut=Et;let Lt=class extends s.Z{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...n}=e;return{result:new Ut({dimension:t}),...n}}initialize(){this.addHandles([(0,d.YP)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),d.tX),(0,d.YP)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),d.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,a._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"result",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"projectAndAlignPoint",void 0),(0,a._)([(0,c.Cb)()],Lt.prototype,"dimension",null),(0,a._)([(0,c.Cb)()],Lt.prototype,"length",null),(0,a._)([(0,c.Cb)()],Lt.prototype,"geometry",void 0),(0,a._)([(0,c.Cb)()],Lt.prototype,"unconstrainedGeometry",void 0),(0,a._)([(0,c.Cb)()],Lt.prototype,"elevationAlignedStartPoint",void 0),(0,a._)([(0,c.Cb)()],Lt.prototype,"elevationAlignedEndPoint",void 0),(0,a._)([(0,c.Cb)()],Lt.prototype,"preConstraintProperties",void 0),(0,a._)([(0,c.Cb)()],Lt.prototype,"previousConstraint",void 0),Lt=(0,a._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Lt);var Zt=n(33906),jt=n(70209),It=n(80987);const Wt=e=>{let t=class extends e{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new It.Z}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,a._)([(0,c.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,a._)([(0,c.Cb)()],t.prototype,"tool",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],t.prototype,"results",null),(0,a._)([(0,c.Cb)()],t.prototype,"selectedDimension",void 0),(0,a._)([(0,c.Cb)()],t.prototype,"interactive",void 0),(0,a._)([(0,c.Cb)()],t.prototype,"visible",void 0),t=(0,a._)([(0,u.j)("esri.views.analysis.DimensionAnalysisView")],t),t};let Yt=class extends(Wt((0,p.p)(s.Z))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:n}=this.view,i=(0,Zt.G)(e,t,n);return null==i&&(0,Zt.e)(this.analysis,e.spatialReference,r.Z.getLogger(this)),i};const e=(0,d.wZ)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,jt.Lp)(this,vt),(0,o.ed)(e)]),this._analysisVisualization=new Vt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new N({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.IM)(this._placementTask),this._analysisVisualization=(0,l.SC)(this._analysisVisualization),(0,jt.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.IM)(this._placementTask),this._placementTask=(0,jt.Er)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,n=new Lt({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,a._)([(0,c.Cb)({readOnly:!0})],Yt.prototype,"type",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"tool",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"updating",null),(0,a._)([(0,c.Cb)({readOnly:!0})],Yt.prototype,"results",null),(0,a._)([(0,c.Cb)()],Yt.prototype,"computations",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"selectedDimension",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"selectedComputation",null),(0,a._)([(0,c.Cb)()],Yt.prototype,"_analysisVisualization",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"_analysisController",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"_dimensionsToComputations",void 0),(0,a._)([(0,c.Cb)()],Yt.prototype,"_placementTask",void 0),Yt=(0,a._)([(0,u.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],Yt);const Ft=Yt},70209:(e,t,n)=>{n.d(t,{Er:()=>r,Lp:()=>l,Yq:()=>d});var i=n(14921),a=n(92026),s=n(66978),o=n(94172);function r(e,t){e.interactive=!0;const{tool:n,view:r}=e;r.activeTool=n;let l=(0,s.fu)(t,(()=>{r.activeTool===n&&(r.activeTool=null)}));return(0,i.vr)((async e=>{await(0,o.N1)((()=>null==n||!n.active),e),l=(0,a.hw)(l)}),t)}function l(e,t){return(0,o.YP)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){d(e);const{view:n,analysis:i}=e,a=new t({view:n,analysis:i,analysisViewData:e});e.tool=a,n.tools.add(a)}(e,t):d(e)}(e,t)),o.tX)}function d(e){const{view:t,tool:n}=e;null!=n&&(t.tools.remove(n),e.tool=null)}},86509:(e,t,n)=>{n.d(t,{f:()=>r});var i=n(27366),a=n(94172),s=(n(32718),n(93169),n(84936),n(10064),n(69912)),o=n(29919);let r=class extends o.m{constructor(e){super(e)}initialize(){this.addHandles((0,a.YP)((()=>this.analysisViewData.visible),(e=>this.visible=e),a.tX))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};r=(0,i._)([(0,s.j)("esri.views.interactive.AnalysisToolBase")],r)},81298:(e,t,n)=>{n.d(t,{w:()=>s});var i=n(88153),a=n(54463);function s(e){const t=(0,i.Z8)(e);return t.options.store=a.eC.MIN,t.options.excludeLabels=!0,t}}}]);
//# sourceMappingURL=9290.4b3e657a.chunk.js.map