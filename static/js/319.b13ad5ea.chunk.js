"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[319],{50319:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var s=n(27366),o=n(66978),i=(n(32718),n(93169),n(84936),n(10064),n(69912)),d=n(32035),c=n(12400),r=n(85981),u=n(23470),a=n(78329),h=n(79762);function p(t,e,n){const s=(0,u.c)(),o=(0,u.g)(s);return(0,d.r)(o,o,t,.5),(0,d.r)(o,o,e,.5),s[3]=(0,d.p)(o,t),(0,d.g)(o,o,n),s}let g=class{constructor(){this._idToComponent=new Map,this._components=new a.Z((t=>t.bounds)),this._edges=new a.Z((t=>t.bounds)),this._tmpLineSegment=(0,r.Ue)(),this._tmpP1=(0,c.Ue)(),this._tmpP2=(0,c.Ue)(),this._tmpP3=(0,c.Ue)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,o.k_)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>(this._addCandidates(t,e,n),n.length<1e3)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if(null==t.info){const{id:e,uid:s}=t;n.push({id:e,uid:s})}return!0}),t.bounds),!n.length)return;const s={components:n},o=await this.remoteClient.invoke("fetchAllEdgeLocations",s,null!==e&&void 0!==e?e:{});for(const i of o.components)this._setFetchEdgeLocations(i)}async add(t){const e=new m(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>(n.component===e&&t.push(n),!0)),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if(null==e||t.uid!==e.uid)return;const n=h.n_.createView(t.locations),s=new Array(n.count),o=(0,c.Ue)(),i=(0,c.Ue)();for(let c=0;c<n.count;c++){n.position0.getVec(c,o),n.position1.getVec(c,i);const d=p(o,i,t.origin),r=new f(e,c,d);s[c]=r}this._edges.add(s);const{objectIds:d,origin:r}=t;e.info={locations:n,objectIds:d,origin:r}}_addCandidates(t,e,n){const{info:s}=e.component,{origin:o,objectIds:i}=s,c=s.locations,r=c.position0.getVec(e.index,this._tmpP1),u=c.position1.getVec(e.index,this._tmpP2);(0,d.g)(r,r,o),(0,d.g)(u,u,o);const a=i[c.componentIndex.get(e.index)];this._addEdgeCandidate(t,a,r,u,n),l(t,a,r,n),l(t,a,u,n)}_addEdgeCandidate(t,e,n,s,o){if(!t.returnEdge)return;const i=(0,u.g)(t.bounds),a=(0,r.zk)(n,s,this._tmpLineSegment),h=(0,r.nF)(a,i,this._tmpP3);(0,u.n)(t.bounds,h)&&o.push({type:"edge",objectId:e,target:(0,c.d9)(h),distance:(0,d.p)(i,h),start:(0,c.d9)(n),end:(0,c.d9)(s)})}};g=(0,s._)([(0,i.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],g);const _=g;function l(t,e,n,s){if(!t.returnVertex||!(0,u.n)(t.bounds,n))return;const o=(0,u.g)(t.bounds);s.push({type:"vertex",objectId:e,target:(0,c.d9)(n),distance:(0,d.p)(o,n)})}class m{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++m.uid}}m.uid=0;class f{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);
//# sourceMappingURL=319.b13ad5ea.chunk.js.map