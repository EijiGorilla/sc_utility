"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[3616],{25810:(e,t,n)=>{n.d(t,{Z:()=>f});var i=n(27366),r=(n(59486),n(48805)),s=n(11582),o=n(17768),a=n(46784),l=n(49861),c=n(89125),d=(n(63780),n(93169),n(69912)),u=n(25243),h=n(585);let p=class extends((0,a.eC)(s.j)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=r.n.Direct,this.offset=0,this.orientation=0}};(0,i._)([(0,l.Cb)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,i._)([(0,l.Cb)({type:h.Z,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,i._)([(0,l.Cb)({type:h.Z,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,i._)([(0,l.Cb)({type:r.V,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,i._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,i._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.p)((e=>o.BV.normalize((0,u.q9)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,i._)([(0,d.j)("esri.analysis.LengthDimension")],p);const f=p},48805:(e,t,n)=>{var i;n.d(t,{V:()=>r,n:()=>i}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));const r=[i.Horizontal,i.Vertical,i.Direct]},151:(e,t,n)=>{function i(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,n,i){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function o(){return i()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function u(){return s(0,0,0,1)}n.d(t,{c:()=>r,f:()=>s});const h=o(),p=a(),f=l(),_=c(),m=d(),g=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:g,UNIT_X:f,UNIT_Y:_,UNIT_Z:m,ZEROS:h,clone:r,create:i,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:u,unitX:l,unitY:c,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},97942:(e,t,n)=>{function i(e){let t,n,i=[],r=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,r=!0),n}}n.d(t,{H:()=>i})},87072:(e,t,n)=>{function i(e){var t;const n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,n.floorInfo.floorField):null}function r(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const n=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{c:()=>i,f:()=>r})},23616:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ar});var i,r=n(27366),s=n(7138),o=n(42537),a=n(32718),l=n(92026),c=n(94172),d=n(49861),u=(n(25243),n(63780),n(93169),n(69912)),h=n(98074),p=n(48805),f=n(68860),_=n(74177),m=n(16889),g=n(47898),v=n(14226),y=n(81949),S=n(11186),w=n(71353),b=n(14320),P=n(51378),C=n(55946),M=n(37818),x=n(9052),R=n(5986),T=n(92975),O=n(25003);function D(e,t,n){const r=E(e,t,n,i.Direct);return null!=r?(0,g.yG)(r.direct,r.unit):null}function E(e,t,n,r){const s=(0,O.m)(n),o=(0,f.j5)(s);if(null==o)return null;const a=t[2]-e[2];if(r===i.Vertical)return{verticalSigned:a,unit:o};if(!(0,R.S)(e,n,L,s)||!(0,R.S)(t,n,j,s))return null;if(r===i.Direct)return{direct:(0,S.o)(j,L),unit:o};if((0,S.s)(G,e[0],e[1],t[2]),!(0,R.S)(G,n,G,s))return null;const l=(0,S.o)(G,j);return r===i.Horizontal?{horizontal:l,unit:o}:{direct:(0,S.o)(j,L),horizontal:l,vertical:Math.abs(a),unit:o}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(i||(i={}));const A=(0,w.c)(),z=(0,w.c)(),L=(0,w.c)(),j=(0,w.c)(),G=(0,w.c)();function H(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:r,orientation:s}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i,measureType:r,orientation:s}}function V(e,t){let{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,offset:r,measureType:s,orientation:o}=e,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==n||null==i)return null;const l=N(null!=a?a.directSegment:new x.y,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i},t),c=null!=a?a.primaryOffsetAxis:(0,w.c)();U(c,{measureType:s,elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,orientation:o,renderCoordsHelper:t});const d=null!=a?a.dimensionSegment:new x.y;return Y({elevationAlignedStartPoint:n,elevationAlignedEndPoint:i})&&s===p.n.Vertical?((0,S.c)(d.startRenderSpace,l.startRenderSpace),(0,S.c)(d.endRenderSpace,l.endRenderSpace)):B(d,{offsetAxis:c,offset:r,relativeToSegment:l,renderCoordsHelper:t}),{directSegment:l,dimensionSegment:d,primaryOffsetAxis:c,spatialReference:t.spatialReference}}function F(e,t,n,i){return t===k.Start?((0,S.c)(e.startRenderSpace,n.startRenderSpace),(0,S.c)(e.endRenderSpace,i.startRenderSpace)):((0,S.c)(e.startRenderSpace,n.endRenderSpace),(0,S.c)(e.endRenderSpace,i.endRenderSpace)),e}var k;function I(e,t,n,i){switch(t){case p.n.Direct:return N(e,n,i);case p.n.Horizontal:case p.n.Vertical:{const{elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,dimension:o,geometry:a}=n;let l;o.measureType===p.n.Direct?(l=function(e,t){const n=e.directSegment.eval(.5,P.WM.get()),i=t.worldUpAtPosition(n,P.WM.get()),r=e.dimensionSegment.eval(.5,P.WM.get()),s=(0,S.u)(P.WM.get(),r,n);return!(0,S.G)(s,w.Z)&&(0,S.j)(s,i)>0}(a,i)===r.z>s.z,t===p.n.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:i,endRenderSpace:r}=e.directSegment;return(0,S.y)(i,t)<(0,S.y)(r,n)}(a);const[c,d]=l?[r,s]:[s,r],u=(0,M.WG)(d,Z);return t===p.n.Horizontal?u.z=c.z:(u.x=c.x,u.y=c.y),i.toRenderCoords(c,e.startRenderSpace),i.toRenderCoords(u,e.endRenderSpace),e}}}function N(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(k||(k={}));const Z=(0,C.T)(0,0,0,null);const q=new x.y;function U(e,t){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:r,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=t,c=a.eval(.5,P.WM.get()),d=l.worldUpAtPosition(c,P.WM.get()),u=l.worldBasisAtPosition(c,b.R.Y,P.WM.get());switch(n){case p.n.Horizontal:(0,S.c)(e,d);break;case p.n.Vertical:(0,S.j)(s,d)<(0,S.j)(o,d)?(0,S.u)(e,o,s):(0,S.u)(e,s,o),(0,S.b)(e,e,d),(0,S.b)(e,e,d);break;case p.n.Direct:{var h;const n=null!==(h=t.orientation)&&void 0!==h?h:0;if(Y({elevationAlignedStartPoint:i,elevationAlignedEndPoint:r}))(0,v.c)(W,-(0,m.Vl)(n),d),(0,S.e)(e,u,W);else{const t=(0,S.u)(P.WM.get(),o,s),i=(0,S.b)(P.WM.get(),t,d);(0,S.b)(i,i,t),(0,v.c)(W,(0,m.Vl)(n),t),(0,S.e)(e,i,W)}break}}return(0,S.G)(e,w.Z)?(0,S.c)(e,u):(0,S.n)(e,e)}const W=(0,y.a)();function Y(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;return null!=t&&null!=n&&t.x===n.x&&t.y===n.y}function B(e,t){const{offsetAxis:n,offset:i,relativeToSegment:{startRenderSpace:r,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:a}=t,l=i/a.unitInMeters,[c,d]=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=(0,S.j)(t,n),s=(0,S.j)(e,n),o=Math.abs(r-s)+i;return r>s?[o,i]:[i,o]}(r,s,n,l);return(0,S.q)(e.startRenderSpace,o.startRenderSpace,n,c),(0,S.q)(e.endRenderSpace,o.endRenderSpace,n,d),e}function X(e,t,n){const i=t.directSegment.eval(.5,P.WM.get());return n.worldUpAtPosition(i,e)}function Q(e,t){const{startRenderSpace:n,endRenderSpace:i}=t.directSegment;return(0,S.u)(e,i,n)}function J(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:i,endRenderSpace:r}=t.dimensionSegment;return n.invert?(0,S.u)(e,i,r):(0,S.u)(e,r,i)}function K(e,t){const n=e.directSegment.eval(.5,P.WM.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}const $=(0,w.c)();function ee(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;if(null==t||null==n)return!1;const i=function(e,t){const{spatialReference:n}=e;return(0,T.fS)(n,t.spatialReference)?(A[0]=e.x,A[1]=e.y,A[2]=e.hasZ?e.z:0,z[0]=t.x,z[1]=t.y,z[2]=t.hasZ?t.z:0,D(A,z,n)):null}(t,n);return null!=i&&(0,g.nn)(i,"meters").value>te}const te=1e5;function ne(e){return null!=e.geometry}let ie=class extends s.Z{constructor(e){super(e)}initialize(){const e=(0,c.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._watchComputation(t)}));this.addHandles((0,o.ed)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,_.R)(this.view)}_watchComputation(e){return(0,c.YP)((()=>H(e)),(t=>{const{measureType:n}=t;if(ee(t)&&n!==p.n.Direct){const t=Math.round((0,f.En)(te,"meters","kilometers"));return a.Z.getLogger(this).warnOnce("A ".concat(n," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(t,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}const i=V(t,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=function(e,t,n){if(null==e)return null;const i=D(e.dimensionSegment.startRenderSpace,e.dimensionSegment.endRenderSpace,e.spatialReference);if(null==i)return null;const r=t===p.n.Vertical?(0,f.yv)(i.value,i.unit,n):(0,f.wd)(i.value,i.unit,n);return(0,g.nn)(i,r)}(i,n,this._defaultUnit)}),c.tX)}};(0,r._)([(0,d.Cb)({constructOnly:!0})],ie.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],ie.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],ie.prototype,"analysis",null),(0,r._)([(0,d.Cb)()],ie.prototype,"_defaultUnit",null),ie=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],ie);var re=n(84702),se=n(51995),oe=(n(59486),n(17768)),ae=n(17842),le=n(67077),ce=n(55652),de=n(86950);function ue(e){return(0,de.G)(e.accentColor,.5)}function he(e){return(0,de.mj)(e.accentColor)}const pe=new se.Z([127,127,127,.5]),fe=6,_e=5;var me=n(35284),ge=n(83639),ve=n(40508),ye=n(51328),Se=n(2522),we=n(91526),be=n(40779),Pe=n(70619),Ce=n(56529),Me=n(4760),xe=n(66156),Re=n(58901),Te=n(5693),Oe=n(99034),De=n(585);class Ee{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.V)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.n.Direct:return this.direct;case p.n.Horizontal:return this.horizontal;case p.n.Vertical:return this.vertical}}}class Ae extends me.Z{constructor(e,t){const n=(0,ge.EA)(se.Z.toUnitRGBA(ue(e.effectiveTheme))),i=[new ve.r((0,Pe.PI)(n,1,32,32),Xe)];super({view:e,renderObjects:i,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.YP)((()=>({color:se.Z.toUnitRGBA(ue(e.effectiveTheme))})),(e=>n.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class ze extends me.Z{constructor(e,t){let{lineSizePt:n,material:i,metadata:r}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:r}),this._options={calloutColor:(0,le.c)(),lineSizePt:n,material:i},this._themeHandle=(0,c.YP)((()=>se.Z.toUnitRGBA(ue(e.effectiveTheme))),(e=>{this._options.calloutColor=e,Be(this,Le({...this._options,metadata:this.metadata}))}),c.nn)}update(e){let{lineSizePt:t,material:n}=e;this._options.lineSizePt=t,this._options.material=n,Be(this,Le({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Le(e){let{calloutColor:t,lineSizePt:n,material:i,metadata:r}=e;return{calloutLength:.25*Se.M_*.8*(0,ae.F2)(n)+18,calloutColor:t,calloutWidth:2,customStateMask:Xe,discScale:.3,focusMultiplier:2,material:i,metadata:r}}function je(e,t){let{computation:n,view:i}=t;return[(0,Te.Xd)(e,((e,t,r)=>{Ge({cancel:r,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,n){const{dimension:i,geometry:r}=t;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==r)return;const{renderCoordsHelper:s}=n,o=V({...H(t),orientation:90},s),a=V({...H(t),orientation:270},s);if(null==o||null==a)return;const l=K(o,s),c=K(a,s),d=Fe(r,n),u=oe.BV.shortestSignedDiff(d,l),h=oe.BV.shortestSignedDiff(d,c);i.orientation=Math.abs(u)<Math.abs(h)?90:270,e.stopPropagation()}(e,n,i)}))]}function Ge(e){var t,n;const{cancel:i,computation:r,settingHeading:s,steps:o,view:a}=e;if(!ne(r))return;const{renderCoordsHelper:l}=a,{dimension:c,geometry:d}=r,u=(0,w.c)(),h=Ze((0,w.c)(),d,d.directSegment,l),p=qe(P.WM.get(),{forHeading:s,geometry:d,renderCoordsHelper:l}),f=(0,ce.Yq)(h,p,(0,ce.Ue)()),_=s?null!==(t=c.orientation)&&void 0!==t?t:K(d,a.renderCoordsHelper):null!==(n=c.orientation)&&void 0!==n?n:0;o.next((0,ye._N)(a,f)).next((e=>{"start"===e.action&&(0,S.c)(u,e.renderStart);const t=(0,ce.mJ)(f),n=(0,ge.Gd)(u,e.renderEnd,h,t);let i=_-(0,m.BV)(n);s||(i=function(e){const t=oe.BV.normalize(e)%90;return t<_e?e-t:90-t<_e?e+(90-t):e}(i)),c.orientation=i})),i.next((0,Te.di)(c,["orientation"]))}function He(e,t){let{computation:n,manipulatorMeasureType:i,view:r}=t,s=p.n.Direct,o=0,a=0;return[e.events.on("grab-changed",(t=>{if("start"!==t.action||!ne(n))return;const{dimension:l,geometry:c}=n;s=l.measureType,o=l.offset,a=l.orientation;const d=(0,S.c)(P.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){const{directSegment:r}=n,s=U(P.WM.get(),{measureType:t,directSegment:r,renderCoordsHelper:i}),o=B(q,{offsetAxis:s,offset:0,relativeToSegment:r,renderCoordsHelper:i}).eval(.5,P.WM.get()),a=(0,S.u)(P.WM.get(),e,o);return(0,S.j)(a,s)*i.unitInMeters}(d,i,c,r.renderCoordsHelper),l.orientation=0})),(0,Te.Xd)(e,((e,t,l)=>{if(!ne(n))return;const{geometry:c,dimension:d}=n,{renderCoordsHelper:u}=r,h=I($e,i,n,u),p=U(P.WM.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:u}),f=(0,ye.J4)(e);t.next(f).next(Ve(r,d,h,p)),l.next(f).next((e=>(d.measureType=s,d.offset=o,d.orientation=a,e)))}))]}function Ve(e,t,n,i){const r=(0,S.f)(P.WM.get(),n.endRenderSpace,n.startRenderSpace);(0,S.b)(r,r,i);const s=(0,ce.Yq)(n.startRenderSpace,r,(0,ce.Ue)()),o=(0,ce.Yq)(n.startRenderSpace,i,(0,ce.Ue)()),a=t.offset;let l,c=0;const d=new Te.hM;return d.next((0,ye._N)(e,s)).next((n=>{"start"===n.action&&(c=(0,ce.jH)(o,n.renderStart));const i=((0,ce.jH)(o,n.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+i,l=n})),e=>(d.execute(e),l)}function Fe(e,t){const{directSegment:n}=e,{renderCoordsHelper:i}=t,r=X(P.WM.get(),e,i),s=Q(P.WM.get(),e),o=(0,S.b)(P.WM.get(),s,r),{viewForward:a}=t.state.camera;(0,S.j)(o,a)>0&&(0,S.i)(o,o,-1);const l=n.eval(.5,P.WM.get());return i.headingAtPosition(l,o)}function ke(e,t,n,i){let{forHeading:r}=i;const{dimension:s,geometry:o}=t,{primaryOffsetAxis:a}=o,l=(0,S.i)(Ie,a,s.offset>=0?1:-1),c=qe(Ne,{forHeading:r,geometry:o,renderCoordsHelper:n});(0,S.b)(c,c,l);const d=(0,ge.Aq)(l,c,w.Z,Ke);e.modelTransform=d,e.renderLocation=Ze(Qe,o,o.dimensionSegment,n)}const Ie=(0,w.c)(),Ne=(0,w.c)();function Ze(e,t,n,i){const{startRenderSpace:r,endRenderSpace:s}=n,o=function(e,t){const n=Q(Ue,e),i=X(We,e,t);return(0,S.j)(n,i)>0}(t,i)?r:s;return(0,S.c)(e,o)}function qe(e,t){let{forHeading:n,geometry:i,renderCoordsHelper:r}=t;return n?X(e,i,r):J(e,i,{invert:!0})}const Ue=(0,w.c)(),We=(0,w.c)();function Ye(e){return(0,ae.F2)(e)+fe}function Be(e,t){var n,i,r,s,o,a,l;const c=null!==(n=t.material)&&void 0!==n?n:new xe.j({transparent:!0,writeDepth:!1,textureId:null===(i=t.texture)||void 0===i?void 0:i.id,renderOccluded:Ce.yD.Opaque,isDecoration:!0}),d=null!==(r=t.focusMultiplier)&&void 0!==r?r:ge.rotateManipulatorDefaults.focusMultiplier,u=null!==(s=t.calloutLength)&&void 0!==s?s:ge.rotateManipulatorDefaults.calloutLength,h=ge.rotateManipulatorDefaults.discRadius*(null!==(o=t.discScale)&&void 0!==o?o:1),p=h*d,f=(e,t)=>{const n=[0,1,2,2,3,0];return new be.Z(t,[[Me.T.POSITION,new we.a([u-e,-e,0,u+e,-e,0,u+e,e,0,u-e,e,0],n,3,!0)],[Me.T.UV0,new we.a([0,0,1,0,1,1,0,1],n,2,!0)]])},_=null!==(a=t.calloutWidth)&&void 0!==a?a:ge.rotateManipulatorDefaults.calloutWidth,m=new Re.U({width:_,color:t.calloutColor,renderOccluded:Ce.yD.OccludeAndTransparent,isDecoration:!0}),g=(0,Pe.rh)(m,[[0,0,0],[u-h,0,0]]),v=(0,Pe.rh)(m,[[0,0,0],[u-p,0,0]]),y=null!==(l=t.customStateMask)&&void 0!==l?l:Oe.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[u,0,0]},e.focusMultiplier=d,e.metadata=t.metadata,e.radius=h,e.renderObjects=[new ve.r(f(h,c),Oe.Q9.Unfocused|y),new ve.r(g,Oe.Q9.Unfocused|y),new ve.r(f(p,c),Oe.Q9.Focused|y),new ve.r(v,Oe.Q9.Focused|y)]}const Xe=Oe.jg.Custom1,Qe=(0,w.c)(),Je=(0,w.c)(),Ke=(0,y.a)(),$e=new x.y;var et,tt=n(25810),nt=n(100),it=n(84652),rt=n(97942),st=n(66978),ot=n(46634);function at(e,t,n){const{constraint:i,elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:a}=n,{dimension:l,previousConstraint:c,preConstraintProperties:d}=e;if(null==r||null==s)return;const u=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)u(),null!=c&&null!=d&&(l.measureType=d.measureType,l.orientation=d.orientation);else switch(l.measureType=p.n.Direct,i){case et.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=s.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=r.z),l.endPoint=e}break;case et.Vertical:if(i!==c&&(l.orientation=Fe(o,a)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=s.x,e.y=s.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=r.x,e.y=r.y),l.endPoint=e}break;case et.Direct:i!==c&&null!=d&&(l.orientation=d.orientation),u()}e.previousConstraint=i,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(et||(et={}));var lt=n(11526),ct=n(74509),dt=n(90045),ut=n(151),ht=n(70444),pt=n(95773),ft=n(85981),_t=n(40885),mt=n(19182),gt=n(62389),vt=n(19265),yt=n(39077);class St extends mt.i{constructor(e){super(e),this._ray=(0,_t.Ue)(),this._isWorldDown=!1,this._start=(0,w.c)(),this._end=(0,w.f)(1,0,0),this._width=1,this._color=(0,ut.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,ut.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Mt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ce.yD.OccludeAndTransparent,this._fadedExtensions=Rt,this._laserline=new gt.W({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,S.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,S.f)(this._end,e,this._end),(0,_t.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,S.h)(this._start,e)||((0,S.c)(this._start,e),(0,_t.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,S.h)(this._end,e)||((0,S.c)(this._end,e),(0,_t.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,dt.h)(e,this._color)||((0,dt.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,dt.h)(e,this._innerColor)||((0,dt.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,dt.h)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,ut.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ce.yD.OccludeAndTransparentStencil?Ce.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:Rt,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Re.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const i=this._createGeometry(e);n.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Re.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new yt.z(t)}_createGeometry(e){const t=this.extensionType===Mt.FADED,n=t?[(0,w.c)(),(0,w.c)(),(0,w.c)(),(0,w.c)()]:[(0,w.c)(),(0,w.c)()];return(0,Pe.rh)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===Mt.FADED?this._updateLineSegmentFinite(Ct):this._updateLineSegmentInfinite(this._extensionType,Ct)}_updateLineSegmentFinite(e){return(0,ft.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch((0,ht.iL)(this._ray,wt),e){case Mt.LINE:wt.c0=-Number.MAX_VALUE;break;case Mt.RAY:case Mt.GROUND_RAY:{var i;const e=this._ray.origin,t=null!==(i=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==i?i:0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&(0,S.E)(wt.ray.direction,wt.ray.direction),this._extensionType===Mt.GROUND_RAY&&null!=t&&(wt.c1=Math.abs(n-t));break}}if(!(0,pt.zq)(n.frustum,wt))return this._updateLineSegmentFinite(t);const r=(0,ht.Ws)(wt,bt),s=(0,ht.S$)(wt,Pt);return(0,ft.zk)(r,s,t)}_updateVertexAttributesObject3D(e,t){var n;const i=null===(n=e.geometries[0].getMutableAttribute(Me.T.POSITION))||void 0===n?void 0:n.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],Me.T.POSITION)}_updateVertexAttributesDraped(e,t){var n;const i=null===(n=e.getMutableAttribute(Me.T.POSITION))||void 0===n?void 0:n.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=vt.gi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===Mt.FADED?(yield(0,ft.KU)(e,-this.fadedExtensions.start,bt),yield(0,ft.KU)(e,0,bt),yield(0,ft.KU)(e,1,bt),yield(0,ft.KU)(e,1+this.fadedExtensions.end,bt)):(yield(0,ft.KU)(e,0,bt),yield(0,ft.KU)(e,1,bt))}}const wt=(0,ht.Ue)(),bt=(0,w.c)(),Pt=(0,w.c)(),Ct=(0,ft.Ue)();var Mt;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(Mt||(Mt={}));const xt=1/3,Rt={start:xt,end:xt};var Tt=n(88396),Ot=n(6394);class Dt extends mt.i{constructor(e){super(e),this._location=(0,w.c)(),this._direction=(0,w.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,ut.f)(1,0,1,1),this._renderOccluded=Ce.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,S.h)(this._location,e)||((0,S.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,S.h)(this._direction,e)||((0,S.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,S.n)(this._direction,(0,S.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,dt.h)(e,this._color)||((0,dt.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Re.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const[i,r]=this._createGeometries(e);t.addGeometry(i),t.addGeometry(r),n.push(i),n.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Re.U(this.materialParameters),t=(0,c.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new yt.z(e)))}_createGeometries(e){return[(0,Pe.rh)(e,[(0,w.c)(),(0,w.c)()]),(0,Pe.rh)(e,[(0,w.c)(),(0,w.c)()])]}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,jt),(0,S.g)(Et,this.location,this.direction),t.projectToScreen(Et,Gt),(0,Tt.e)(Gt,(0,Tt.c)(Gt,Gt,jt)),this._updateVertexAttributesObject3D(t,e,0,jt,Gt,1),this._updateVertexAttributesObject3D(t,e,1,jt,Gt,-1)}_updateVertexAttributesObject3D(e,t,n,i,r,s){var o;const a=t.geometries[n],l=null===(o=a.getMutableAttribute(Me.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:d}=this._computeStartEnd(r,i,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,ae.c$)(c),Et),l[0]=Et[0],l[1]=Et[1],l[2]=Et[2],e.unprojectFromScreen((0,ae.c$)(d),Et),l[3]=Et[0],l[4]=Et[1],l[5]=Et[2],t.geometryVertexAttributeUpdated(a,Me.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{location:i,width:r,length:s,offset:o}=this,a=Ht;a.spatialReference=t.renderer.spatialReference,a.x=i[0],a.y=i[1];const l=this.view.overlayPixelSizeInMapUnits(a)*n,c=r*l,d=s*l,u=o*l;this._updateVertexAttributesDraped(e[0],c,d,u,-1),this._updateVertexAttributesDraped(e[1],c,d,u,1)}_updateVertexAttributesDraped(e,t,n,i,r){var s;const o=null===(s=e.getMutableAttribute(Me.T.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:d}=this._computeStartEnd(l,a,r,i,t,n);o[0]=c[0],o[1]=c[1],o[2]=vt.gi,o[3]=d[0],o[4]=d[1],o[5]=vt.gi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,n,i,r,s){const o=(0,Tt.a)(At,(0,Tt.s)(At,e[1]*n,e[0]*-n),i+r/2),a=(0,Tt.i)(zt,(0,Tt.i)(zt,(0,Tt.i)(zt,t,(0,Tt.a)(zt,e,s/2)),o),o);return{start:a,end:(0,Tt.i)(Lt,a,(0,Tt.a)(Lt,e,-s))}}}const Et=(0,w.c)(),At=(0,Ot.a)(),zt=(0,Ot.a)(),Lt=(0,Ot.a)(),jt=(0,ae.s1)(),Gt=(0,ae.s1)(),Ht=(0,C.T)(0,0,void 0,null);var Vt=n(66730),Ft=n(98917),kt=n(26279),It=n(38054),Nt=n(46784);let Zt=class extends Nt.wq{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,d.Cb)({type:Boolean})],Zt.prototype,"enabled",void 0),Zt=(0,r._)([(0,u.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Zt);let qt=class extends Nt.wq{constructor(e){super(e),this.lineSnapper=new Zt,this.parallelLineSnapper=new Zt,this.rightAngleSnapper=new Zt,this.rightAngleTriangleSnapper=new Zt,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new se.Z([255,127,0]),this.orangeTransparent=new se.Z([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,r._)([(0,d.Cb)({type:Zt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],qt.prototype,"lineSnapper",void 0),(0,r._)([(0,d.Cb)({type:Zt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],qt.prototype,"parallelLineSnapper",void 0),(0,r._)([(0,d.Cb)({type:Zt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],qt.prototype,"rightAngleSnapper",void 0),(0,r._)([(0,d.Cb)({type:Zt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],qt.prototype,"rightAngleTriangleSnapper",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],qt.prototype,"shortLineThreshold",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],qt.prototype,"distance",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],qt.prototype,"pointThreshold",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],qt.prototype,"intersectionParallelLineThreshold",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],qt.prototype,"parallelLineThreshold",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qt.prototype,"verticalLineThreshold",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],qt.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],qt.prototype,"pointOnLineThreshold",void 0),(0,r._)([(0,d.Cb)({type:se.Z,nonNullable:!0})],qt.prototype,"orange",void 0),(0,r._)([(0,d.Cb)({type:se.Z,nonNullable:!0})],qt.prototype,"orangeTransparent",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],qt.prototype,"lineHintWidthReference",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],qt.prototype,"lineHintWidthTarget",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qt.prototype,"lineHintFadedExtensions",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],qt.prototype,"parallelLineHintWidth",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],qt.prototype,"parallelLineHintLength",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],qt.prototype,"parallelLineHintOffset",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],qt.prototype,"rightAngleHintSize",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],qt.prototype,"rightAngleHintOutlineSize",void 0),(0,r._)([(0,d.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],qt.prototype,"satisfiesConstraintScreenThreshold",void 0),qt=(0,r._)([(0,u.j)("esri.views.interactive.snapping.Settings.Defaults")],qt);const Ut=new qt;var Wt=n(80371),Yt=n(64674),Bt=n(55054);class Xt extends Bt.r{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wt.B.ALL),this.intersectionPoint=e}equals(e){return e instanceof Xt&&(0,S.h)(this.intersectionPoint,e.intersectionPoint)}}var Qt=n(53397);class Jt extends Bt.r{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Wt.B.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Jt&&(0,S.h)(this.lineStart,e.lineStart)&&(0,S.h)(this.lineEnd,e.lineEnd)}}var Kt=n(61309);class $t extends Bt.r{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:Wt.B.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof $t&&(0,S.h)(this.previousVertex,e.previousVertex)&&(0,S.h)(this.centerVertex,e.centerVertex)&&(0,S.h)(this.nextVertex,e.nextVertex)}}class en{draw(e,t){const n=this._getUniqueHints(e),i=this.sortUniqueHints(n),r=[];for(const s of i)s instanceof Xt&&r.push(this.visualizeIntersectionPoint(s,t)),s instanceof Qt.w&&r.push(this.visualizeLine(s,t)),s instanceof Jt&&r.push(this.visualizeParallelSign(s,t)),s instanceof $t&&r.push(this.visualizeRightAngleQuad(s,t)),s instanceof Kt.n&&r.push(this.visualizePoint(s,t));return(0,o.AL)(r)}sortUniqueHints(e){return e}_getUniqueHints(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}}var tn=n(11208);class nn extends en{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof Qt.w?t.length:0)-(e instanceof Qt.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:n,view:i}=t,r=rn(t);return(0,o.ed)(new Vt.L({view:i,primitive:"circle",geometry:(0,It.Ju)(e.intersectionPoint,n),elevationInfo:e.isDraped?ct.tR:ct.jG,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:n,spatialReference:i}=t,r=rn(t),s=sn(e.point,e.domain,t);return(0,o.ed)(new Vt.L({view:n,primitive:"circle",geometry:(0,It.Ju)(s,i),elevationInfo:on(e,t),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:n,spatialReference:i}=t,r=rn(t),s=sn(e.lineStart,e.domain,t),a=sn(e.lineEnd,e.domain,t);return(0,o.ed)(this._createLineSegmentHint(e.type,s,a,i,on(e,t),n,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,spatialReference:i}=t,r=rn(t),{isDraped:s}=e,a=on(e,t),l=sn(e.lineStart,e.domain,t),c=sn(e.lineEnd,e.domain,t),d=ln(l,i,a,n,s),u=ln(c,i,a,n,s),h=(0,S.p)(u,d,u,.5),p=new Dt({view:n,attached:!1,offset:Ut.parallelLineHintOffset,length:Ut.parallelLineHintLength,width:Ut.parallelLineHintWidth,color:r.parallelSignColor,location:h,renderOccluded:s?Ce.yD.OccludeAndTransparent:Ce.yD.Opaque,isDraped:s,renderGroup:kt.eZ.SnappingHint,isDecoration:!0});return p.setDirectionFromPoints(d,h),p.attached=!0,(0,o.ed)(p)}visualizeRightAngleQuad(e,t){const{view:n,spatialReference:i}=t,r=rn(t),s=on(e,t),{isDraped:a}=e,l=sn(e.previousVertex,e.domain,t),c=sn(e.centerVertex,e.domain,t),d=sn(e.nextVertex,e.domain,t),u=ln(l,i,s,n,a),h=ln(c,i,s,n,a),p=ln(d,i,s,n,a);return(0,o.ed)(new Ft.R({view:n,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?Ce.yD.OccludeAndTransparent:Ce.yD.Transparent,outlineRenderOccluded:a?Ce.yD.OccludeAndTransparent:Ce.yD.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:Ut.rightAngleHintOutlineSize,size:Ut.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:h,next:p},renderGroup:kt.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,n,i,r,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const d=ln(t,i,r,s,a),u=ln(n,i,r,s,a),h=new St({view:s,extensionType:Mt.FADED,start:d,end:u,isDraped:a,color:o.lineColor,renderOccluded:a?Ce.yD.OccludeAndTransparent:Ce.yD.Opaque,renderGroup:kt.eZ.SnappingHint,isDecoration:!0});switch(e){case Yt.ze.TARGET:h.width=Ut.lineHintWidthTarget,h.fadedExtensions={start:0,end:Ut.lineHintFadedExtensions};break;case Yt.ze.REFERENCE_EXTENSION:h.width=Ut.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case Yt.ze.REFERENCE:h.width=Ut.lineHintWidthReference,h.fadedExtensions={start:l?Ut.lineHintFadedExtensions:0,end:c?Ut.lineHintFadedExtensions:0}}return h.attached=!0,h}}function rn(e){const{effectiveTheme:t}=e.view,n=se.Z.toUnitRGBA(t.accentColor),i=[0,0,0,0];return{intersectionPointColor:i,intersectionPointOutlineColor:n,pointColor:i,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:se.Z.toUnitRGBA((0,de.G)(t.accentColor,.5)),rightAngleOutlineColor:n}}function sn(e,t,n){const i=an(t,n);return null==i?e:(0,It.Ue)(e[0],e[1],i)}function on(e,t){return null!=an(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?ct.tR:ct.jG}function an(e,t){let{selfSnappingZ:n}=t;return e===Wt.B.SELF&&null!=n?n.value:null}function ln(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,w.c)();if(r){const n=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,R.S)(e,t,s,n)}else(0,tn.RS)(e,t,n,i,s);return s}var cn=n(33837),dn=n(52168),un=n(78935),hn=n(86372),pn=n(69691);var fn=n(68401),_n=n(11606);class mn extends dn._{constructor(e){super(e),this.view=null,this._renderOccluded=Ce.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,le.b)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,le.b)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,dt.h)(e,this._color)||((0,dt.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,dt.h)(e,this._outlineColor)||((0,dt.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,r){const s=(0,hn.bg)(3*e.length),o=(0,hn.bg)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const a=(0,pn.rR)(s,t,0,o,0,s,0,s.length/3,n,i,r),l=null!=a;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,un.o.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position;for(let s=0;s<i;++s){const e=(0,S.s)(gn,r[3*s],r[3*s+1],r[3*s+2]),t=vn(this._vertexMaterial,.5,e),i=vn(this._vertexOutlineMaterial,.5,e);n.push({vertexGeometry:t,vertexOutlineGeometry:i})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new _n.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:fn.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new _n.Q({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:fn.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const gn=(0,w.c)();function vn(e,t,n){return(0,Pe.PI)(e,t,16,16,{offset:n})}var yn=n(86700),Sn=n(14813),wn=n(84954),bn=n(95172),Pn=n(70758),Cn=n(80987);let Mn=class extends s.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,r._)([(0,d.Cb)({constructOnly:!0})],Mn.prototype,"layer",void 0),(0,r._)([(0,d.Cb)()],Mn.prototype,"enabled",void 0),(0,r._)([(0,d.Cb)()],Mn.prototype,"updating",void 0),(0,r._)([(0,d.Cb)()],Mn.prototype,"availability",void 0),Mn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Mn);const xn=Mn;let Rn=class extends s.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new Cn.Z,this.distance=Ut.distance,this.touchSensitivityMultiplier=Ut.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,r._)([(0,d.Cb)()],Rn.prototype,"enabled",void 0),(0,r._)([(0,d.Cb)()],Rn.prototype,"enabledToggled",void 0),(0,r._)([(0,d.Cb)()],Rn.prototype,"selfEnabled",void 0),(0,r._)([(0,d.Cb)()],Rn.prototype,"featureEnabled",void 0),(0,r._)([(0,d.Cb)({type:Cn.Z.ofType(xn)})],Rn.prototype,"featureSources",void 0),(0,r._)([(0,d.Cb)()],Rn.prototype,"distance",void 0),(0,r._)([(0,d.Cb)()],Rn.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],Rn.prototype,"effectiveEnabled",null),(0,r._)([(0,d.Cb)({readOnly:!0})],Rn.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,d.Cb)({readOnly:!0})],Rn.prototype,"effectiveFeatureEnabled",null),Rn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingOptions")],Rn);const Tn=Rn;var On=n(26277),Dn=n(44179),En=n(76672),An=n(18661),zn=n(87072),Ln=n(37933);let jn=class extends s.Z{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,n;const{layer:i}=this;if(!(0,Ln.e9)(i)||null===(e=i.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const r=null!==(t=null===(n=i.fieldsIndex.get(i.subtypeField))||void 0===n?void 0:n.name)&&void 0!==t?t:i.subtypeField,s=i.sublayers.filter((e=>e.visible)).map((e=>e.subtypeCode));return s.length?s.length===i.subtypes.length?{mode:"all-visible",filter:null}:1===s.length?{mode:"in-use",filter:"".concat(r," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(r," IN (").concat(s.join(", "),")")}:{mode:"none-visible",filter:null}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,zn.c)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const n=e;this.addHandles(n.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,c.YP)((()=>t.updating),(e=>t.layerSource.updating=e),c.tX),(0,c.YP)((()=>t.availability),(e=>t.layerSource.availability=e),c.tX)])}getFetchCandidatesParameters(e,t,n){var i,r;if(!this.valid)return[];const{layer:s,layerView:o,floorFilter:a,rulesTable:l,subtypeFilter:c}=this,d={distance:n,mode:null!==(i=null===(r=this.view)||void 0===r?void 0:r.type)&&void 0!==i?i:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:o&&"filter"in o?o.filter:null};if(a&&(d.filter=Gn(d.filter,a)),"not-in-use"!==c.mode&&"all-visible"!==c.mode){if("none-visible"===c.mode)return[];d.filter?d.filter.where=(0,En._)(d.filter.where,c.mode):d.filter=new An.Z({where:c.filter})}if(l){var u;const e=t.feature,n=null===e||void 0===e?void 0:e.sourceLayer;if(!(e&&(0,Ln.Te)(s)&&s.layerId&&(0,Ln.Te)(n)&&"loaded"===l.loadStatus))return[];const i=[],r=s.layerId,o=null===(u=l.getFeatureSQL(n,e))||void 0===u?void 0:u[r];if(!o)return[];const a=o.anyVertex;let c=o.endVertex;return c&&a&&c===a&&(c=""),c&&i.push({...d,returnEdge:!1,vertexMode:"ends",filter:Gn(d.filter,c)}),a&&i.push({...d,returnEdge:!1,vertexMode:"all",filter:Gn(d.filter,a)}),i}return[d]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,Yt.n0)(null===t||void 0===t?void 0:t.map)&&(0,Ln.Te)(e)){var n;const r=null===(n=t.map.utilityNetworks)||void 0===n?void 0:n.find((t=>t.isUtilityLayer(e)));if(r)try{var i;this.rulesTable=await r.getRulesTable(),await(null===(i=this.rulesTable)||void 0===i?void 0:i.load()),this._valid=!0}catch(ui){return void a.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}else this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function Gn(e,t){return null==e?new An.Z({where:t}):e.where?new An.Z({where:(0,En._)(e.where,t)}):new An.Z({where:t})}(0,r._)([(0,d.Cb)({constructOnly:!0})],jn.prototype,"layer",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],jn.prototype,"snappingSource",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],jn.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],jn.prototype,"layerView",null),(0,r._)([(0,d.Cb)()],jn.prototype,"rulesTable",void 0),(0,r._)([(0,d.Cb)()],jn.prototype,"valid",null),(0,r._)([(0,d.Cb)()],jn.prototype,"subtypeFilter",null),(0,r._)([(0,d.Cb)()],jn.prototype,"floorFilter",null),(0,r._)([(0,d.Cb)()],jn.prototype,"_valid",void 0),jn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],jn);var Hn,Vn=n(97760),Fn=n(95905),kn=n(75691),In=n(92605);class Nn extends In.j{constructor(e){let{targetPoint:t,constraint:n,previousVertex:i,otherVertex:r,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,n,a,Wt.B.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===Hn.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===Hn.CENTER?this.targetPoint:this.otherVertex;return[new Qt.w(Yt.ze.TARGET,t,n,this.isDraped,this.domain),new Qt.w(Yt.ze.REFERENCE,e,t,this.isDraped,this.domain),new $t(this.previousVertex,t,n,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Hn||(Hn={}));let Zn=class extends s.Z{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=Wt.B.FEATURE,this._updatingHandles=new ot.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,c.TP)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e.featureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,o.ed)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,n,i){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const r=[],s=this._computeScreenSizeDistanceParameters(e,n);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,n,s);for(const e of t)r.push(l.snappingSource.fetchCandidates(e,i).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,n.excludeFeature))))))}const a=(await(0,st.OT)(r)).flat();return this._addRightAngleCandidates(a,e,s,n),(0,st.k_)(i),(0,Yt.lQ)(e,a),a}_addRightAngleCandidates(e,t,n,i){var r,s,o,a;const l=null!=i.vertexHandle?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(r=r.rightVertex)||void 0===r?void 0:r.pos:null!=i.editGeometryOperations&&"polygon"===i.editGeometryOperations.data.type?null===(s=i.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=i.vertexHandle?null===(o=i.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=i.editGeometryOperations?null===(a=i.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:d}=this,u=(0,It.j7)(l,d,i),h=(0,It.j7)(c,d,i),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,n,e),this._addRightAngleCandidate(e[f],u,t,n,e)}_addRightAngleCandidate(e,t,n,i,r){if(null==t||!function(e){return(e instanceof Fn.L||e instanceof Vn.k)&&!function(e){let{constraint:{start:t,end:n}}=e;const i=(0,S.a)(t,n),r=(0,Tt.k)(t,n);return i<(0,On.g)()||r/i<Yn}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-n[0])/i.x,a=(s[1]-n[1])/i.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const n=new Nn({targetPoint:s,otherVertex:t,otherVertexType:Hn.NEXT,previousVertex:(0,Tt.k)(s,l)>(0,Tt.k)(s,c)?l:c,constraint:new Dn.aU(t,s),objectId:e.objectId,isDraped:e.isDraped});r.push(n)}}_computeScreenSizeDistanceParameters(e,t){let n=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?(n*=this.view.resolution,{x:n,y:n,z:n,distance:n}):this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,n,i){const{spatialReference:r}=i;n.renderCoordsHelper.toRenderCoords(e,r,Un);const s=n.state.camera.computeScreenPixelSizeAt(Un),o=s*n.renderCoordsHelper.unitInMeters,a=o/(0,f.c9)(r),l=o/(0,f._R)(r),c=t*a,d=t*l,u=(0,tn.Rs)(e,r,ct.jG,n),h=u?qn(u,e,a,0,0,n,i):0,p=u?qn(u,e,0,a,0,n,i):0,_=u?qn(u,e,0,0,l,n,i):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===_?0:d/_,distance:s*t}}_candidateIsExcluded(e,t,n){if(null==n)return!1;const i=this._getCandidateObjectId(t);if(null==i)return!1;const r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}_getCandidateObjectId(e){return e instanceof kn.a?e.objectId:null}async _createSourceInfo(e,t){const n=e.layer;n.loaded||(await n.load(),(0,st.k_)(t));const{view:i}=this,r=await this._createFeatureSnappingSourceType(e);return(0,st.k_)(t),new jn(null==r?{}:{snappingSource:r,view:i,layer:n})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,n;return null!==(t=null===(n=e.layer.sublayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),n={module:null,loader:t};this._sourceModules[e]=n;const i=await t,r={module:i,loader:t};return this._sourceModules[e]=r,i}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(5532).then(n.bind(n,5532)));case"featureCollection":return t.addPromise(n.e(2137).then(n.bind(n,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(4054),n.e(5026),n.e(5281),n.e(3066),n.e(8928),n.e(3518)]).then(n.bind(n,33518)));case"scene":return t.addPromise(n.e(2767).then(n.bind(n,92767)))}}get test(){return{snappingSources:this._snappingSources}}};function qn(e,t,n,i,r,s,o){let{spatialReference:a}=o;const l=(0,S.c)(Wn,t);l[0]+=n,l[1]+=i,l[2]+=r;const c=(0,tn.Rs)(l,a,ct.jG,s);return c?(0,Yt.fG)(c,e):1/0}(0,r._)([(0,d.Cb)({constructOnly:!0})],Zn.prototype,"spatialReference",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Zn.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],Zn.prototype,"options",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],Zn.prototype,"updating",null),(0,r._)([(0,d.Cb)()],Zn.prototype,"_snappingSources",void 0),Zn=(0,r._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],Zn);const Un=(0,w.c)(),Wn=(0,w.c)(),Yn=1e-4;var Bn=n(91505),Xn=n(79803);class Qn{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=Ut.shortLineThreshold*Ut.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,It.j7)(e.leftVertex.pos,this.view,t),(0,It.j7)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,n){let{spatialReference:i}=n;return 0===this.squaredShortLineThreshold||(0,Yt.Bb)((0,tn.Rs)(t,i,ct.jG,this.view),(0,tn.Rs)(e,i,ct.jG,this.view))>this.squaredShortLineThreshold}isVertical(e,t){return(0,Tt.k)(e,t)<Ut.verticalLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}}class Jn extends In.j{constructor(e){let{lineStart:t,lineEnd:n,targetPoint:i,isDraped:r}=e;super(i,new Dn.jg(t,n),r,Wt.B.SELF),this._referenceLineHint=new Qt.w(Yt.ze.REFERENCE_EXTENSION,t,n,r,this.domain)}get hints(){return[this._referenceLineHint,new Qt.w(Yt.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var Kn=n(55793),$n=n(94163);class ei extends Qn{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;const{spatialReference:s}=t,o=(0,tn.Rs)(e,s,ct.jG,this.view),{view:a}=this,l=n.edges[i-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const n=(0,Yt._j)(c,a,t);this._processCandidateProposal(n.left,n.right,e,o,t,r)}c=c.leftVertex.leftEdge}while(c&&c!==l);return r}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;const{view:s}=this,{spatialReference:o}=t,a=(0,tn.Rs)(e,o,ct.jG,s),l=i.leftEdge,c=i.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,It.j7)(l.leftVertex.pos,s,t),(0,It.j7)(c.rightVertex.pos,s,t),e,a,t,n);const d=r.edges[0];let u=d;do{if(u!==i.leftEdge&&u!==i.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const i=(0,Yt._j)(u,s,t);this._processCandidateProposal(i.left,i.right,e,a,t,n)}u=u.rightVertex.rightEdge}while(u&&u!==d);return n}_processCandidateProposal(e,t,n,i,r,s){var o;const{spatialReference:a,pointer:l}=r,c=(0,It.uo)((0,Kn.ZE)(n,{start:e,end:t,type:$n.SP.LINE}));(0,Yt.Bb)(i,(0,tn.Rs)(c,a,ct.jG,this.view))<this.squaredProximityThreshold(l)&&s.push(new Jn({lineStart:e,lineEnd:t,targetPoint:c,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}}class ti extends In.j{constructor(e){let{referenceLine:t,lineStart:n,targetPoint:i,isDraped:r}=e;const s=(0,w.g)(n),{left:o,right:a}=t;(0,S.f)(s,(0,S.g)(s,s,a),o),super(i,new Dn.jg(n,(0,It.uo)(s)),r,Wt.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new Qt.w(Yt.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Jt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new Qt.w(Yt.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((n=>{(0,S.h)(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),(0,S.h)(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),(0,S.h)(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),(0,S.h)(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class ni extends Qn{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,s=[];if(i<2)return s;const{view:o}=this,a=(0,tn.Rs)(e,t.spatialReference,ct.jG,o),l=(0,It.j7)(n.vertices[r-1].pos,o,t),c=(0,It.j7)(n.vertices[0].pos,o,t),d=n.edges[i-1];let u=d;do{if(this.edgeExceedsShortLineThreshold(u,t)){const n=(0,Yt._j)(u,o,t);this._checkEdgeForParallelLines(n,l,e,a,t,s),this._checkEdgeForParallelLines(n,c,e,a,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==d);return s}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<3)return n;const{view:s}=this,o=(0,tn.Rs)(e,t.spatialReference,ct.jG,s),a=i.leftEdge,l=i.rightEdge,c=r.vertices[0],d=(0,It.j7)(c.pos,s,t),u=r.vertices.length,h=r.vertices[u-1],p=(0,It.j7)(h.pos,s,t),f=r.edges[0];let _=f;do{if(_!==a&&_!==l&&this.edgeExceedsShortLineThreshold(_,t)){const r=(0,Yt._j)(_,s,t);a&&this._checkEdgeForParallelLines(r,(0,It.j7)(a.leftVertex.pos,s,t),e,o,t,n),l&&this._checkEdgeForParallelLines(r,(0,It.j7)(l.rightVertex.pos,s,t),e,o,t,n),i===c?this._checkEdgeForParallelLines(r,p,e,o,t,n):i===h&&this._checkEdgeForParallelLines(r,d,e,o,t,n)}_=_.rightVertex.rightEdge}while(_&&_!==f);return n}_checkEdgeForParallelLines(e,t,n,i,r,s){const o=e.left,a=e.right;if((0,$n.k0)(ii,t,o,a),(0,Tt.k)(ii,t)<Ut.parallelLineThreshold)return;(0,$n.k0)(ii,n,o,a,t);const{spatialReference:l,pointer:c}=r,d=(0,It.al)(ii[0],ii[1],n[2]);if((0,Yt.Bb)(i,(0,tn.Rs)(d,l,ct.jG,this.view))<this.squaredProximityThreshold(c)){var u;if(this.isVertical(d,t)||this.isVertical(o,a))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new ti({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===(null===(u=r.elevationInfo)||void 0===u?void 0:u.mode)}))}}_parallelToPreviousCandidate(e,t){const n=e.left,i=e.right;for(const r of t)if((0,$n.k0)(ii,i,r.constraint.start,r.constraint.end,n),(0,Tt.k)(ii,i)<Ut.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}}const ii=(0,Ot.a)();class ri extends Qn{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.vertices.length,r=[];if(i<2)return r;const{view:s}=this,o=(0,tn.Rs)(e,t.spatialReference,ct.jG,s),a=n.vertices[i-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const n=(0,It.j7)(a.pos,s,t),i=(0,It.j7)(a.leftEdge.leftVertex.pos,s,t);this._checkForSnappingCandidate(r,i,n,e,o,t)}const l=n.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const n=(0,It.j7)(l.pos,s,t),i=(0,It.j7)(l.rightEdge.rightVertex.pos,s,t);this._checkForSnappingCandidate(r,i,n,e,o,t)}return r}snapExistingVertex(e,t){const n=[],i=t.vertexHandle;if(i.component.vertices.length<3)return n;const{view:r}=this,s=(0,tn.Rs)(e,t.spatialReference,ct.jG,r),o=i.leftEdge,a=i.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const i=o.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(i,t)){const o=(0,It.j7)(i.rightVertex.pos,r,t),a=(0,It.j7)(i.leftVertex.pos,r,t);this._checkForSnappingCandidate(n,a,o,e,s,t)}}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const i=a.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(i,t)){const o=(0,It.j7)(i.leftVertex.pos,r,t),a=(0,It.j7)(i.rightVertex.pos,r,t);this._checkForSnappingCandidate(n,a,o,e,s,t)}}return n}_checkForSnappingCandidate(e,t,n,i,r,s){const{spatialReference:o,pointer:a}=s;(0,Tt.c)(si,n,t);const l=(0,S.s)(oi,si[1],-si[0],0),c=(0,Tt.g)(l,(0,Tt.c)(si,i,n))/(0,Tt.v)(l),d=(0,It.uo)((0,Tt.w)((0,w.g)(i),n,l,c));if((0,Yt.Bb)(r,(0,tn.Rs)(d,o,ct.jG,this.view))<this.squaredProximityThreshold(a)){var u;if(this.isVertical(d,n)||this.isVertical(n,t))return;const i=(0,S.q)((0,w.c)(),n,l,Math.sign(c));e.push(new Nn({targetPoint:d,constraint:new Dn.aU(n,(0,It.uo)(i)),previousVertex:t,otherVertex:n,otherVertexType:Hn.CENTER,isDraped:"on-the-ground"===(null===(u=s.elevationInfo)||void 0===u?void 0:u.mode)}))}}}const si=(0,Ot.a)(),oi=(0,w.c)();class ai extends In.j{constructor(e){let{targetPoint:t,point1:n,point2:i,isDraped:r}=e;super(t,new Dn.kt((0,It.uo)((0,S.p)((0,w.c)(),n,i,.5)),.5*(0,Tt.d)(n,i)),r,Wt.B.SELF),this._p1=n,this._p2=i}get hints(){return[new Qt.w(Yt.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new Qt.w(Yt.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new $t(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class li extends Qn{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;const{view:s}=this,o=n.vertices[0],a=n.vertices[r-1],l=(0,It.j7)(o.pos,s,t),c=(0,It.j7)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,i),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return n;const{view:s}=this,o=(0,It.j7)(i.leftEdge.leftVertex.pos,s,t),a=(0,It.j7)(i.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,n),n}_processCandidateProposal(e,t,n,i,r){if(!this.exceedsShortLineThreshold(e,t,i))return;const s=(0,Tt.l)(ci,e,t,.5),o=.5*(0,Tt.d)(e,t),a=(0,w.c)();(0,$n.xO)(a,n,s,o),a[2]=n[2];const l=(0,It.uo)(a),{spatialReference:c,pointer:d}=i,u=(0,tn.Rs)(n,c,ct.jG,this.view);if((0,Yt.Bb)(u,(0,tn.Rs)(l,c,ct.jG,this.view))<this.squaredProximityThreshold(d)){var h;if(this.isVertical(e,l)||this.isVertical(l,t))return;r.push(new ai({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=i.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const ci=(0,Ot.a)();let di=class extends s.Z{constructor(e){super(e),this.updating=!1,this._snappers=new Cn.Z,this._domain=Wt.B.SELF}initialize(){this._snappers.push(new ni(this.view,this.options),new ei(this.view,this.options),new ri(this.view,this.options),new li(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,n){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const t of r.snap(e,n))i.push(t);return(0,Yt.lQ)(e,i),i}};function ui(e,t){return[new di({view:e,options:t}),new Zn({view:e,options:t,spatialReference:e.spatialReference})]}function hi(e,t,n){var i;let{z:r,m:s,spatialReference:o,elevationInfo:a}=n;if(null==r&&null==s){const t=(0,C.T)(e[0],e[1],void 0,o);return null!=s&&(t.m=s,t.hasM=!0),t}if(null==t||"2d"===t.type){const t=(0,C.T)(e[0],e[1],r,o);return null!=s&&(t.m=s,t.hasM=!0),t}const l=null!==(i=(0,ct.zx)(t,e,o,ct.jG,a))&&void 0!==i?i:0,c=(0,C.T)(e[0],e[1],l,o);return null!=s&&(c.m=s,c.hasM=!0),c}(0,r._)([(0,d.Cb)({readOnly:!0})],di.prototype,"updating",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],di.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],di.prototype,"options",null),di=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SelfSnappingEngine")],di);class pi extends In.j{constructor(e,t,n,i){super(e,new Dn.Hk(e),i,Wt.B.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Xt(this.targetPoint,this.isDraped,this.domain)]}}let fi=class extends(Bn.Z.EventedMixin(s.Z)){constructor(e){super(e),this.options=new Tn,this.snappingEnginesFactory=ui,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=_i.MAIN}initialize(){this.addHandles([(0,c.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i}}),(()=>{this.doneSnapping(),this.emit("changed")}),c.Z_),(0,c.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),c.Z_),(0,c.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:n}=e;return this._recreateEngines(t,n)}),c.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:n,options:i}=this;this._engines=t(n,i)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}get _squaredSatisfiesConstraintThreshold(){return Ut.satisfiesConstraintScreenThreshold*Ut.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(null==i)return t;const r=this._selectUpdateInput(e);if(null==r)return t;const{spatialReference:s}=n,o=(0,Xn.project)(r,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=n,d=[],u=(0,It.SN)(o,a,l),h=i.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,n))return this._resetSnappingState(),t;i.targetPoint=h,d.push(...i.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,d.push(...p.hints);return null!=c&&this.addHandles(c.draw(d,{spatialReference:s,elevationInfo:gi(n),view:a,selfSnappingZ:n.selfSnappingZ}),mi),hi(h,a,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:l})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:n}=e;switch(this._currentSnappedType){case _i.MAIN:return t;case _i.SCENE:return n}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=_i.MAIN}_removeVisualization(){this.removeHandles(mi)}async _snapSinglePoint(e){let{point:t,context:n,signal:i}=e;const{view:r}=this,{elevationInfo:s}=n,o=(0,It.SN)(t,r,s),a=await this._fetchCandidates(o,Wt.B.ALL,n,i);return this._createSnapResult(o,_i.MAIN,a,r,n,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:s},i)}async _snapMultiPoint(e){var t,n;let{point:i,scenePoint:r,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:d}=s;await(0,Xn.initializeProjection)(r.spatialReference,d);const u=(0,Xn.project)(r,d),h=(0,It.SN)(u,a,c),p=await this._fetchCandidates(h,Wt.B.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,Wt.B.SELF,s,o);return this._createSnapResult(h,_i.SCENE,[...p,...e],a,s,{z:u.z,m:u.m,spatialReference:u.spatialReference,elevationInfo:c},o)}const f=(0,It.SN)(i,a,c),_=await this._fetchCandidates(f,Wt.B.SELF,s,o);return this._createSnapResult(f,_i.MAIN,_,a,s,{z:l.hasZ()&&i.hasZ?null!==(t=i.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&i.hasM?null!==(n=i.m)&&void 0!==n?n:0:void 0,spatialReference:i.spatialReference,elevationInfo:c},o)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map((r=>r.fetchCandidates(e,t,n,i))))).flat()}_createSnapResult(e,t,n,i,r,s,o){return{get valid(){return!(0,st.Hc)(o)},apply:()=>{const{spatialReference:o}=r,{snappedPoint:a,hints:l}=this._processCandidates(e,t,n,r);return this._removeVisualization(),null!=r.visualizer&&this.addHandles(r.visualizer.draw(l,{spatialReference:o,elevationInfo:ct.jG,view:i,selfSnappingZ:r.selfSnappingZ}),mi),hi(a,i,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,Yt.lQ)(e,n);const r=this._currentMainCandidate;if(null!=r){const s=this._findOldConstraintInNewCandidates(r,n);if(s>=0){if(!(n[s]instanceof pi))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,i))return this._updateSnappingCandidate(r,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof pi?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,n,i,r){const{coordinateHelper:s}=r,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const i=t[l],r=o.constraint.intersect(i.constraint);if(r)for(const e of r.closestPoints(o.targetPoint))a.push([new pi(e,o,i,i.isDraped),this._squaredScreenDistance(n,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(a[0][0],i,t,r):this._updateSnappingCandidate(o,i,t,r)}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of n){if(e instanceof pi){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(r);this._squaredScreenDistance(t,r,i.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=r,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return(0,Yt.Bb)(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return(0,tn.Rs)(e,t.spatialReference,ct.jG,this.view)}_findOldCandidateIndex(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}get test(){return{visualizationsActive:this.hasHandles(mi),engines:this._engines}}};var _i;(0,r._)([(0,d.Cb)({constructOnly:!0})],fi.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],fi.prototype,"options",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],fi.prototype,"updating",null),(0,r._)([(0,d.Cb)()],fi.prototype,"snappingEnginesFactory",void 0),(0,r._)([(0,d.Cb)()],fi.prototype,"_engines",void 0),(0,r._)([(0,d.Cb)()],fi.prototype,"_squaredMouseProximityTreshold",null),(0,r._)([(0,d.Cb)()],fi.prototype,"_squaredTouchProximityThreshold",null),(0,r._)([(0,d.Cb)()],fi.prototype,"_squaredSatisfiesConstraintThreshold",null),fi=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingManager")],fi),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(_i||(_i={}));const mi="visualization-handle";function gi(e){let{coordinateHelper:t,elevationInfo:n}=e;return t.hasZ()?ct.jG:n}const vi=new Map;function yi(e){if(!vi.has(e)){const t=function(e,t){var n,i;const r=new Tn({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:Ut.distance,touchSensitivityMultiplier:null!==(i=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==i?i:Ut.touchSensitivityMultiplier});return{...(0,c.YP)((()=>{var t,n;return null!==(t=null===(n=e.map)||void 0===n||null===(n=n.allLayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]}),(e=>{r.featureSources=new Cn.Z(e.map((e=>new xn({layer:e,enabled:!0}))))}),c.nn),options:r}}(e,{distance:10}),n=function(e,t){return new fi({view:e,options:t,snappingEnginesFactory:(t,n)=>[new Zn({view:e,spatialReference:e.spatialReference,options:n})]})}(e,t.options);vi.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=vi.get(e);t.referenceCount++;const n=(0,o.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,Pn.Y)((()=>{0===t.referenceCount&&(t.remove(),vi.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...n}}class Si{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var wi=n(70178),bi=n(93463);function Pi(e){let{predicate:t=(()=>!0),snappingManager:n,snappingContext:i,updatingHandles:r,useZ:s=!0}=e;const o=new Te.hM;if(null==n)return{snappingStep:[Ri,o],cancelSnapping:Ri};let a,d=null,u=null,h=null;const p=()=>{var e;d=(0,l.IM)(d),n.doneSnapping(),null!==(e=u)&&void 0!==e&&e.frameTask.remove(),u=null,a=(0,l.hw)(a),h=null},f=function(e,t,n){return(0,st.Ds)((async(i,r)=>{let{frameTask:s,point:o,scenePoint:a,context:l,event:c,delta:d,getLastState:u}=i;const h=await s.schedule((()=>e.snap({point:o,scenePoint:a,context:l,signal:r})),r);if(h.valid){let i=await s.schedule((()=>h.apply()),r);const a=u();null!=a.point&&o!==a.point&&(i=e.update({point:a.point,scenePoint:a.scenePoint,context:l})),null!=a.updatePoint&&(0,wi.k)(i,a.updatePoint)||(xi(c.mapEnd,i,d,t),n.execute(c))}}))}(n,s,o);let _=null,m=null,g=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:o}=e;if("start"===o){const{info:t}=e,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(bi.T8.SNAPPING):bi.sq}(n.view);if(u=function(e,t,n){return{context:new Si({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(i,e,r),u.context.selfSnappingZ=null,!s&&null!=t){var l;const e=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const r of n){const t=e.getZ(r.pos);if(null!=i&&null!=t&&Math.abs(t-i)>1e-6)return null;null==i&&(i=t)}return i}(i.coordinateHelper,t.handle.component);null!=e&&(u.context.selfSnappingZ={value:e,elevationInfo:null!==(l=i.elevationInfo)&&void 0!==l?l:ct.jG})}}if(null!=u){const{context:t,originalScenePos:i,originalPos:l}=u,{mapEnd:p,mapStart:v,scenePoints:y}=e,S=Ci(l,Mi(p,v)),w=Mi(v,l),b={...e,action:"update"},P=u.context,C=function(e,t){return null==e||null==t?null:Ci(e,Mi(t.sceneEnd,t.sceneStart))}(i,y),M=n.update({point:S,scenePoint:C,context:t});if(g=M,xi(p,M,w,s),_=S,m=C,"end"!==o){const{frameTask:e}=u;null==d&&(d=new AbortController),h=t=>{r.addPromise((0,st.R8)(f({frameTask:e,event:b,context:P,point:S,scenePoint:C,delta:w,getLastState:()=>({point:_,scenePoint:m,updatePoint:t.forceUpdate?null:g})},d.signal)))},h({forceUpdate:!1}),null==a&&(a=(0,c.YP)((()=>n.options.effectiveEnabled),(()=>{var e;return null===(e=h)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===o&&p(),e},o],cancelSnapping:e=>(p(),e)}}function Ci(e,t){let[n,i,r]=t;const s=(0,M.WG)(e);return s.x+=n,s.y+=i,s.hasZ&&(s.z+=r),s}function Mi(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function xi(e,t,n,i){let[r,s,o]=n;e.x=t.x+r,e.y=t.y+s,i&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function Ri(e){return e}let Ti=class extends s.Z{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,st.Ds)((async(e,t,n,i)=>{const r=this._frameTask;if(null==r)return;const s=await r.schedule((()=>t.snap({...e,context:n,signal:i})),i);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(bi.T8.SNAPPING):bi.sq}destroy(){this._abortController=(0,l.IM)(this._abortController),this._frameTask=(0,l.hw)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:r}=e,s=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:r}=e;return this.stagedPoint=t.update({point:i,scenePoint:r,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async resnap(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,l.IM)(this._abortController),this._snapPoints=null}};(0,r._)([(0,d.Cb)({constructOnly:!0})],Ti.prototype,"view",void 0),(0,r._)([(0,d.Cb)()],Ti.prototype,"stagedPoint",null),(0,r._)([(0,d.Cb)()],Ti.prototype,"constrainResult",void 0),(0,r._)([(0,d.Cb)()],Ti.prototype,"_stagedPoint",void 0),Ti=(0,r._)([(0,u.j)("esri.views.interactive.snapping.SnappingOperation")],Ti);let Oi=class extends s.Z{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new nt.Z,this._orientationManipulatorTexture=null,this._updatingHandles=new ot.R,this._getSnappingContext=(0,rt.H)((e=>new Si({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new bn.c(new wn.XE("point",(0,Sn.Y6)(!0,!1,this.view.spatialReference))),visualizer:new nn})));const{view:t}=e;this._snappingManagerResult=yi(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,yn.z5)(2)}),this._constraintSnappingIndicator=new cn.r({view:t,attached:!0,width:1,renderOccluded:Ce.yD.OccludeAndTransparent,stipplePattern:(0,yn.z5)(5),isDecoration:!0});const n=se.Z.toUnitRGBA(pe);this._stagedStartIndicator=new mn({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:Ce.yD.OccludeAndTransparent,isDecoration:!0})}initialize(){var e;const{view:t}=this;this._snappingOperation=new Ti({view:t});const n=!(null!==(e=t._stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new xe.j({transparent:!0,writeDepth:!1,renderOccluded:Ce.yD.Opaque,isDecoration:!0}),this.addHandles((0,c.YP)((()=>({accentColor:ue(t.effectiveTheme),contrastColor:he(t.effectiveTheme)})),(e=>{let{accentColor:i,contrastColor:r}=e;const s=this._orientationManipulatorTexture,o=(0,lt.O)(t.textures,{accentColor:i,contrastColor:r,preMultiplyAlpha:n});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,null===s||void 0===s||s.release();const a=se.Z.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:a}),this._focusedOffsetManipulatorMaterial.setParameters({color:a}),this._thinOffsetManipulatorMaterial.setParameters({color:a}),this._constraintSnappingIndicator.color=a}),c.nn));const i=(0,c.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createManipulators(t)}));this.addHandles((0,o.ed)(i)),this.addHandles([(0,c.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(e=>{let{stagedPoint:t,stagedComputation:n}=e;if(null==n||null==t)return;const i=(0,M.WG)(t,new De.Z);this._applyPointUpdate(n,{endPoint:i})}),c.Z_),(0,c.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:r}=e;if(n===(null===t||void 0===t?void 0:t.stagedDimension)&&r===(null===t||void 0===t?void 0:t.firstGrabbedManipulator)){for(const s of[i,null===t||void 0===t?void 0:t.selectedComputation])if(null!=s){const t=this._computationManipulators.get(s);null!=t&&this._updateManipulators(s,t,e)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,e)}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.nn),(0,c.YP)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.YP)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,n=(0,w.c)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,Yt.Ob)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){var n;const e=null!==(n=this.view.inputManager.latestPointerType)&&void 0!==n?n:"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,st.R8)(this._snappingOperation.resnap(this._snappingManager,t)))}if(null!=e){const{start:t,end:n}=this._computationManipulators.get(e);if(t.grabbing||n.grabbing){!function(e,t,n){let{constraint:i,view:r}=n;const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:o,spatialReference:a}=r,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,d=o.fromRenderCoords(l,new De.Z,a),u=o.fromRenderCoords(c,new De.Z,a);let h;h="start"===t?{startPoint:d}:{endPoint:u},at(e,h,{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:r})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){var e;this._snappingOperation=(0,l.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(e=this._orientationManipulatorTexture)||void 0===e||e.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){var e;const t=this._stagedDimension,n=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==n||n.dimension!==t?null:n}get _constraintHandles(){return[(0,c.gx)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...c.tX,equals:it.fS}),(0,c.YP)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:n}=e.dimension;return{measureType:t,orientation:n,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:n,computation:i}=e;switch(i.previousConstraint){case et.Horizontal:i.preConstraintProperties={measureType:p.n.Horizontal,orientation:0};break;case et.Vertical:i.preConstraintProperties={measureType:p.n.Vertical,orientation:0};break;case et.Direct:i.preConstraintProperties={measureType:p.n.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:t,orientation:n}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),c.Z_)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(t=>{let{stagedComputation:n,activeComputation:i}=t;const r=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=i)if(i===n)r.attached=!0;else{const{start:t,end:n}=this._computationManipulators.get(i),s=()=>{r.attached=t.grabbing||n.grabbing};s(),this.addHandles([t.events.on("grab-changed",s),n.events.on("grab-changed",s)],e)}else r.attached=!1})),(0,c.YP)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(e=>{let{geometry:t,constraint:n}=e;const i=this._constraintSnappingIndicator;null!=t&&null!=n&&n!==et.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:n}=e;if("touch"===n)return;const i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,st.R8)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:n}=e,i=t;if("mouse"===n){const e=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:e})}const r=new tt.Z({startPoint:(0,M.WG)(i,new De.Z),endPoint:null,measureType:p.n.Horizontal});return this._stagedDimension=r,this._resetSnappingState(),r}_onStagedClick(e){let{mapPoint:t,pointerType:n}=e;const i=this._stagedComputation;if(null==i)return;let r=t;if("mouse"===n){const e=this._getSnappingContext(n);r=this._snappingManager.update({point:t,context:e})}const s=(0,M.WG)(r,new De.Z);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),s=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,p.n.Direct),a=this._setupMeasureTypeManipulator(e,p.n.Horizontal),l=this._setupMeasureTypeManipulator(e,p.n.Vertical),c=new Ee({start:t,end:n,offset:i,heading:r,rotation:s,direct:o,horizontal:a,vertical:l});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of c.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.YP)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.tX,equals:it.fS})],e)}_setupPointManipulator(e,t){const{view:n}=this,{dimension:i}=e,r=new Ae(n,{metadata:i}),s=function(e,t){let{isStart:n,createSnappingPipelineStep:i,dimension:r,onUpdate:s,view:o}=t;const a=n?"startPoint":"endPoint",l=(0,Te.Xd)(e,((e,t,n,l)=>{const c=(0,ye.J4)(e),{snappingStep:d,cancelSnapping:u}=i(l);n=n.next(c).next((0,Te.di)(r,[a,"measureType","orientation"])).next(u),t.next(c).next((0,ye.gv)(o)).next(...d).next((e=>{const t=(0,M.WG)(e.mapEnd,new De.Z);s("startPoint"===a?{startPoint:t}:{endPoint:t})}))}));return[l]}(r,{isStart:t.isStart,createSnappingPipelineStep:e=>Pi({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:t=>this._applyPointUpdate(e,t),view:n});return this._computationHandles.add(s,e),r}_setupOffsetManipulator(e){const{view:t}=this,n=function(e,t){const n=[(0,w.f)(-.5,0,0),(0,w.f)(.5,0,0)],i=(0,Pe.rh)(t.unfocusedMaterial,n.map((e=>(0,S.i)((0,w.c)(),e,.5)))),r=i.instantiate({material:t.focusedMaterial});return new me.Z({view:e,renderObjects:[new ve.r(i,Oe.Q9.Unfocused|Oe.Q9.Selected|Xe),new ve.r(r,Oe.Q9.Focused|Xe)],collisionType:{type:"line",paths:[n]},radius:Ye(t.lineSizePt)/2,metadata:t.metadata,available:!1,...ge.X9})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,Te.Xd)(e,((e,t,r)=>{if(!ne(n)||!e.selected)return;const{geometry:s,dimension:o}=n,a=(0,ye.J4)(e);t.next(a).next(Ve(i,o,s.dimensionSegment,s.primaryOffsetAxis)),r.next(a).next((0,Te.di)(o,["offset"]))}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupHeadingManipulator(e){const{view:t}=this,n=new ze(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,Te.Xd)(e,((e,t,r)=>{Ge({cancel:r,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupRotationManipulator(e){const{view:t}=this,n=new ze(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=je(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupMeasureTypeManipulator(e,t){const{view:n}=this,i=function(e,t){const n=[(0,w.f)(-.5,0,0),(0,w.f)(.5,0,0)],i=(0,Pe.rh)(t.thinOffsetManipulatorMaterial,n),r=(0,Pe.rh)(t.unfocusedMaterial,n.map((e=>(0,S.i)((0,w.c)(),e,.5)))),s=r.instantiate({material:t.focusedMaterial});return new me.Z({view:e,renderObjects:[new ve.r(r,Oe.Q9.Unfocused|Xe),new ve.r(s,Oe.Q9.Focused|Xe),new ve.r(i,Xe)],collisionType:{type:"line",paths:[n]},radius:Ye(t.lineSizePt)/2,available:!1,metadata:t.metadata,...ge.X9})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),r=He(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(r,e),i}_updateManipulators(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:i,selectedComputation:r,firstGrabbedManipulator:s}=n,{start:o,end:a,offset:l,heading:c,rotation:d}=t,u=r===e,h=ne(e),{dimension:f}=e;for(const p of t.values()){const e=h&&null==i&&(null==s||p===s);p===l?(p.available=e,p.selected=u):p.available=e&&u}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(f.measureType).available=!1;for(const g of[c,d])f.measureType===p.n.Direct&&0!==f.offset||(g.available=!1);Y(e)?d.available=!1:c.available=!1;const{geometry:_}=e;o.renderLocation=_.directSegment.startRenderSpace,a.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:m}=this.view;(function(e,t,n){const{dimensionSegment:i,primaryOffsetAxis:r}=t,s=J(Qe,t),o=(0,S.h)(s,w.Z)?(0,v.g)(Ke):(0,ge.Aq)(s,r,w.Z,Ke),a=Math.max((0,S.l)(s),.1/n.unitInMeters);(0,v.b)(o,o,(0,S.s)(Qe,a,a,a)),e.modelTransform=o,e.renderLocation=i.eval(.5,Qe)})(l,_,m),c.available&&function(e,t,n){ke(e,t,n,{forHeading:!0})}(c,e,m),d.available&&function(e,t,n){ke(e,t,n,{forHeading:!1})}(d,e,m),t.forEachMeasureTypeManipulator(((t,n)=>{t.available&&function(e,t,n,i){const{geometry:r}=t,s=I($e,n,t,i),o=U(Qe,{measureType:n,directSegment:r.directSegment,renderCoordsHelper:i}),a=(0,S.u)(Je,s.endRenderSpace,s.startRenderSpace),l=(0,ge.Aq)(a,o,w.Z,Ke),c=(0,S.l)(a);(0,v.b)(l,l,(0,S.s)(Je,c,c,c)),e.modelTransform=l,e.renderLocation=s.eval(.5,Je)}(t,e,n,m)}))}_updateManipulatorStyle(e){const t=function(e){return(0,ae.F2)(e)+4}(e),n=Ye(e),i={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:r,heading:s,rotation:o}of this._computationManipulators.values())r.radius=n/2,s.update(i),o.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(e,t){const{view:n}=this,i=H(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);const r=V(i,n.renderCoordsHelper);if(null==r)return;const s=this._computeConstraint({...i,geometry:r});at(e,t,{...i,constraint:s,unconstrainedGeometry:r,view:n}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,Di);const t=this.view.state.camera.computeScreenPixelSizeAt(Di);e.dimension.offset=50*t}_computeConstraint(e){return function(e,t){if(ee(e))return et.Direct;if(!e.enabled)return null;const{geometry:n}=e;if(null==n||(0,S.h)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=t.state,r=X(P.WM.get(),n,t.renderCoordsHelper),s=Q(P.WM.get(),n),o=(0,S.i)(P.WM.get(),r,(0,S.j)(s,r)),a=(0,S.f)(P.WM.get(),s,o),l=(0,S.m)(a),c=(0,S.m)(o),{startRenderSpace:d,endRenderSpace:u}=n.directSegment,h=Math.max(10*i.computeScreenPixelSizeAt(d),10*i.computeScreenPixelSizeAt(u))**2;return l<h?et.Vertical:c<h?et.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Re.U({width:1,renderOccluded:Ce.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const e=e=>{var t;return null===(t=this.analysisViewData.computations.find((t=>{let{computation:n}=t;return n.dimension===e})))||void 0===t?void 0:t.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=Ce.yD.Occlude,this.manipulators.forEach((e=>{let{manipulator:t}=e;for(const{geometry:n}of t.renderObjects)n.material.setParameters({renderOccluded:Ce.yD.Occlude})}))},getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const n=e(t);return null!=n?this._computeConstraint(n):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,r._)([(0,d.Cb)({constructOnly:!0})],Oi.prototype,"analysis",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Oi.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Oi.prototype,"manipulators",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Oi.prototype,"parentTool",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Oi.prototype,"view",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],Oi.prototype,"updating",null),(0,r._)([(0,d.Cb)()],Oi.prototype,"firstGrabbedManipulator",null),(0,r._)([(0,d.Cb)()],Oi.prototype,"hasGrabbedManipulators",null),(0,r._)([(0,d.Cb)()],Oi.prototype,"snappingOptions",null),(0,r._)([(0,d.Cb)()],Oi.prototype,"_stagedDimension",void 0),(0,r._)([(0,d.Cb)()],Oi.prototype,"_activeComputation",null),(0,r._)([(0,d.Cb)()],Oi.prototype,"_stagedComputation",null),Oi=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],Oi);const Di=(0,w.c)();var Ei,Ai=n(88153),zi=n(54463),Li=n(76365),ji=n(87888),Gi=n(72612);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Ei||(Ei={}));let Hi=class extends Li.f{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,Ai.Z8)(this.view.state.viewingMode),this._intersector.options.store=zi.eC.MIN,this._lengthDimensionSubTool=new Oi({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.ed)(this._lengthDimensionSubTool),(0,o.kB)((()=>this._clearPointerMoveTimeout())),(0,c.YP)((()=>this.state),(e=>{e===Ei.Created&&this.finishToolCreation()}),c.tX),(0,c.gx)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.tX),(0,c.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.tX)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?Ei.Creating:Ei.Created:Ei.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(ji.Sn.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else ji.Sn.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,Gi.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const n=this._intersector.results.min,i=P.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=Xe)),this._prevPointerMoveTimeout=re.m.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~Xe))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,r._)([(0,d.Cb)({constructOnly:!0})],Hi.prototype,"view",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Hi.prototype,"analysis",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],Hi.prototype,"state",null),(0,r._)([(0,d.Cb)({readOnly:!0})],Hi.prototype,"updating",null),(0,r._)([(0,d.Cb)({readOnly:!0})],Hi.prototype,"cursor",null),(0,r._)([(0,d.Cb)({constructOnly:!0})],Hi.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)()],Hi.prototype,"selectedDimension",null),(0,r._)([(0,d.Cb)()],Hi.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,d.Cb)()],Hi.prototype,"_activeSubTool",void 0),(0,r._)([(0,d.Cb)()],Hi.prototype,"_lengthDimensionSubTool",void 0),Hi=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Hi);n(59166);var Vi=n(58935),Fi=n(61201),ki=n(79685),Ii=n(21317);class Ni extends dn._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=Ce.yD.OccludeAndTransparent,this._width=1,this._color=(0,ut.f)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=(0,v.d)(Zi,n),this._normal=t;const{points:i}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,ut.c)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Ii.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,ki.c)(this.geometry,this.normal)){const n=(0,ki.Y)(this._material,t);e.addGeometry(n)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const Zi=(0,y.a)();class qi{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new nt.Z,this._messages=null,this._labelSegment=new x.y;const{analysis:t,computation:n,view:i,messages:r,isDecoration:s}=e;this.analysis=t,this.computation=n,this.view=i,this._messages=r;const o=e.visible,a={view:i,attached:o,isDecoration:s},{fontSize:l,textColor:d,textBackgroundColor:u}=t.style;this._visualElements=new Bi({marker:new Ni(a,e.markerMaterial),dimension:new cn.r(a,e.dimensionLineMaterial),startOffset:new cn.r(a,e.offsetLineMaterial),endOffset:new cn.r(a,e.offsetLineMaterial),dimensionSmall:new cn.r(a,e.smallDimensionLineMaterial),startOffsetSmall:new cn.r(a,e.smallOffsetLineMaterial),endOffsetSmall:new cn.r(a,e.smallOffsetLineMaterial),label:new Fi.Kc({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ae.F2)(l),textColor:d.clone(),backgroundColor:u.clone(),isDecoration:s})}),this._handles.add([(0,c.YP)((()=>n.geometry),(e=>{this.updateCameraDependentElements(i.state.camera,e,t.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...c.nn,equals:it.fS}),(0,c.YP)((()=>n.length),(e=>this._updateLabelContent(e)),c.nn)])}destroy(){this.destroyed=!0,this._handles=(0,l.SC)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=F(Ui,k.Start,e.directSegment,e.dimensionSegment),n=F(Wi,k.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(n),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const i=this._visualElements;if(null==t){for(const e of i.values())e.visible=!1;return}const r=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Yi)),s=function(e,t){return(0,S.m)(J($,e))/t**2}(t,r),o=s<(2*(0,ae.F2)(n.lineSize))**2,a=!o;i.marker.visible=a,i.dimension.visible=a,i.startOffset.visible=a,i.endOffset.visible=a,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,ae.F2)(n.fontSize),{label:c}=i;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:d,primaryOffsetAxis:u}=t,{offset:h}=this.computation.dimension,p=(Math.sign(h)>=0?1:-1)*this._labelOffsetPx(n)*r;(function(e,t,n,i){(0,S.q)(e.startRenderSpace,t.startRenderSpace,n,i),(0,S.q)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,d,u,p),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,ae.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,Vi.VG)(this._messages,e,e.unit):t.text=""}_labelOffsetPx(e){return 1.5*(0,ae.F2)(e.fontSize)+20+(0,ae.F2)(e.lineSize/2)}}const Ui=new x.y,Wi=new x.y,Yi=(0,w.c)();class Bi{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Xi=n(33720),Qi=n(36257),Ji=n(41201);let Ki=class extends s.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new Ii.X({width:1,anchor:Xi.i5.Tip,color:le.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Ce.yD.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new Re.U({width:1,color:le.Z,renderOccluded:Ce.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new Re.U({width:1,color:le.Z,renderOccluded:Ce.yD.OccludeAndTransparent,stipplePattern:(0,yn.z5)(5),isDecoration:e}),this._smallDimensionLineMaterial=new Re.U({width:1,color:le.Z,renderOccluded:Ce.yD.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new Re.U({width:1,color:le.Z,renderOccluded:Ce.yD.OccludeAndTransparent,stipplePattern:(0,yn.z5)(5),isDecoration:e});for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles((0,o.kB)((()=>{var e;null===(e=this.view._stage)||void 0===e||e.remove(n)})));const t=(0,c.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createVisualization(t)}));this._dimensionVisualizations=t,this.addHandles([(0,o.ed)(t),(0,c.YP)((()=>se.Z.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(e=>{const t=(0,ae.F2)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:n})}),c.tX),(0,c.YP)((()=>({camera:this.view.state.camera,style:$i(this.analysis)})),(e=>{let{camera:t,style:n}=e;for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(t,i.computation.geometry,n),i.updateLabelStyle(n)})),(0,c.YP)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Qi.qe)((()=>this._updateMessageBundle())),(0,c.gx)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),c.Z_)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map((e=>{let{visualization:t}=e;return t})),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:Ce.yD.Occlude})}}}_createVisualization(e){const t=new qi({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Ji.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function $i(e){const{fontSize:t,lineSize:n,textColor:i,textBackgroundColor:r}=e.style;return{fontSize:t,lineSize:n,textBackgroundColor:r.clone(),textColor:i.clone()}}(0,r._)([(0,d.Cb)({constructOnly:!0})],Ki.prototype,"analysisViewData",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Ki.prototype,"view",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0})],Ki.prototype,"isDecoration",void 0),(0,r._)([(0,d.Cb)()],Ki.prototype,"analysis",null),(0,r._)([(0,d.Cb)()],Ki.prototype,"visible",null),(0,r._)([(0,d.Cb)()],Ki.prototype,"loadingMessages",void 0),Ki=(0,r._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Ki);let er=class extends s.Z{constructor(e){super(e),this.dimension=null,this.length=null}};(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],er.prototype,"dimension",void 0),(0,r._)([(0,d.Cb)()],er.prototype,"length",void 0),er=(0,r._)([(0,u.j)("esri.views.3d.analysis.LengthDimensionResult")],er);const tr=er;let nr=class extends s.Z{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...n}=e;return{result:new tr({dimension:t}),...n}}initialize(){this.addHandles([(0,c.YP)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.tX),(0,c.YP)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],nr.prototype,"result",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],nr.prototype,"projectAndAlignPoint",void 0),(0,r._)([(0,d.Cb)()],nr.prototype,"dimension",null),(0,r._)([(0,d.Cb)()],nr.prototype,"length",null),(0,r._)([(0,d.Cb)()],nr.prototype,"geometry",void 0),(0,r._)([(0,d.Cb)()],nr.prototype,"unconstrainedGeometry",void 0),(0,r._)([(0,d.Cb)()],nr.prototype,"elevationAlignedStartPoint",void 0),(0,r._)([(0,d.Cb)()],nr.prototype,"elevationAlignedEndPoint",void 0),(0,r._)([(0,d.Cb)()],nr.prototype,"preConstraintProperties",void 0),(0,r._)([(0,d.Cb)()],nr.prototype,"previousConstraint",void 0),nr=(0,r._)([(0,u.j)("esri.views.3d.analysis.LengthDimensionComputation")],nr);var ir=n(33906),rr=n(70209);const sr=e=>{let t=class extends e{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new Cn.Z}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,r._)([(0,d.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,r._)([(0,d.Cb)()],t.prototype,"tool",void 0),(0,r._)([(0,d.Cb)({readOnly:!0})],t.prototype,"results",null),(0,r._)([(0,d.Cb)()],t.prototype,"selectedDimension",void 0),(0,r._)([(0,d.Cb)()],t.prototype,"interactive",void 0),(0,r._)([(0,d.Cb)()],t.prototype,"visible",void 0),t=(0,r._)([(0,u.j)("esri.views.analysis.DimensionAnalysisView")],t),t};let or=class extends(sr((0,h.p)(s.Z))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:n}=this.view,i=(0,ir.G)(e,t,n);return null==i&&(0,ir.e)(this.analysis,e.spatialReference,a.Z.getLogger(this)),i};const e=(0,c.wZ)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,rr.Lp)(this,Hi),(0,o.ed)(e)]),this._analysisVisualization=new Ki({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new ie({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.IM)(this._placementTask),this._analysisVisualization=(0,l.SC)(this._analysisVisualization),(0,rr.Yq)(this)}get updating(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.IM)(this._placementTask),this._placementTask=(0,rr.Er)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,n=new nr({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,r._)([(0,d.Cb)({readOnly:!0})],or.prototype,"type",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"tool",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"updating",null),(0,r._)([(0,d.Cb)({readOnly:!0})],or.prototype,"results",null),(0,r._)([(0,d.Cb)()],or.prototype,"computations",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"selectedDimension",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"selectedComputation",null),(0,r._)([(0,d.Cb)()],or.prototype,"_analysisVisualization",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"_analysisController",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"_dimensionsToComputations",void 0),(0,r._)([(0,d.Cb)()],or.prototype,"_placementTask",void 0),or=(0,r._)([(0,u.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],or);const ar=or},19182:(e,t,n)=>{n.d(t,{i:()=>y});var i=n(27366),r=n(7138),s=n(79056),o=n(49861),a=(n(25243),n(63780),n(93169),n(69912)),l=n(26279),c=n(78289),d=n(78485);class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.eZ.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const n=null===(t=this._resources)||void 0===t?void 0:t.layerView;n&&(n.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),n=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:t,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(n)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.T.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,s.IG)(r.Z)){constructor(e){super(e),this.drapeSourceType=l.Lw.Features,this.updatePolicy=d.j.SYNC,this.renderGroup=l.eZ.Outline}};(0,i._)([(0,o.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,i._)([(0,o.Cb)()],h.prototype,"renderGroup",void 0),h=(0,i._)([(0,a.j)("DrapedVisualElementLayerView")],h);var p=n(86244),f=n(94172),_=n(79100),m=n(66327),g=n(97882);class v{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==_.U.Mesh&&t.type!==_.U.Line&&t.type!==_.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==_.U.Mesh&&t.type!==_.U.Line&&t.type!==_.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,n=t._stage;if(!n)return;const i=new g.F(n,{pickable:!1,updatePolicy:d.j.SYNC}),r=new m.T({castShadow:!1}),s=e.createResources(r,i);s.forEach((e=>{n.add(e),e.type===_.U.Texture&&e.load(n.renderView.renderingContext)})),n.add(r),i.add(r);const o=e.cameraChanged,a=o?(0,f.YP)((()=>t.state.camera),(e=>o(e)),f.nn):null;this._resources={layer:i,object:r,external:s,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const t=this._resourceFactory.view._stage;t&&(t.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{t.remove(e),e.type===_.U.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.l{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new v(this.createObject3DResourceFactory(e.view)),this.drapedResources=new u(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},98917:(e,t,n)=>{n.d(t,{R:()=>b});var i=n(94172),r=n(14226),s=n(81949),o=n(11186),a=n(71353),l=n(90045),c=n(67077),d=n(51378),u=n(55946),h=n(19182),p=n(19265),f=n(91526),_=n(40779),m=n(70619),g=n(56529),v=n(39077),y=n(4760),S=n(66832),w=n(58901);class b extends h.i{constructor(e){super(e),this._maxSize=0,this._position=(0,a.c)(),this._up=(0,a.c)(),this._right=(0,a.c)(),this._renderOccluded=g.yD.OccludeAndTransparent,this._color=(0,c.f)(1,0,0,1),this._outlineColor=(0,c.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=g.yD.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:n,next:i}=e;this._maxSize=Math.min((0,o.o)(n,t),(0,o.o)(n,i))/3,(0,o.n)(this._up,(0,o.f)(this._up,t,n)),(0,o.n)(this._right,(0,o.f)(this._right,i,n)),(0,o.c)(this._position,n),this.recreateGeometry()}_createObject3DResources(e){const t=new S.E(this._quadMaterialParameters),n=0===this._outlineSize?void 0:new w.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n,forEach:e=>{e(t),n&&e(n)}}}_createObject3DGeometries(e,t,n){if((0,o.h)(this._up,a.Z)&&(0,o.h)(this._right,a.Z))return;const i=this._createGeometries(t,n);for(const r of i)e.addGeometry(r);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new S.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new w.U(this._outlineMaterialParameters),n=this._createGeometries(e,t).map((e=>new v.z(e)));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:(0,i.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:n,right:i,corner:r}=this._getVertices(),s=this._quadGeometryData(n,i,r,e);return t?[s,(0,m.rh)(t,[n,r,i])]:[s]}_getVertices(){let e=this._up,t=this._right;const n=(0,o.g)(d.WM.get(),e,t);return this.isDraped&&(e=(0,o.c)(d.WM.get(),e),t=(0,o.c)(d.WM.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,r.d)(P,this._position),(0,r.b)(P,P,[i,i,i]),e.transformation=P}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{_position:i,_size:s}=this,a=(0,o.c)(d.WM.get(),i);a[2]=p.gi;const l=C;l.spatialReference=t.renderer.spatialReference,l.x=a[0],l.y=a[1];const c=s*(this.view.overlayPixelSizeInMapUnits(l)*n),u=Math.min(this._maxSize,c);(0,r.d)(P,a),(0,r.b)(P,P,[u,u,1]);for(const r of e)r.transformation=P}_quadGeometryData(e,t,n,i){return new _.Z(i,[[y.T.POSITION,new f.a([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}const P=(0,s.a)(),C=(0,u.T)(0,0,void 0,null)},87888:(e,t,n)=>{n.d(t,{Kj:()=>r,Sn:()=>i});const i={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},r={toggle:"Control"}},44179:(e,t,n)=>{n.d(t,{Hk:()=>_,M8:()=>j,aU:()=>A,jg:()=>z,kt:()=>S,ku:()=>g});var i=n(63780),r=n(88396),s=n(6394),o=n(11186),a=n(71353),l=n(55652),c=n(40885),d=n(23470),u=n(38054),h=n(55793),p=n(94163);class f{intersect(e){return G(this,e)}closestPoints(e){return[this.closestTo(e)]}}class _ extends f{constructor(e){super(),this.point=e}equals(e){return this===e||X(e)&&(0,o.h)(this.point,e.point)}closestTo(){return(0,u.d9)(this.point)}}class m extends f{constructor(e,t,n){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:n}}equals(e){return this===e||Q(e)&&this.lineLike.type===e.lineLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){const t=(0,h.ZE)(e,this.lineLike);return(0,u.uo)(t)}}class g extends m{constructor(e,t){super(e,t,p.SP.LINE)}}class v extends m{constructor(e,t){super(e,t,p.SP.RAY)}}class y extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||B(e)&&(0,i.fS)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,n=1/0;for(const i of this.constraints){const r=i.closestTo(e),s=(0,o.a)(e,r);s<n&&(n=s,t=r)}return t?(0,u.d9)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class S extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||$(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,h.sc)(e,this.center,this.radius);return(0,u.uo)(t)}}class w extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ee(e)&&(0,o.h)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,h.sc)(e,this.center,this.radius);return t[2]=this.center[2],(0,u.uo)(t)}asCircle(){return new b((0,u.d9)(this.center),this.radius,(0,u.al)(0,0,1))}}class b extends f{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=n,this.slicePlane=i}equals(e){return this===e||te(e)&&(0,o.h)(this.center,e.center)&&(0,o.h)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:n}=this;(0,l.nF)(this.getPlane(C),e,P);const i=(0,o.u)(P,P,t),r=(0,o.m)(i);if((0,h.hA)(r,0))return(0,u.d9)(e);const s=n/Math.sqrt(r),c=(0,o.q)((0,a.c)(),t,i,s),{slicePlane:d}=this;if(d&&!(0,h.zf)(d,c)){var p;const t=V(d,this);return null!==(p=null===t||void 0===t?void 0:t.closestTo(e))&&void 0!==p?p:(0,u.d9)(e)}return(0,u.uo)(c)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();return(0,l.Yq)(this.center,this.normal,e)}}const P=(0,a.c)(),C=(0,l.Ue)();class M extends f{constructor(e){super(),this.z=e}equals(e){return this===e||J(e)&&this.z===e.z}closestTo(e){return(0,u.uo)((0,a.f)(e[0],e[1],this.z))}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();return(0,o.s)(x,0,0,this.z),(0,l.Yq)(x,a.d,e)}}const x=(0,a.c)();class R extends f{constructor(e,t,n){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:n}}equals(e){return this===e||K(e)&&this.planeLike.type===e.planeLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){return(0,u.uo)((0,h.z9)(e,this.planeLike))}closestEndTo(e){const{start:t,end:n}=this;return Math.sign((0,r.g)((0,r.c)(T,n,t),(0,r.c)(O,e,t)))>0?n:t}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();const t=(0,o.c)(D,this.end);return t[2]+=1,(0,l.zk)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();const{start:t,end:n,type:i}=this.planeLike;if(i===h.Jk.PLANE)return;const r=(0,o.s)(D,t[0],t[1],0),s=(0,o.s)(E,n[0],n[1],0),a=(0,o.f)(E,s,r);return(0,l.Yq)(r,a,e),e}}const T=(0,s.a)(),O=(0,s.a)(),D=(0,a.c)(),E=(0,a.c)();class A extends R{constructor(e,t){super(e,t,h.Jk.HALF_PLANE)}}class z extends R{constructor(e,t){super(e,t,h.Jk.PLANE)}}class L extends f{constructor(e,t){super(),this.sphere=(0,d.k)(e,t)}equals(e){return this===e||ne(e)&&(0,d.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,d.p)(this.sphere,e,(0,a.c)());return(0,u.uo)(t)}get center(){return this.sphere}get radius(){return this.sphere[3]}}class j extends f{constructor(e,t,n){super(),this.start=e,this.end=t,this.getZ=n,this.planeLike={start:e,end:t,type:h.Jk.PLANE}}equals(e){return this===e||ie(e)&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){var n;const i=(0,h.z9)(t,e.planeLike);return i[2]=null!==(n=e.getZ(i[0],i[1]))&&void 0!==n?n:re,(0,u.uo)(i)}(this,e)}addIfOnTheGround(e,t){for(const i of t){var n;const t=null!==(n=this.getZ(i[0],i[1]))&&void 0!==n?n:0;(0,h.hA)(i[2],t)&&(i[2]=t,e.push(i))}}}function G(e,t){if(B(e)){const n=[];for(const i of e.constraints){const e=i.intersect(t);e&&n.push(e)}return Y(n)}if(B(t))return G(t,e);if(ie(e))return Z(e,t);if(ie(t))return Z(t,e);if(X(e)){const{point:n}=e,i=t.closestTo(n);return(0,o.G)(i,n)?e:void 0}if(Q(e)){if(X(t))return G(t,e);if(Q(t))return U((0,h.Au)(e.lineLike,t.lineLike));if(J(t))return H(e,t);if(K(t))return U((0,h.fK)(t.planeLike,e.lineLike));if($(t))return U((0,h.CJ)(e.lineLike,t.center,t.radius));if(te(t))return U((0,h.UG)(e.lineLike,t));if(ee(t))return function(e,t){let{lineLike:n}=e,{center:i,radius:r}=t;const s=i[2];return U((0,h.CJ)(n,i,r).filter((e=>(0,h.hA)(e[2],s))))}(e,t);if(ne(t))return function(e,t){let{lineLike:n}=e,{sphere:i}=t;return U((0,d.m)(i,n.start,n.end))}(e,t)}else if(J(e)){if(X(t)||Q(t))return G(t,e);if(J(t))return function(e,t){return(0,h.hA)(e.z,t.z)?e:void 0}(e,t);if(K(t))return function(e,t){let{z:n}=e,{planeLike:i}=t;const[r,s]=i.start,[o,a]=i.end,l=(0,u.al)(r,s,n),c=(0,u.al)(o,a,n);return i.type===h.Jk.PLANE?new g(l,c):new v(l,c)}(e,t);if($(t))return function(e,t){const[n,i]=t.center;return new w((0,u.al)(n,i,e.z),t.radius)}(e,t);if(te(t))return F(e,t);if(ee(t))return function(e,t){return(0,h.hA)(t.center[2],e.z)?t:void 0}(e,t);if(ne(t))return function(e,t){let{center:n,radius:i}=t;const r=Math.abs(n[2]-e.z);if(r>i&&!(0,h.hA)(r,i))return;const s=(0,u.al)(n[0],n[1],e.z),o=Math.sqrt(i**2-r**2);return(0,h.hA)(o,0)?void 0:new w(s,o)}(e,t)}else if(K(e)){if(X(t)||Q(t)||J(t))return G(t,e);if(K(t))return q((0,h.Nn)(e.planeLike,t.planeLike));if($(t))return q((0,h.SD)(e.planeLike,t.center,t.radius));if(te(t))return I(e,t);if(ee(t))return k(e,t);if(ne(t))return N(e,t)}else if($(e)){if(X(t)||Q(t)||J(t)||K(t))return G(t,e);if($(t))return q((0,h.Yf)(e.center,e.radius,t.center,t.radius));if(te(t))return;if(ee(t))return function(e,t){const n=(0,r.k)(e.center,t.center);return(0,h.hA)(n,0)&&(0,h.hA)(e.radius,t.radius)?t:W((0,h.Yf)(e.center,e.radius,t.center,t.radius),t.center[2])}(e,t);if(ne(t))return}else if(te(e)){if(X(t)||Q(t)||J(t)||K(t)||$(t))return G(t,e);if(te(t))return;if(ee(t))return void t.asCircle();if(ne(t))return}else if(ee(e)){if(X(t)||Q(t)||J(t)||K(t)||$(t)||te(t))return G(t,e);if(ee(t))return function(e,t){if(!(0,h.$7)(e.center,t.center))return;const n=(0,r.k)(e.center,t.center);return(0,h.hA)(n,0)&&(0,h.hA)(e.radius,t.radius)?e:W((0,h.Yf)(e.center,e.radius,t.center,t.radius),e.center[2])}(t,e);if(ne(t))return}else if(ne(e)){if(X(t)||Q(t)||J(t)||K(t)||$(t)||ee(t))return G(t,e);if(ne(t))return}}const H=(()=>{const e=(0,l.Ue)();return(t,n)=>{const{start:i,end:r}=t;if((0,h.$7)(i,r)&&(0,h.hA)(i[2],n.z))return t;const s=(0,a.c)();return(0,l.fn)(n.getPlane(e),i,r,s)?new _((0,u.uo)(s)):void 0}})();const V=(()=>{const e=(0,c.Ue)(),t=(0,l.Ue)(),n={start:(0,a.c)(),end:(0,a.c)(),type:p.SP.LINE};return(i,r,s)=>{const{normal:c,center:d,radius:p}=r,f=(0,o.j)(c,(0,l.mJ)(i)),m=(0,h.hA)((0,l.TE)(i,d),0);if((0,h.hA)(f,1))return m?r:void 0;if(r.getPlane(t),m&&(0,h.hA)(f,0)&&(0,l.cp)(i)&&(0,l.cp)(t)){if((0,h.hA)(p,0))return!s||(0,h.zf)(s,d)?new _((0,u.d9)(d)):void 0;const e=(0,a.g)(d);e[2]+=p;const t=(0,a.g)(d);t[2]-=p;const n=[];return s&&!(0,h.zf)(s,e)||n.push(e),s&&!(0,h.zf)(s,t)||n.push(t),U(n)}if(!(0,l.wm)(i,t,e))return;(0,o.c)(n.start,e.origin),(0,o.g)(n.end,e.origin,e.direction);const g=(0,h.UG)(n,r);return U(s?(0,h.rq)(s,g):g)}})();const F=(()=>{const e=(0,l.Ue)();return(t,n)=>V(t.getPlane(e),n)})();const k=(()=>{const e=(0,l.Ue)();return(t,n)=>{let{center:i,radius:r}=n;const s=(0,h.SD)(t.planeLike,i,r),o=i[2];t.getSlicePlane(e);const a=[];for(const[l,c]of s){const t=[l,c,o];(0,h.zf)(e,t)&&a.push(t)}return U(a)}})(),I=(()=>{const e=(0,l.Ue)(),t=(0,l.Ue)();return(n,i)=>V(n.getPlane(e),i,n.getSlicePlane(t))})(),N=(()=>{const e=(0,l.Ue)();return(t,n)=>{let{center:i,radius:r}=n;const s=t.getPlane(e),c=(0,l.jH)(s,i),d=Math.abs(c);if(d>r&&!(0,h.hA)(d,r))return;const p=(0,a.g)((0,l.mJ)(s)),f=(0,o.q)((0,a.c)(),i,p,c),m=Math.sqrt(r**2-c**2);return(0,h.hA)(m,0)?new _((0,u.uo)((0,l.nF)(s,i,(0,a.c)()))):new b((0,u.uo)(f),m,p,t.getSlicePlane())}})();function Z(e,t){const{planeLike:n,getZ:i}=e,r=[];if(X(t))e.addIfOnTheGround(r,(0,h.hm)(n,t.point));else if(Q(t))e.addIfOnTheGround(r,(0,h.fK)(n,t.lineLike));else if($(t))for(const[o,l]of(0,h.SD)(n,t.center,t.radius)){const e=i(o,l);null!=e&&r.push((0,a.f)(o,l,e))}else if(K(t)||ie(t))for(const[o,l]of(0,h.Nn)(n,t.planeLike)){var s;const e=null!==(s=i(o,l))&&void 0!==s?s:re;r.push((0,a.f)(o,l,e))}return U(r)}function q(e){return Y(e.map((e=>{let[t,n]=e;const i=(0,u.al)(t,n,0),r=(0,u.al)(t,n,1);return new g(i,r)})))}function U(e){return Y(e.map((e=>e?new _((0,u.uo)(e)):void 0)))}function W(e,t){return U(e.map((e=>{let[n,i]=e;return[n,i,t]})))}function Y(e){var t;if(0!==e.length)return 1===e.length?null!==(t=e[0])&&void 0!==t?t:void 0:new y(e.filter(i.pC))}function B(e){return e instanceof y}function X(e){return e instanceof _}function Q(e){return e instanceof m}function J(e){return e instanceof M}function K(e){return e instanceof R}function $(e){return e instanceof S}function ee(e){return e instanceof w}function te(e){return e instanceof b}function ne(e){return e instanceof L}function ie(e){return e instanceof j}const re=0},38054:(e,t,n)=>{n.d(t,{Ju:()=>h,SN:()=>u,Ue:()=>o,al:()=>l,d9:()=>c,j7:()=>d,uo:()=>a});var i=n(71353),r=n(55946),s=n(74509);function o(e,t,n){return(0,i.f)(e,t,n)}function a(e){return e}function l(e,t,n){return(0,i.f)(e,t,n)}function c(e){return(0,i.g)(e)}function d(e,t,n){let{coordinateHelper:i,elevationInfo:r}=n;return e?u(i.vectorToDehydratedPoint(e,p),t,r):null}function u(e,t,n){var r,o;if(null==e)return null;if(null==t)return(0,i.f)(e.x,e.y,null!==(r=e.z)&&void 0!==r?r:0);if("2d"===t.type)return(0,i.f)(e.x,e.y,0);const a=null!==(o=(0,s.vQ)(t,e,n,s.jG))&&void 0!==o?o:0;return(0,i.f)(e.x,e.y,a)}function h(e,t){return(0,r.T)(e[0],e[1],e[2],t)}const p=(0,r.T)(0,0,0,null)},80371:(e,t,n)=>{var i;n.d(t,{B:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},97760:(e,t,n)=>{n.d(t,{k:()=>a});var i=n(44179),r=n(64674),s=n(75691),o=n(53397);class a extends s.a{constructor(e){super({...e,isDraped:!0,constraint:new i.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(r.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95905:(e,t,n)=>{n.d(t,{L:()=>a});var i=n(44179),r=n(64674),s=n(75691),o=n(53397);class a extends s.a{constructor(e){super({...e,constraint:new i.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(r.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75691:(e,t,n)=>{n.d(t,{a:()=>s});var i=n(80371),r=n(92605);class s extends r.j{constructor(e){let{targetPoint:t,objectId:n,constraint:r,isDraped:s}=e;super(t,r,s,i.B.FEATURE),this.objectId=n}}},92605:(e,t,n)=>{n.d(t,{j:()=>i});class i{constructor(e,t,n,i){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=i}}},53397:(e,t,n)=>{n.d(t,{w:()=>o});n(93169),n(32718);var i=n(11186),r=n(80371),s=n(55054);class o extends s.r{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.B.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,s),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,i.h)(this.lineStart,e.lineStart)&&(0,i.h)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.o)(this.lineStart,this.lineEnd)}}},61309:(e,t,n)=>{n.d(t,{n:()=>s});var i=n(11186),r=n(55054);class s extends r.r{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof s&&(0,i.h)(this.point,e.point)}}},55054:(e,t,n)=>{n.d(t,{r:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},64674:(e,t,n)=>{n.d(t,{Bb:()=>_,ML:()=>S,Ob:()=>w,_j:()=>y,fG:()=>m,lQ:()=>g,n0:()=>b,rh:()=>v,ze:()=>i});var i,r,s=n(94172),o=n(92377),a=n(76672),l=n(86710),c=n(11186),d=n(55946),u=n(21149),h=n(1614),p=n(87888),f=n(38054);function _(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function m(e,t){return Math.sqrt(_(e,t))}function g(e,t){t.sort(((t,n)=>(0,c.a)(t.targetPoint,e)-(0,c.a)(n.targetPoint,e)))}function v(e,t,n){let{point:i,distance:r,returnEdge:s,vertexMode:c,coordinateHelper:{spatialReference:h},filter:p}=e;return n=null!=n?n.clone():new u.Z({where:"1=1"}),p&&(n.geometry=p.geometry,n.distance=p.distance,n.spatialRelationship=p.spatialRelationship,n.where=(0,a._)(n.where,p.where),n.timeExtent=(0,l.Ov)(n.timeExtent,p.timeExtent),n.objectIds=function(e,t){return e||t?t?e?Array.from((0,o.jV)(new Set(e),new Set(t))):t:e:null}(n.objectIds,p.objectIds)),{point:(0,d.T)(i[0],i[1],i[2],h.toJSON()),mode:t,distance:r,returnEdge:s,vertexMode:c,query:n.toJSON()}}function y(e,t,n){return{left:(0,f.j7)(e.leftVertex.pos,t,n),right:(0,f.j7)(e.rightVertex.pos,t,n)}}function S(e){return e.createQuery()}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const n=(0,s.YP)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(n=>{let{view:i,snappingOptions:r}=n;const s="snapping-toggle",o=h.f.TOOL;if(e.removeHandles(s),i&&null!=r){const n=[i.on("key-down",(e=>{e.key!==p.Kj.toggle||e.repeat||(r.enabledToggled=!0,t())}),o),i.on("key-up",(e=>{e.key===p.Kj.toggle&&(r.enabledToggled=!1,t())}),o),i.on("pointer-move",(e=>{const n=e.native.ctrlKey;r.enabledToggled!==n&&(r.enabledToggled=n,t())}),o)];e.addHandles(n,s)}}),s.tX);e.addHandles(n)}function b(e){var t;return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass&&"utilityNetworks"in e&&!(null===e||void 0===e||null===(t=e.utilityNetworks)||void 0===t||!t.length)}(r=i||(i={}))[r.TARGET=0]="TARGET",r[r.REFERENCE=1]="REFERENCE",r[r.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"},55793:(e,t,n)=>{n.d(t,{$7:()=>P,Au:()=>S,CJ:()=>y,Jk:()=>R,Nn:()=>f,SD:()=>u,UG:()=>v,Yf:()=>w,ZE:()=>g,fK:()=>h,hA:()=>C,hm:()=>p,rq:()=>M,sc:()=>m,z9:()=>_,zf:()=>x});var i=n(16889),r=n(88396),s=n(6394),o=n(11186),a=n(71353),l=n(55652),c=n(80064),d=n(94163);function u(e,t,n){let{start:i,end:o,type:a}=e;const l=[],c=(0,r.c)(A,o,i),d=(0,r.c)(z,i,t),u=(0,r.v)(c),h=2*(0,r.g)(c,d),p=h*h-4*u*((0,r.v)(d)-n*n);if(0===p){const e=-h/(2*u);(a===R.PLANE||e>=0)&&l.push((0,r.w)((0,s.a)(),i,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-h+e)/(2*u);(a===R.PLANE||t>=0)&&l.push((0,r.w)((0,s.a)(),i,c,t));const n=(-h-e)/(2*u);(a===R.PLANE||n>=0)&&l.push((0,r.w)((0,s.a)(),i,c,n))}return l}function h(e,t){const n=e.start,i=e.end,s=(0,r.c)(A,i,n),l=(0,o.s)(z,-s[1],s[0],0),c=t.start,u=t.end,h=(0,o.u)(L,u,c),p=(0,o.j)(h,l),f=(0,o.s)(j,n[0],n[1],0),_=(0,o.u)(G,f,c),m=(0,o.j)(_,l);if(Math.abs(p)<O)return Math.abs(m),[];const g=(0,o.q)(H,c,h,m/p);if(t.type===d.SP.RAY){const e=(0,o.u)(V,g,c);if((0,o.j)(e,h)<-O)return[]}if(e.type===R.HALF_PLANE){const e=(0,r.b)(V,g,n);if((0,r.g)(e,s)<-O)return[]}return[(0,a.g)(g)]}function p(e,t){return function(e,t){let{start:n,end:i,type:r}=e;const s=(0,o.u)(A,t,n),l=(0,o.u)(z,i,n),c=(0,o.b)(L,l,s);if((0,o.F)(c)/(0,o.F)(l)<O)switch(r){case d.SP.LINE:return[(0,a.g)(t)];case d.SP.RAY:return(0,o.j)(l,s)<-O?[]:[(0,a.g)(t)]}return[]}(b(k,t[2],e),t)}function f(e,t){const n=S(b(k,0,e),b(I,0,t)),i=[];for(const r of n)i.push((0,s.d)(r));return i}function _(e,t){return g(e,b(k,e[2],t))}function m(e,t,n){const i=(0,r.c)(A,e,t),s=n/(0,r.h)(i),o=(0,r.w)((0,a.c)(),t,i,s);return o[2]=e[2],o}function g(e,t){let{start:n,end:i,type:r}=t;const s=(0,o.u)(A,e,n),l=(0,o.u)(z,i,n),c=(0,o.j)(s,l)/(0,o.j)(l,l);return(0,o.q)((0,a.c)(),n,l,r===d.SP.RAY?Math.max(c,0):c)}const v=(()=>{const e=(0,a.c)(),t=(0,a.c)(),n=(0,a.c)();return(i,u)=>{let{start:h,end:p}=i,{center:f,radius:_,normal:m,slicePlane:g}=u;const v=(0,a.c)(),y=(0,l.Yq)(f,m,F);if(C((0,l.TE)(y,h),0)&&C((0,l.TE)(y,p),0)){(0,c._F)(m,e,t);const i=(i,s)=>((0,o.f)(n,s,f),(0,r.s)(i,(0,o.j)(n,e),(0,o.j)(n,t)),i),l=(0,d.UG)({start:i(D,h),end:i(E,p),type:d.SP.LINE},s.Z,_),u=[];for(const[n,r]of l){const i=(0,o.c)((0,a.c)(),f);(0,o.q)(i,i,e,n),(0,o.q)(i,i,t,r),g&&!x(g,i)||u.push(i)}return u}return(0,l.fn)(y,h,p,v)?!C((0,o.o)(v,f),_)||g&&!x(g,v)?[]:[v]:[]}})();function y(e,t,n){let{start:i,end:s,type:l}=e;const c=[],u=(0,o.f)(A,s,i),h=(0,r.c)(z,i,t),p=(0,r.v)(u),f=2*(0,r.g)(u,h),_=f*f-4*p*((0,r.v)(h)-n*n);if(0===_){const e=-f/(2*p);(l===d.SP.LINE||e>=0)&&c.push((0,o.q)((0,a.c)(),i,u,e))}else if(_>0){const e=Math.sqrt(_),t=(-f+e)/(2*p);(l===d.SP.LINE||t>=0)&&c.push((0,o.q)((0,a.c)(),i,u,t));const n=(-f-e)/(2*p);(l===d.SP.LINE||n>=0)&&c.push((0,o.q)((0,a.c)(),i,u,n))}return c}function S(e,t){const n=e.start,r=e.end,s=t.start,l=t.end,c=(0,o.u)(A,r,n),u=(0,o.u)(z,l,s),h=(0,o.u)(L,s,n),p=(0,o.b)(j,c,u),f=(0,o.j)(h,p);if(!(0,i.W8)(f,0,O))return[];const _=(0,o.F)(p);if((0,i.W8)(_,0,O))return[];const m=(0,o.b)(G,h,u),g=(0,o.j)(m,p)/_,v=(0,o.q)(H,n,c,g);if(e.type===d.SP.RAY){const e=(0,o.u)(V,v,n);if((0,o.j)(c,e)<-O)return[]}if(t.type===d.SP.RAY){const e=(0,o.u)(V,v,s);if((0,o.j)(u,e)<-O)return[]}return[(0,a.g)(v)]}function w(e,t,n,i){const[o,a]=e,[l,c]=n,d=l-o,u=c-a,h=d*d+u*u,p=Math.sqrt(h);if(p>t+i)return[];if(p<Math.abs(t-i))return[];if(C(p,0)&&C(t,i))return[];const f=(t*t-i*i+h)/(2*p),_=Math.sqrt(t*t-f*f),m=_*u/p,g=_*d/p,[v,y]=(0,r.l)(D,e,n,f/p);return C(m,g)?[(0,s.f)(v,y)]:[(0,s.f)(v+m,y-g),(0,s.f)(v-m,y+g)]}function b(e,t,n){let{start:i,end:r,type:s}=n;return(0,o.s)(e.start,i[0],i[1],t),(0,o.s)(e.end,r[0],r[1],t),e.type=T[s],e}function P(e,t){return C(e[2],t[2])}function C(e,t){return Math.abs(e-t)<O}function M(e,t){return t.filter((t=>x(e,t)))}function x(e,t){return(0,l.Ac)(e,t)}var R;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(R||(R={}));const T={[R.PLANE]:d.SP.LINE,[R.HALF_PLANE]:d.SP.RAY},O=1e-6,D=(0,s.a)(),E=(0,s.a)(),A=(0,a.c)(),z=(0,a.c)(),L=(0,a.c)(),j=(0,a.c)(),G=(0,a.c)(),H=(0,a.c)(),V=(0,a.c)(),F=(0,l.Ue)(),k={start:(0,a.c)(),end:(0,a.c)(),type:d.SP.LINE},I={start:(0,a.c)(),end:(0,a.c)(),type:d.SP.LINE}}}]);
//# sourceMappingURL=3616.9106a1af.chunk.js.map