"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[5380],{47741:(e,t,s)=>{s.d(t,{F:()=>l,a:()=>c,b:()=>d});var i=s(24967),r=s(99339),o=s(98634),n=s(64201),a=s(19253);class l extends o.K{}function d(){const e=new n.kG;return e.include(i.k),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new a.A("colorTexture",(e=>e.color)),new a.A("focusArea",(e=>e.focusArea)),new r._("focusAreaEffectMode",(e=>e.effect??1))).main.add(o.H`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),e}const c=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:l,build:d},Symbol.toStringTag,{value:"Module"}))},68908:(e,t,s)=>{s.d(t,{F:()=>c,a:()=>p,b:()=>u});var i=s(29134),r=s(7025),o=s(12400),n=s(98634),a=s(8654),l=s(64201),d=s(4760);class c extends n.K{constructor(){super(...arguments),this.origin=o.AG}}function u(){const e=new l.kG;return e.attributes.add(d.T.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.g("proj",((e,t)=>t.camera.projectionMatrix)),new a.g("view",((e,t)=>(0,i.Iu)(h,t.camera.viewMatrix,e.origin)))).main.add(n.H`gl_Position = proj * view * vec4(position, 1.0);`),e.fragment.main.add(n.H`fragColor = vec4(1., 0., 0., 1.);`),e}const h=(0,r.Ue)(),p=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},15380:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var i=s(27366),r=s(92026),o=s(94172),n=s(49861),a=s(69912),l=s(79347),d=s(7025),c=s(32035),u=s(12400),h=s(37998),p=s(86372),f=s(39406),g=s(11186),y=s(50951),_=s(42069),v=s(78935),b=s(4714),m=s(96387),w=s(27689),C=(s(93169),s(32718),s(84936),s(18020)),A=s(31239),E=s(82144),S=s(78914),x=s(47741),T=s(36207);class P extends S.A{constructor(e,t,i){super(e,t,new E.J(x.a,(()=>s.e(1140).then(s.bind(s,91140)))),i)}initializePipeline(){return(0,T.sm)({colorWrite:T.gf})}}var N=s(68908),R=s(8548);class I extends S.A{constructor(e,t,i){super(e,t,new E.J(N.a,(()=>s.e(7878).then(s.bind(s,37878)))),i)}initializePipeline(){return(0,T.sm)({colorWrite:T.gf,depthTest:{func:R.wb.LEQUAL}})}}var O=s(7566),H=s(53641),F=s(80658),M=s(44070);let k=class extends A.Z{constructor(e){super(e),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new x.F,this._maskParameters=new N.F,e.techniques.precompile(I),e.techniques.precompile(P)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos=[],this._count=[],this._origins=[]}render(e){const t=this.techniques.acquire(I),s=this.techniques.acquire(P),i=this.bindParameters,r=e.find((e=>{let{name:t}=e;return"final-color"===t})),o=r?.getTexture(),n=i.camera,a=n.fullViewport[2],l=n.fullViewport[3],d=this.fboCache.acquire(a,l,"focusArea",C.q.RGBA),c=this.fboCache.acquire(a,l,this.produces);if(!t.compiled||!s.compiled||!this._vaos||this.effect===L.NONE)return this.requestRender(),t.release(),s.release(),c.release(),d.release(),r;const u=this.renderingContext;d.attachDepth(r.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),u.bindFramebuffer(d.fbo),u.clear(R.Hf.COLOR|R.Hf.STENCIL),u.setViewport(0,0,a,l),u.gl.clearStencil(0),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.setClearStencil(0);for(let h=0;h<this._vaos.length;h++){const e=this._vaos[h],s=this._count[h];e&&(this._maskParameters.origin=this._origins[h],u.bindTechnique(t,i,this._maskParameters),u.setFaceCullingEnabled(!1),u.setStencilTestEnabled(!0),u.setStencilWriteMask(255),u.setStencilFunction(R.wb.ALWAYS,0,255),u.setStencilOpSeparate(R.LR.FRONT,R.xS.KEEP,R.xS.INCR_WRAP,R.xS.KEEP),u.setStencilOpSeparate(R.LR.BACK,R.xS.KEEP,R.xS.DECR_WRAP,R.xS.KEEP),u.setDepthWriteEnabled(!1),u.setColorMask(!1,!1,!1,!1),u.bindVAO(e),u.drawArrays(R.MX.TRIANGLES,0,s),u.setFaceCullingEnabled(!1),u.setDepthTestEnabled(!1),u.setStencilFunction(R.wb.NOTEQUAL,0,255),u.setStencilWriteMask(0),u.setColorMask(!0,!0,!0,!0),u.drawArrays(R.MX.TRIANGLES,0,s))}return t.release(),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.bindFramebuffer(c.fbo),this._colorParameters.color=o,this._colorParameters.focusArea=d.getTexture(),this._colorParameters.effect=this.effect,u.bindTechnique(s,i,this._colorParameters),u.screen.draw(),d.release(),s.release(),c.attachDepth(r.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}setExtrudedVolume(){const e=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let t=0;t<e.length;t++){const s=e[t],i=new Array,r=s.indicesBottom;this._origins.push(s.origin);for(let e=0;e<r.length;e++)i.push(s.positions[3*(r[e]-1)]),i.push(s.positions[3*(r[e]-1)+1]),i.push(s.positions[3*(r[e]-1)+2]);const o=s.indicesExtruded;for(let e=0;e<o.length;e++)i.push(s.positions[3*o[e]]),i.push(s.positions[3*o[e]+1]),i.push(s.positions[3*o[e]+2]);const n=new Float32Array(i),a=new F.U(this.renderingContext,O.i,new Map([["geometry",H.ap]]),new Map([["geometry",M.f.createVertex(this.renderingContext,R.l1.STATIC_DRAW,n)]]));this._vaos?.push(a),this._count.push(r.length+o.length)}}};(0,i._)([(0,n.Cb)()],k.prototype,"consumes",void 0),(0,i._)([(0,n.Cb)()],k.prototype,"produces",void 0),(0,i._)([(0,n.Cb)({constructOnly:!0})],k.prototype,"techniques",void 0),(0,i._)([(0,n.Cb)()],k.prototype,"focusAreaGeometries",void 0),(0,i._)([(0,n.Cb)()],k.prototype,"effect",void 0),k=(0,i._)([(0,a.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],k);class q{constructor(e,t,s,i,r){this.positions=e,this.indicesBottom=t,this.indicesExtruded=s,this.height=i,this.origin=r}}var L,G;(G=L||(L={}))[G.NONE=0]="NONE",G[G.BRIGHT=1]="BRIGHT",G[G.DARK=2]="DARK";const D={none:L.NONE,bright:L.BRIGHT,dark:L.DARK};var U=s(67581);let V=class extends((0,_.A)(U.Z)){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new v.o,this._geometries=new Array}initialize(){this.addHandles([(0,o.YP)((()=>this.layer.geometries),((e,t)=>{t=e,this._extrudePolygons(t),this._setFocusAreaRenderNode()}),o.tX),(0,o.YP)((()=>this.layer.tmpEffect),((e,t)=>{t=e,this._renderNode&&t&&(this._renderNode.effect=D[t])}),o.tX),(0,o.YP)((()=>this.layer.visible),((e,t)=>{e?this._renderNode??=new k({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[this.layer.tmpEffect??"none"]}):this._renderNode=(0,r.SC)(this._renderNode)}),o.tX)])}destroy(){this._renderNode=(0,r.SC)(this._renderNode),this._geometries=[]}_extrudePolygons(e){this._geometries=[];for(const t of e){const e=(0,d.Ue)(),s=(0,u.Ue)(),i=this.view.renderCoordsHelper.viewingMode===y.JY.Global;i||this.view.renderCoordsHelper.worldUpAtPosition(null,s);const r=(0,m.zE)(t);if(null==r)return;(0,h.B)(t.spatialReference,[r.x,r.y,0],e,this.view.renderCoordsHelper.spatialReference);const o=(0,c.n)(B,[e[12]-0*s[0],e[13]-0*s[1],e[14]-0*s[2]]),n=(0,d.Ue)();n[12]=-e[12],n[13]=-e[13],n[14]=-e[14];const a=(0,w.VP)(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:_,mapPositions:v,position:C}=a;for(const t of _){const r=t.count,a=(0,l.e)(t.mapPositions,t.holeIndices,3);if(0===a.length)continue;const d=a.length,c=6*r,u=(0,f.$z)(c+d),h=(0,f.$z)(d),y=(0,p.bg)(3*c),_=(0,p.bg)(3*c),m=(0,p.bg)(3*c),w=(0,p.bg)(c);(0,b.A)(C,v,a,t,y,m,_,w,u,h,1e4,s,i),(0,g.t)(y,y,n);const A=new q(y,h,u,1e4,[e[12]+0*o[0],e[13]+0*o[1],e[14]+0*o[2]]);this._geometries.push(A)}}}_setFocusAreaRenderNode(){this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new k({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[this.layer.tmpEffect??"none"]})}};(0,i._)([(0,n.Cb)()],V.prototype,"type",void 0),(0,i._)([(0,n.Cb)()],V.prototype,"layer",void 0),V=(0,i._)([(0,a.j)("esri.views.3d.layers.FocusAreaLayerView3D")],V);const B=(0,u.Ue)(),j=V},42069:(e,t,s)=>{s.d(t,{A:()=>c});var i=s(27366),r=s(42537),o=s(66978),n=s(94172),a=s(49861),l=(s(93169),s(32718),s(84936),s(69912)),d=s(5354);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,d.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,r.kB)((()=>e.abort()))),await(0,n.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,o.k_)(t);const s=(0,d.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(s)throw s}};return(0,i._)([(0,a.Cb)()],t.prototype,"view",void 0),(0,i._)([(0,a.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,i._)([(0,l.j)("esri.views.3d.layers.LayerView3D")],t),t}},67581:(e,t,s)=>{s.d(t,{Z:()=>g});var i=s(27366),r=s(7138),o=s(91505),n=s(79056),a=s(32718),l=s(92026),d=s(67426),c=s(49861),u=(s(93169),s(84936),s(69912)),h=s(46634),p=s(69787);let f=class extends((0,n.IG)((0,d.v)(o.Z.EventedMixin(r.Z)))){constructor(e){super(e),this._updatingHandles=new h.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",s=this.layer?.title||"no title";a.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${s}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,p.Cy)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.Cy)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,i._)([(0,c.Cb)()],f.prototype,"view",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"fullOpacity",null),(0,i._)([(0,c.Cb)()],f.prototype,"layer",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"parent",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"suspended",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,i._)([(0,c.Cb)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,i._)([(0,c.Cb)()],f.prototype,"updateSuspended",null),(0,i._)([(0,c.Cb)()],f.prototype,"visible",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"visibleAtCurrentScale",null),(0,i._)([(0,c.Cb)({readOnly:!0})],f.prototype,"visibleAtCurrentTimeExtent",null),f=(0,i._)([(0,u.j)("esri.views.layers.LayerView")],f);const g=f}}]);
//# sourceMappingURL=5380.b0dcc401.chunk.js.map