"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[5380],{47741:(e,t,i)=>{i.d(t,{F:()=>c,a:()=>h,b:()=>u});var r,s=i(30168),o=i(24967),n=i(99339),l=i(98634),a=i(64201),d=i(19253);class c extends l.K{}function u(){const e=new a.kG;return e.include(o.k),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new d.A("colorTexture",(e=>e.color)),new d.A("focusArea",(e=>e.focusArea)),new n._("focusAreaEffectMode",(e=>{var t;return null!==(t=e.effect)&&void 0!==t?t:1}))).main.add((0,l.H)(r||(r=(0,s.Z)(["float mask = texture( focusArea, uv, 0.0 ).r;\nvec4 color = texture( colorTexture, uv, 0.0 );\nvec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\nif (focusAreaEffectMode == 1) {\nfragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;\n} else {\nfragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);\n}"])))),e}const h=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},68908:(e,t,i)=>{i.d(t,{F:()=>p,a:()=>g,b:()=>v});var r,s,o=i(30168),n=i(29134),l=i(7025),a=i(12400),d=i(98634),c=i(8654),u=i(64201),h=i(4760);class p extends d.K{constructor(){super(...arguments),this.origin=a.AG}}function v(){const e=new u.kG;return e.attributes.add(h.T.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new c.g("proj",((e,t)=>t.camera.projectionMatrix)),new c.g("view",((e,t)=>(0,n.Iu)(f,t.camera.viewMatrix,e.origin)))).main.add((0,d.H)(r||(r=(0,o.Z)(["gl_Position = proj * view * vec4(position, 1.0);"])))),e.fragment.main.add((0,d.H)(s||(s=(0,o.Z)(["fragColor = vec4(1., 0., 0., 1.);"])))),e}const f=(0,l.Ue)(),g=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskPassParameters:p,build:v},Symbol.toStringTag,{value:"Module"}))},15380:(e,t,i)=>{i.r(t),i.d(t,{default:()=>j});var r=i(27366),s=i(92026),o=i(94172),n=i(49861),l=i(69912),a=i(79347),d=i(7025),c=i(32035),u=i(12400),h=i(37998),p=i(86372),v=i(39406),f=i(11186),g=i(50951),_=i(42069),y=i(78935),b=i(4714),m=i(96387),w=i(27689),C=(i(93169),i(32718),i(84936),i(18020)),A=i(31239),E=i(82144),S=i(78914),x=i(47741),T=i(36207);class P extends S.A{constructor(e,t,r){super(e,t,new E.J(x.a,(()=>i.e(1140).then(i.bind(i,91140)))),r)}initializePipeline(){return(0,T.sm)({colorWrite:T.gf})}}var N=i(68908),R=i(8548);class I extends S.A{constructor(e,t,r){super(e,t,new E.J(N.a,(()=>i.e(7878).then(i.bind(i,37878)))),r)}initializePipeline(){return(0,T.sm)({colorWrite:T.gf,depthTest:{func:R.wb.LEQUAL}})}}var O=i(7566),H=i(53641),F=i(80658),M=i(44070);let k=class extends A.Z{constructor(e){super(e),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new x.F,this._maskParameters=new N.F,e.techniques.precompile(I),e.techniques.precompile(P)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos=[],this._count=[],this._origins=[]}render(e){const t=this.techniques.acquire(I),i=this.techniques.acquire(P),r=this.bindParameters,s=e.find((e=>{let{name:t}=e;return"final-color"===t})),o=null===s||void 0===s?void 0:s.getTexture(),n=r.camera,l=n.fullViewport[2],a=n.fullViewport[3],d=this.fboCache.acquire(l,a,"focusArea",C.q.RGBA),c=this.fboCache.acquire(l,a,this.produces);if(!t.compiled||!i.compiled||!this._vaos||this.effect===L.NONE)return this.requestRender(),t.release(),i.release(),c.release(),d.release(),s;const u=this.renderingContext;d.attachDepth(s.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),u.bindFramebuffer(d.fbo),u.clear(R.Hf.COLOR|R.Hf.STENCIL),u.setViewport(0,0,l,a),u.gl.clearStencil(0),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.setClearStencil(0);for(let h=0;h<this._vaos.length;h++){const e=this._vaos[h],i=this._count[h];e&&(this._maskParameters.origin=this._origins[h],u.bindTechnique(t,r,this._maskParameters),u.setFaceCullingEnabled(!1),u.setStencilTestEnabled(!0),u.setStencilWriteMask(255),u.setStencilFunction(R.wb.ALWAYS,0,255),u.setStencilOpSeparate(R.LR.FRONT,R.xS.KEEP,R.xS.INCR_WRAP,R.xS.KEEP),u.setStencilOpSeparate(R.LR.BACK,R.xS.KEEP,R.xS.DECR_WRAP,R.xS.KEEP),u.setDepthWriteEnabled(!1),u.setColorMask(!1,!1,!1,!1),u.bindVAO(e),u.drawArrays(R.MX.TRIANGLES,0,i),u.setFaceCullingEnabled(!1),u.setDepthTestEnabled(!1),u.setStencilFunction(R.wb.NOTEQUAL,0,255),u.setStencilWriteMask(0),u.setColorMask(!0,!0,!0,!0),u.drawArrays(R.MX.TRIANGLES,0,i))}return t.release(),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.bindFramebuffer(c.fbo),this._colorParameters.color=o,this._colorParameters.focusArea=d.getTexture(),this._colorParameters.effect=this.effect,u.bindTechnique(i,r,this._colorParameters),u.screen.draw(),d.release(),i.release(),c.attachDepth(s.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}setExtrudedVolume(){const e=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let i=0;i<e.length;i++){var t;const r=e[i],s=new Array,o=r.indicesBottom;this._origins.push(r.origin);for(let e=0;e<o.length;e++)s.push(r.positions[3*(o[e]-1)]),s.push(r.positions[3*(o[e]-1)+1]),s.push(r.positions[3*(o[e]-1)+2]);const n=r.indicesExtruded;for(let e=0;e<n.length;e++)s.push(r.positions[3*n[e]]),s.push(r.positions[3*n[e]+1]),s.push(r.positions[3*n[e]+2]);const l=new Float32Array(s),a=new F.U(this.renderingContext,O.i,new Map([["geometry",H.ap]]),new Map([["geometry",M.f.createVertex(this.renderingContext,R.l1.STATIC_DRAW,l)]]));null!==(t=this._vaos)&&void 0!==t&&t.push(a),this._count.push(o.length+n.length)}}};(0,r._)([(0,n.Cb)()],k.prototype,"consumes",void 0),(0,r._)([(0,n.Cb)()],k.prototype,"produces",void 0),(0,r._)([(0,n.Cb)({constructOnly:!0})],k.prototype,"techniques",void 0),(0,r._)([(0,n.Cb)()],k.prototype,"focusAreaGeometries",void 0),(0,r._)([(0,n.Cb)()],k.prototype,"effect",void 0),k=(0,r._)([(0,l.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],k);class q{constructor(e,t,i,r,s){this.positions=e,this.indicesBottom=t,this.indicesExtruded=i,this.height=r,this.origin=s}}var L,G;(G=L||(L={}))[G.NONE=0]="NONE",G[G.BRIGHT=1]="BRIGHT",G[G.DARK=2]="DARK";const D={none:L.NONE,bright:L.BRIGHT,dark:L.DARK};var U=i(67581);let V=class extends((0,_.A)(U.Z)){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new y.o,this._geometries=new Array}initialize(){this.addHandles([(0,o.YP)((()=>this.layer.geometries),((e,t)=>{t=e,this._extrudePolygons(t),this._setFocusAreaRenderNode()}),o.tX),(0,o.YP)((()=>this.layer.tmpEffect),((e,t)=>{t=e,this._renderNode&&t&&(this._renderNode.effect=D[t])}),o.tX),(0,o.YP)((()=>this.layer.visible),((e,t)=>{var i,r;e?null!==(i=this._renderNode)&&void 0!==i||(this._renderNode=new k({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[null!==(r=this.layer.tmpEffect)&&void 0!==r?r:"none"]})):this._renderNode=(0,s.SC)(this._renderNode)}),o.tX)])}destroy(){this._renderNode=(0,s.SC)(this._renderNode),this._geometries=[]}_extrudePolygons(e){this._geometries=[];for(const t of e){const e=(0,d.Ue)(),i=(0,u.Ue)(),r=this.view.renderCoordsHelper.viewingMode===g.JY.Global;r||this.view.renderCoordsHelper.worldUpAtPosition(null,i);const s=(0,m.zE)(t);if(null==s)return;(0,h.B)(t.spatialReference,[s.x,s.y,0],e,this.view.renderCoordsHelper.spatialReference);const o=(0,c.n)(B,[e[12]-0*i[0],e[13]-0*i[1],e[14]-0*i[2]]),n=(0,d.Ue)();n[12]=-e[12],n[13]=-e[13],n[14]=-e[14];const l=(0,w.VP)(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:_,mapPositions:y,position:C}=l;for(const t of _){const s=t.count,l=(0,a.e)(t.mapPositions,t.holeIndices,3);if(0===l.length)continue;const d=l.length,c=6*s,u=(0,v.$z)(c+d),h=(0,v.$z)(d),g=(0,p.bg)(3*c),_=(0,p.bg)(3*c),m=(0,p.bg)(3*c),w=(0,p.bg)(c);(0,b.A)(C,y,l,t,g,m,_,w,u,h,1e4,i,r),(0,f.t)(g,g,n);const A=new q(g,h,u,1e4,[e[12]+0*o[0],e[13]+0*o[1],e[14]+0*o[2]]);this._geometries.push(A)}}}_setFocusAreaRenderNode(){var e;this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new k({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[null!==(e=this.layer.tmpEffect)&&void 0!==e?e:"none"]})}};(0,r._)([(0,n.Cb)()],V.prototype,"type",void 0),(0,r._)([(0,n.Cb)()],V.prototype,"layer",void 0),V=(0,r._)([(0,l.j)("esri.views.3d.layers.FocusAreaLayerView3D")],V);const B=(0,u.Ue)(),j=V},42069:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(27366),s=i(42537),o=i(66978),n=i(94172),l=i(49861),a=(i(93169),i(32718),i(84936),i(69912)),d=i(5354);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,d.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,s.kB)((()=>e.abort()))),await(0,n.N1)((()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),t),(0,o.k_)(t);const i=(0,d.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,r._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,r._)([(0,a.j)("esri.views.3d.layers.LayerView3D")],t),t}},67581:(e,t,i)=>{i.d(t,{Z:()=>f});var r=i(27366),s=i(7138),o=i(91505),n=i(79056),l=i(32718),a=i(92026),d=i(67426),c=i(49861),u=(i(93169),i(84936),i(69912)),h=i(46634),p=i(69787);let v=class extends((0,n.IG)((0,d.v)(o.Z.EventedMixin(s.Z)))){constructor(e){super(e),this._updatingHandles=new h.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",r=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";l.Z.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),e)}}))}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles)}get fullOpacity(){var e,t,i,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,i=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!i||!t.intersection(i).isEmpty}canResume(){var e,t,i;const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)&&(0,p.Cy)(r)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.Cy)(r)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,r._)([(0,c.Cb)()],v.prototype,"view",void 0),(0,r._)([(0,c.Cb)()],v.prototype,"fullOpacity",null),(0,r._)([(0,c.Cb)()],v.prototype,"layer",void 0),(0,r._)([(0,c.Cb)()],v.prototype,"parent",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"suspended",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,r._)([(0,c.Cb)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,r._)([(0,c.Cb)()],v.prototype,"updateSuspended",null),(0,r._)([(0,c.Cb)()],v.prototype,"visible",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"visibleAtCurrentScale",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"visibleAtCurrentTimeExtent",null),v=(0,r._)([(0,u.j)("esri.views.layers.LayerView")],v);const f=v}}]);
//# sourceMappingURL=5380.3dfd54e4.chunk.js.map