"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[4664],{97613:(e,t,i)=>{i.d(t,{Z:()=>g});var n=i(27366),o=i(84314),r=i(7138),s=i(11582),a=i(46784),l=i(92026),u=i(49861),d=(i(25243),i(63780),i(93169),i(69912)),c=i(96866),h=i(585),p=i(64575);let v=class extends((0,a.eC)((0,s.J)(r.Z))){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return(0,l._W)(this.position,e.position)&&(0,l._W)(this.elevationInfo,e.elevationInfo)&&(0,o.kk)(this.feature,e.feature)}};(0,n._)([(0,u.Cb)({type:h.Z,json:{write:{isRequired:!0}}})],v.prototype,"position",void 0),(0,n._)([(0,u.Cb)({type:p.Z}),(0,c.B)()],v.prototype,"elevationInfo",void 0),(0,n._)([(0,u.Cb)(o.rX)],v.prototype,"feature",void 0),v=(0,n._)([(0,d.j)("esri.analysis.LineOfSightAnalysisObserver")],v);const g=v},33985:(e,t,i)=>{i.d(t,{Z:()=>v});var n=i(27366),o=i(84314),r=i(11582),s=i(46784),a=i(92026),l=i(49861),u=(i(25243),i(63780),i(93169),i(69912)),d=i(96866),c=i(585),h=i(64575);let p=class extends((0,s.eC)(r.j)){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return(0,a._W)(this.position,e.position)&&(0,a._W)(this.elevationInfo,e.elevationInfo)&&(0,o.kk)(this.feature,e.feature)}};(0,n._)([(0,l.Cb)({type:c.Z}),(0,d.B)()],p.prototype,"position",void 0),(0,n._)([(0,l.Cb)({type:h.Z}),(0,d.B)()],p.prototype,"elevationInfo",void 0),(0,n._)([(0,l.Cb)(o.rX)],p.prototype,"feature",void 0),p=(0,n._)([(0,u.j)("esri.analysis.LineOfSightAnalysisTarget")],p);const v=p},84314:(e,t,i)=>{function n(e,t){return o(e)===o(t)}function o(e){if(null==e)return null;const t=null!=e.layer?e.layer.id:"";let i=null;return i=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==i?null:"o-".concat(t,"-").concat(i)}i.d(t,{kk:()=>n,pD:()=>o,rX:()=>r});const r={json:{write:{writer:function(e,t){var i;null!=(null===e||void 0===e||null===(i=e.layer)||void 0===i?void 0:i.objectIdField)&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}}},74664:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ue});var n=i(27366),o=i(7138),r=i(80987),s=i(91505),a=i(92026),l=i(49861),u=(i(25243),i(63780)),d=(i(93169),i(69912)),c=i(71353),h=i(98074),p=(i(59486),i(84314)),v=i(14921),g=i(100),_=i(42537),b=i(32718),y=i(66978),m=i(94172),C=i(11186),f=i(46634),w=i(79803),O=i(77258),T=i(65156),I=i(40885),L=i(74509);let P=class extends o.Z{constructor(e){super(e),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0}};(0,n._)([(0,l.Cb)()],P.prototype,"target",void 0),(0,n._)([(0,l.Cb)()],P.prototype,"intersectedGraphic",void 0),(0,n._)([(0,l.Cb)()],P.prototype,"intersectedLocation",void 0),(0,n._)([(0,l.Cb)()],P.prototype,"elevationAlignedTargetLocation",void 0),(0,n._)([(0,l.Cb)({type:Boolean})],P.prototype,"visible",void 0),P=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSightAnalysisResult")],P);let S=class extends o.Z{constructor(e){super(e),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:(0,c.c)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,c.c)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,c.c)(),targetAdjusted:(0,c.c)()},this.computationResult={start:(0,c.c)(),end:(0,c.c)(),intersection:(0,c.c)(),isValid:!1,isTargetVisible:!1},this.result=null}notifyResultChanged(){this.notifyChange("computationResult")}notifyInputPointsChanged(){this.notifyChange("inputPoints")}};(0,n._)([(0,l.Cb)()],S.prototype,"target",void 0),(0,n._)([(0,l.Cb)()],S.prototype,"elevationAlignedTargetLocation",void 0),(0,n._)([(0,l.Cb)()],S.prototype,"inputPoints",void 0),(0,n._)([(0,l.Cb)()],S.prototype,"computationResult",void 0),(0,n._)([(0,l.Cb)()],S.prototype,"result",void 0),S=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],S);var V,R=i(17842),E=i(51378),A=i(65618),H=i(84652);let D=V=class extends o.Z{constructor(e){super(e)}clone(){return new V({type:this.type,id:(0,H.d9)(this.id),mapPoint:(0,H.d9)(this.mapPoint),renderPoint:(0,c.g)(this.renderPoint),normal:(0,H.d9)(this.normal),ray:(0,H.d9)(this.ray),graphic:this.graphic})}equals(e){return this.type===e.type&&this.id===e.id&&(0,a._W)(this.mapPoint,e.mapPoint)&&(0,C.G)(this.renderPoint,e.renderPoint)&&(0,u.fS)(this.normal,e.normal)&&(0,I.fS)(this.ray,e.ray)&&this.graphic===e.graphic}};(0,n._)([(0,l.Cb)()],D.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],D.prototype,"id",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],D.prototype,"mapPoint",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],D.prototype,"renderPoint",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],D.prototype,"normal",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],D.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],D.prototype,"ray",void 0),D=V=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],D);var k=i(85312),M=i(81703),j=i(43449),Z=i(88153),F=i(54463),z=i(41781);let x=class extends o.Z{constructor(e){super(e),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"])}initialize(){this.intersector=(0,Z.Z8)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=F.eC.MIN}getScreenPointIntersection(e){const t=(0,R.md)(e,E.qW.get()),i=(0,M.u4)(this.view.state.camera,t,W);return this._getRayIntersection(i)}_getRayIntersection(e,t){if(null==e||null==this.view.sceneIntersectionHelper)return null;const{intersector:i}=this;i.options.store=F.eC.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,i,t);const n=i.results.min,o=(0,c.c)();if(!n.getIntersectionPoint(o))return null;if(null!=(null===t||void 0===t?void 0:t.maxDistance)&&(0,C.a)(o,e.origin)>t.maxDistance**2)return null;const r=this.view.renderCoordsHelper.fromRenderCoords(o,this.view.spatialReference),s=(0,c.g)(n.normal);if((0,k.GS)(n))return new D({type:F.q7.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.nodeIndex,"/").concat(n.target.componentIndex),mapPoint:r,renderPoint:o,normal:s,ray:(0,I.JG)(e),graphic:null});if((0,j.TX)(n))return new D({type:F.q7.TERRAIN,id:n.target.lij.slice(),mapPoint:r,renderPoint:o,normal:s,ray:(0,I.JG)(e),graphic:null});const a=(0,z.tB)(n,this.view);if(null!=a){const t=a.layer,i=a.sourceLayer;let n;return n=i&&"scene"===i.type?(0,A.MS)(a,i.objectIdField):a.uid,new D({type:F.q7.OBJECT,id:"".concat(null===t||void 0===t?void 0:t.uid,"/").concat(n),mapPoint:r,renderPoint:o,normal:s,ray:(0,I.JG)(e),graphic:a})}return null}updateFromGroundIntersection(e,t,i){const n=G,o=B,r=N,s=U;(0,C.c)(o,e),this.view.renderCoordsHelper.worldUpAtPosition(o,r),(0,C.n)(r,r);const a=this.view.basemapTerrain.visibleElevationBounds,l=(t>=0?1:-1)*((a?Math.abs(a.max-a.min):100)+Math.abs(t));(0,C.i)(s,r,l),(0,C.g)(n,o,s),(0,I.zk)(n,o,W);const u=this._getRayIntersection(W,{include:this._terrainIntersectionOptionsLayerUids,maxDistance:l});if(null!=u){const e=U;return(0,C.i)(e,r,t),(0,C.g)(i,u.renderPoint,e),(0,c.g)(u.normal)}return(0,C.c)(i,e),null}};(0,n._)([(0,l.Cb)()],x.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],x.prototype,"intersector",void 0),x=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],x);const G=(0,c.c)(),B=(0,c.c)(),N=(0,c.c)(),U=(0,c.c)(),W=(0,I.Ue)();var q=i(33906),J=i(93463),X=i(585);const Q="esri.views.3d.analysis.LineOfSight.LineOfSightController",Y=b.Z.getLogger(Q);let K=class extends(s.Z.EventedMixin(o.Z)){constructor(e){super(e),this.updateOnCameraChange=!0,this._observerGroundOffsetRenderSpace=0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new f.R,this._frameTask=J.sq,this._computationHandles=new g.Z,this._externalObserverUpdate=!0}initialize(){var e;const t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(J.T8.LINE_OF_SIGHT_TOOL):J.sq,this._intersector=new x({view:this.view}),this.addHandles([this._connectObserver(),this._connectComputations(),this._connectTargets()])}destroy(){this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(e){this.analysisViewData.observerEngineLocation=e}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}_computeResult(e){const t=e.computation,{inputPoints:i,computationResult:n}=t,{observerAdjusted:o,targetAdjusted:r}=i,{start:s,end:a}=n;(0,C.c)(s,o),(0,C.c)(a,r),this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}_updateAdjustedPointsFromFeatures(e){const t=this.view,{sceneIntersectionHelper:i}=t,{inputPoints:n}=e,{observerAdjusted:o,observerFeatureId:r,targetFeatureId:s,targetAdjusted:a}=n;if(null==r&&null==s)return;const l=(0,C.o)(o,a),u=this._intersector.intersector,d=(0,I.zk)(n.observer,n.target,te);u.options.store=F.eC.ALL,i.intersectToolIntersectorRay(d,u);let h=null,v=null,g=null,_=null;for(const c of u.results.all){const e=(0,z.tB)(c,this.view);if(null==e||null==c.distanceInRenderSpace)continue;const i=(0,p.pD)(e);null!=i&&(null!=r&&i===r&&(null==h&&(h=this._getFeatureDistanceThreshold(c,t,l)),c.distanceInRenderSpace<h&&(g=c)),null!=s&&i===s&&(null==v&&(v=this._getFeatureDistanceThreshold(c,t,l)),null==_&&c.distanceInRenderSpace<l&&l-c.distanceInRenderSpace<v&&(_=c)))}null!=g&&g.getIntersectionPoint(o)&&(n.observerSurfaceNormal=g.getTransformedNormal((0,c.c)())),null!=_&&_.getIntersectionPoint(a)&&(n.targetSurfaceNormal=_.getTransformedNormal((0,c.c)()))}_getFeatureDistanceThreshold(e,t,i){if((0,z._s)(e)){const n=(0,z.VB)(e,t);if(null!=n)return Math.min(n*ne,i)}return 1e-5*i}_adjustStartEndPositions(e){const t=this._screenPixelSize,i=this.view,{inputPoints:n}=e,{observer:o,observerSurfaceNormal:r,target:s,targetSurfaceNormal:a,observerAdjusted:l,targetAdjusted:u}=n,d=ee;(0,C.c)(l,o),(0,C.c)(u,s),this._updateAdjustedPointsFromFeatures(e),null!=r?(0,C.c)(d,r):(0,C.f)(d,u,l);const c=t;(0,C.n)(d,d),(0,C.i)(d,d,Math.min(c,1)),(0,C.g)(l,l,d),null!=a?(0,C.c)(d,a):(0,C.f)(d,l,u);const h=i.state.camera.computeScreenPixelSizeAt(u);(0,C.n)(d,d),(0,C.i)(d,d,Math.min(h,1)),(0,C.g)(u,u,d)}_computeIntersection(e){let{computation:t,interpolationInfo:i}=e;const{view:n}=this,{sceneIntersectionHelper:o,renderCoordsHelper:r}=n;if(null==o)return;const s=this._intersector.intersector,{computationResult:a,inputPoints:l}=t,{observer:u,target:d}=l,{start:c,end:h}=a,p=(0,I.zk)(c,h,te);s.options.store=F.eC.MIN,o.intersectToolIntersectorRay(p,s);const v=s.results.min,g=a.intersection,_=ee;let b=!0;if(null!=v&&v.getIntersectionPoint(g)){(0,C.c)(i.originalIntersection,g),(0,C.c)(i.originalObserver,c),(0,C.c)(i.originalTarget,h),r.fromRenderCoords(g,_,n.spatialReference);const e=1-(0,C.r)(h,d)/(0,C.r)(c,d);b=(0,C.r)(u,g)>=e*(0,C.r)(u,d)}const y=new X.Z(_,n.spatialReference);{const{result:e,target:i}=t;null!=e?(e.target=i,e.intersectedGraphic=b?null:(0,z.tB)(v,n),e.intersectedLocation=b?null:y,e.visible=b):t.result=new P({target:i,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:b?null:(0,z.tB)(v,n),intersectedLocation:b?null:y,visible:b})}a.isValid=l.isValid=!0,a.isTargetVisible=b}_interpolateIntersection(e){let{computation:t,interpolationInfo:i}=e;const{computationResult:n,inputPoints:o}=t,{start:r,end:s,intersection:a}=n,{originalIntersection:l,originalObserver:u,originalTarget:d}=i;if((0,C.c)(a,l),o.isValid){const e=ee,t=(0,C.r)(u,l)/(0,C.r)(u,d);(0,C.u)(e,r,u),(0,C.i)(e,e,1-t),(0,C.g)(a,a,e),(0,C.u)(e,s,d),(0,C.i)(e,e,t),(0,C.g)(a,a,e),n.isValid=!0}else t.result=null,n.isValid=!1,n.isTargetVisible=!1}_canCompute(e){const t=this.analysisViewData.elevationAlignedObserver,i=this.view.frustum;if(null==t||null==e.elevationAlignedTargetLocation||null==i)return!1;const{observerAdjusted:n,targetAdjusted:o}=e.inputPoints,r=i.intersectsPoint(n),s=i.intersectsPoint(o);return r&&s}_onObserverPositionChange(e,t,i,n,o){if(this._externalObserverUpdate=o,null==e)return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(null==t)return(0,q.e)(this.analysis,e.spatialReference,Y),void(this.analysisViewData.elevationAlignedObserver=null);const r=this._getEffectiveElevationInfo(t,i),{absoluteZ:s,elevation:a}=(0,L.tq)(t.x,t.y,t.z,this.view.spatialReference,this.view,r),l=t.clone();l.z=s,this._effectiveObserverElevationMode=r.mode,this.analysisViewData.elevationAlignedObserver=l;const u=(0,c.c)();this.view.renderCoordsHelper.toRenderCoords(l,u),this._elevationAlignedObserverPositionRenderSpace=u,this._observerGroundOffsetRenderSpace=s-a,this._observerFeatureId=(0,p.pD)(n),this.priority=J.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onObserverRenderSpacePositionChangeForComputation(e,t,i,n,o){const{inputPoints:r}=e;switch((0,C.c)(r.observer,t),r.observerFeatureId=o,r.observerSurfaceNormal=null,n){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(r.observer,i,r.observer);null==r.observerFeatureId&&(r.observerSurfaceNormal=e)}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=J.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetPositionChange(e,t,i,n,o){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=e.inputPoints;if(r&&(s.isValid=!1),null==i)return null!=t&&(0,q.e)(this.analysis,t.spatialReference,Y),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();const a=this._getEffectiveElevationInfo(i,n),{absoluteZ:l,elevation:u}=(0,L.tq)(i.x,i.y,i.z,this.view.spatialReference,this.view,a),d=i.clone();switch(d.z=l,e.elevationAlignedTargetLocation=d,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,s.target),s.targetFeatureId=(0,p.pD)(o),s.targetSurfaceNormal=null,a.mode){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(s.target,l-u,s.target);null==s.targetFeatureId&&(s.targetSurfaceNormal=e)}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=J.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectComputationToTarget(e){return(0,_.AL)([this._updatingHandles.add((()=>({computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,w.projectOrLoad)(e.target.position,this.view.spatialReference)})),(e=>{let{computation:t,targetPosition:i,targetElevationInfo:n,targetFeatureInfo:o,projectedTargetPosition:r}=e;null==r.pending?this._onTargetPositionChange(t,i,r.geometry,n,o):this._updatingHandles.addPromise(r.pending)}),m.nn)])}_connectComputationToObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this.analysisViewData.elevationAlignedObserver})),(e=>{let{computation:t}=e;this._externalObserverUpdate&&(t.inputPoints.isValid=!1,t.notifyInputPointsChanged())}),m.nn)}_connectComputationToRenderSpaceObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId})),(e=>{let{computation:t,observer:i,observerGroundOffset:n,observerElevationMode:o,observerFeatureId:r}=e;this._onObserverRenderSpacePositionChangeForComputation(t,i,n,o,r)}),m.nn)}_connectComputationToCamera(e){return this._updatingHandles.add((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(t=>{let{isDirty:i}=t;!this.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}))}_connectComputationToSlicePlane(e){return this._updatingHandles.add((()=>this.view.slicePlane),(()=>{e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}_connectComputationToElevation(e){const t=(i,n)=>{const o=this.analysis.observer,r=e.target;let s=null,a=null,l=null,u=null,d=null,c=null;if(null!=(null===o||void 0===o?void 0:o.position)){const e=(0,w.projectOrLoad)(o.position,this.view.spatialReference);if(null!=e.pending)return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(i,n)));s=e.geometry,a=o.elevationInfo,l=o.feature}if(null!=r.position){const e=(0,w.projectOrLoad)(r.position,this.view.spatialReference);if(null!=e.pending)return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(i,n)));u=e.geometry,d=r.elevationInfo,c=r.feature}null==s&&null==u||((0,O.d)(i,n,ie,this.view.spatialReference),null!=s&&(0,T.Qn)(ie,s)&&this._onObserverPositionChange(null!=o?o.position:null,s,a,l,!1),null!=u&&(0,T.Qn)(ie,u)&&this._onTargetPositionChange(e,r.position,u,d,c,!1),null!=s&&null!=u&&(0,T.I7)(ie,s,u)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(e=>t(e.extent,e.spatialReference)))}_connectComputationToTask(e){let t=null;const i={computation:e,interpolationInfo:{originalIntersection:(0,c.c)(),originalObserver:(0,c.c)(),originalTarget:(0,c.c)()}};return(0,_.AL)([this._updatingHandles.add((()=>e.inputPoints),(()=>{t=(0,a.IM)(t),t=(0,v.vr)((async e=>{await(0,y.R8)(this._frameTask.schedule((()=>this._computeResult(i)),e))}))}),{initial:!0,equals:()=>!1}),(0,_.kB)((()=>t=(0,a.IM)(t)))])}_connectComputation(e){const t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}_disconnectComputation(e){this._computationHandles.remove(e)}_onComputationCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_onTargetCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._removeTarget(n);for(const n of t)this._addTarget(n)}_onCursorTargetChange(e,t){null!=t&&this._removeTarget(t),null!=e&&this._addTarget(e)}_addTarget(e){this._computations.some((t=>t.target===e))||this._computations.add(new S({target:e}))}_removeTarget(e){const t=this._computations.findIndex((t=>t.target===e));this._computations.removeAt(t)}_connectObserver(){return(0,_.AL)([this._updatingHandles.add((()=>({observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,projectedObserverPosition:(0,w.projectOrLoad)(null!=this.analysis.observer?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:null!=this.analysis.observer?this.analysis.observer.elevationInfo:null,observerFeatureInfo:null!=this.analysis.observer?this.analysis.observer.feature:null})),(e=>{let{observerPosition:t,projectedObserverPosition:i,observerElevationInfo:n,observerFeatureInfo:o}=e;null==i.pending?this._onObserverPositionChange(t,i.geometry,n,o,!0):this._updatingHandles.addPromise(i.pending)}),m.nn)])}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this._computations),(e=>this._onComputationCollectionChange(e)),{initial:!0,final:!0})}_connectTargets(){return(0,_.AL)([this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(e=>this._onTargetCollectionChange(e)),{initial:!0,final:!0}),this._updatingHandles.add((()=>this.analysisViewData.cursorTarget),((e,t)=>{this._onCursorTargetChange(e,t)}))])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:i}=t;if(null==e||null==i)return!1;const n=ee;i.toRenderCoords(e,n);const o=t.state.camera.computeScreenPixelSizeAt(n);return Math.abs((o-this._screenPixelSize)/this._screenPixelSize)>$}_getEffectiveElevationInfo(e,t){return e.hasZ?null!==t&&void 0!==t?t:{mode:"absolute-height",offset:0}:{mode:"on-the-ground",offset:0}}};(0,n._)([(0,l.Cb)({constructOnly:!0})],K.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],K.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],K.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"updating",null),(0,n._)([(0,l.Cb)()],K.prototype,"priority",null),(0,n._)([(0,l.Cb)()],K.prototype,"updateOnCameraChange",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"_computations",null),(0,n._)([(0,l.Cb)()],K.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,n._)([(0,l.Cb)()],K.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"_effectiveObserverElevationMode",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"_observerFeatureId",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"_screenPixelSize",null),(0,n._)([(0,l.Cb)({readOnly:!0})],K.prototype,"_updatingHandles",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"_frameTask",void 0),(0,n._)([(0,l.Cb)()],K.prototype,"_isCameraDirty",null),K=(0,n._)([(0,d.j)(Q)],K);const $=.1,ee=(0,c.c)(),te=(0,I.Ue)(),ie=(0,T.cS)(),ne=.05;var oe=i(51995),re=i(97613),se=i(33985),ae=i(85981),le=i(64575),ue=i(86950);const de=new class{constructor(){this.glowWidth=8,this.innerWidth=.75}};const ce=new class{constructor(){this.size=.5}};function he(e){return(0,ue.Ch)(e.accentColor,.75)}const pe=new class{constructor(){this.size=.5,this.visibleColor=new oe.Z([3,252,111,.75]),this.occludedColor=new oe.Z([252,3,69,.75]),this.undefinedColor=new oe.Z([127,127,127,.75])}};const ve=new class{constructor(){this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new oe.Z([3,252,111,1]),this.visibleOuterColor=new oe.Z([3,252,111,.15]),this.occludedInnerColor=new oe.Z([252,3,69,1]),this.occludedOuterColor=new oe.Z([252,3,69,.1]),this.undefinedInnerColor=new oe.Z([255,255,255,1]),this.undefinedOuterColor=new oe.Z([127,127,127,.2])}};var ge=i(35284),_e=i(83639),be=i(40508);function ye(e,t){let i=null;const n=e.events.on("grab-changed",(n=>{null!=i&&(i.remove(),i=null),"start"===n.action?(i=e.disableDisplay(),t&&t(n)):t&&t(n)}));return(0,_.kB)((()=>{var e;null!==(e=i)&&void 0!==e&&e.remove(),n.remove()}))}var me=i(70619),Ce=i(99034);class fe extends ge.Z{constructor(e,t){const i=(0,_e.EA)(he(e.effectiveTheme)),n=(0,me.PI)(i,ce.size,32,32),o=new be.r(n);super({view:e,renderObjects:[o],metadata:t,elevationInfo:{mode:"absolute-height",offset:0}}),ye(this),this.themeHandle=(0,m.YP)((()=>({color:he(e.effectiveTheme)})),(e=>{i.setParameters(e)}))}destroy(){this.themeHandle.remove(),super.destroy()}}class we extends ge.Z{constructor(e,t){const{size:i,visibleColor:n,occludedColor:o,undefinedColor:r}=pe;super({view:e,renderObjects:[Oe(i,n,Ce.jg.Custom1),Oe(i,o,Ce.jg.Custom2),Oe(i,r,Ce.jg.Custom3)],metadata:t,elevationInfo:{mode:"absolute-height",offset:0}}),ye(this)}}function Oe(e,t,i){return new be.r((0,me.PI)((0,_e.EA)(oe.Z.toUnitRGBA(t)),e,32,32),i)}var Te,Ie=i(62389),Le=(i(84057),i(76365)),Pe=i(5693),Se=i(72612),Ve=i(63920);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Te||(Te={}));let Re=class extends Le.f{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.analysisViewData=null,this._latestPointerMovePointerType=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new g.Z,this._updatingHandles=new f.R,this._manipulatorHandles=new g.Z,this._targetTrackerManipulator=null}initialize(){this._intersector=new x({view:this.view}),this.addHandles((0,m.YP)((()=>this.state),(e=>{e===Te.Created&&this.finishToolCreation()}),m.tX)),this._observerManipulator=this._createObserverManipulator(),this._createLaserLine(),this.addHandles([this._updatingHandles.add((()=>{var e;return null===(e=this.analysisViewData)||void 0===e?void 0:e.elevationAlignedObserver}),(e=>this._onObserverLocationChange(e)),m.nn),this._updatingHandles.add((()=>function(e){const t=e.accentColor;return{glowColor:t,innerColor:(0,ue.mj)(t),globalAlpha:.75*t.a}}(this.view.effectiveTheme)),(e=>{let{glowColor:t,innerColor:i,globalAlpha:n}=e;return this._updateLaserLineStyle(t,i,n)}),m.nn),this._updatingHandles.add((()=>this._laserLineRendererDependencies()),(e=>this._updateLaserLineRenderer(e))),this._connectComputations(),this._updatingHandles.addWhen((()=>!this._shouldRenderTracker),(()=>this._clearCursorTracker()),m.nn)])}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles),this._manipulatorHandles=(0,a.SC)(this._manipulatorHandles),this._analysisHandles=(0,a.SC)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeLaserLine(),this._intersector=null,this._set("analysis",null)}get state(){var e;return this.active?this.hasGrabbedManipulators?Te.Created:Te.Creating:null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)?Te.Created:Te.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return null!=this.analysisViewData&&this.analysisViewData.updating||this._updatingHandles.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){var e;return this._showTracker&&null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)&&!this.hasGrabbedManipulators}continue(){this.view.activeTool=this}stop(){this.view.activeTool=null}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}onInputEvent(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}onInputEventAfter(e){"immediate-click"===e.type&&this._clickHandler(e)}onShow(){}onHide(){}onDeactivate(){this._clearCursorTracker()}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_connectComputation(e){if(this.destroyed)return void b.Z.getLogger(this).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const t=this._analysisHandles;if(t.has(e))return;const i=this._createTargetManipulator(e.target);null==this._targetTrackerManipulator&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),t.add([this._updatingHandles.add((()=>this._getLineOfSightManipulatorStateDependencies(e)),(()=>this._updateManipulatorState(i,e)),m.nn),this._updatingHandles.add((()=>e.elevationAlignedTargetLocation),(e=>this._onTargetLocationChange(e,i)),m.nn)],e)}_disconnectComputation(e){if(this.destroyed)return void b.Z.getLogger(this).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(e);const t=this._getTargetManipulator(e.target);null!=t&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),null!=this._targetTrackerManipulator&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}_clearCursorTracker(){this.analysisViewData.cursorTarget=(0,a.SC)(this.analysisViewData.cursorTarget)}_createTargetManipulator(e){const t={target:e,type:"target"},i=new we(this.view,t);return this._manipulatorHandles.add([this._createTargetManipulatorDragPipeline(i),i.events.on("grab-changed",(e=>this._manipulatorGrabChanged(i,e))),i.events.on("immediate-click",(e=>this._manipulatorClick(i,e)))],i),this.manipulators.add(i),null!=e.position?i.elevationAlignedLocation=e.position:i.available=!1,i}_getTargetManipulator(e){let t=null;return this.manipulators.forEach((i=>{const n=i.manipulator;null==t&&"target"===n.metadata.type&&n.metadata.target===e&&(t=n)})),t}_createObserverManipulator(){const e=new fe(this.view,{type:"observer",intersection:null});return this._manipulatorHandles.add([this._createObserverManipulatorDragPipeline(e),e.events.on("grab-changed",(t=>this._manipulatorGrabChanged(e,t))),e.events.on("immediate-click",(t=>this._manipulatorClick(e,t)))],e),this.manipulators.add(e),e}_screenToIntersection(){return e=>{const t=this._intersector.getScreenPointIntersection(e.screenEnd);return null==t?null:{...e,intersection:t}}}_createTargetManipulatorDragPipeline(e){return(0,Pe.Xd)(e,((t,i,n)=>{i.next(this._screenToIntersection()).next(this._updateTargetDragStep(e)).next((()=>this._updateLaserLineRenderer())),n.next(this._cancelTargetDragStep(e.metadata.target)).next((()=>this._updateLaserLineRenderer()))}))}_createObserverManipulatorDragPipeline(e){return(0,Pe.Xd)(e,((e,t,i)=>{t.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next((()=>this._updateLaserLineRenderer())),i.next(this._cancelObserverDragStep()).next((()=>this._updateLaserLineRenderer()))}))}_updateObserverDragStep(){return e=>(null!=e.intersection.mapPoint?(null==this.analysis.observer&&(this.analysis.observer=new re.Z),this._updateFromIntersection(this.analysis.observer,e.intersection)):this.analysis.observer=null,e)}_cancelObserverDragStep(){var e;const t=null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)?this.analysis.observer.clone():null;return e=>(this.analysis.observer=t,e)}_updateTargetDragStep(e){return t=>{this._updateFromIntersection(e.metadata.target,t.intersection);const i=t.intersection.mapPoint;return null!=i&&(e.elevationAlignedLocation=i),t}}_cancelTargetDragStep(e){var t;const i=null===(t=e.position)||void 0===t?void 0:t.clone();return t=>(e.position=i,t)}_manipulatorGrabChanged(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}_updateManipulatorState(e,t){const{isValid:i,isTargetVisible:n}=t.computationResult;e.state=i?n?Ce.jg.Custom1:Ce.jg.Custom2:Ce.jg.Custom3}_getLineOfSightManipulatorStateDependencies(e){const{isValid:t,isTargetVisible:i}=e.computationResult;return{isValid:t,isTargetVisible:i}}_laserLineRendererDependencies(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies();const{laserlineVisualElement:t,grabbedManipulator:i,shouldRenderTracker:n,observerPosition:o,visible:r}=e;if(null==t)return;const s=null!=i?i:n&&null!=o?this._targetTrackerManipulator:null;null!=s&&r?(t.visible=!0,t.heightManifoldTarget=s.renderLocation,s!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,ae.zk)(this._observerManipulator.renderLocation,s.renderLocation,Ee):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}_createLaserLine(){this._removeLaserLine();const{glowWidth:e,innerWidth:t}=de;this._laserlineVisualElement=new Ie.W({view:this.view,attached:!0,visible:this.visible,style:{glowWidth:e,innerWidth:t},isDecoration:!0})}_removeLaserLine(){null!=this._laserlineVisualElement&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}_updateLaserLineStyle(e,t,i){const n=this._laserlineVisualElement;if(null==n)return;const o=n.style;n.style={...o,glowColor:oe.Z.toUnitRGB(e),innerColor:oe.Z.toUnitRGB(t),globalAlpha:i}}_onObserverLocationChange(e){null!=e?(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e):this._observerManipulator.available=!1}_onTargetLocationChange(e,t){null!=e?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}_addPointFromClickEvent(e){var t;const i=this._intersector.getScreenPointIntersection(e);if(null!=(null===i||void 0===i?void 0:i.mapPoint))if(null!=(null===(t=this.analysis.observer)||void 0===t?void 0:t.position)){this._clearCursorTracker();const e=new se.Z;this._updateFromIntersection(e,i),this.analysis.targets.add(e)}else{const e=new re.Z;this._updateFromIntersection(e,i),this.analysis.observer=e}}_clickHandler(e){this.active&&e.button!==Ve.t.Right&&(this._addPointFromClickEvent((0,Se.vT)(e)),e.stopPropagation())}_doubleClickHandler(e){this.active&&e.button!==Ve.t.Right&&(this.stop(),e.stopPropagation())}_keyDownHandler(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}_pointerMoveHandler(e){var t;if(this.hasGrabbedManipulators)return;if(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),!this._showTracker||null==(null===(t=this.analysis.observer)||void 0===t?void 0:t.position))return;const i=(0,Se.vT)(e),n=this._intersector.getScreenPointIntersection(i);null!=(null===n||void 0===n?void 0:n.mapPoint)&&(null==this.analysisViewData.cursorTarget&&(this.analysisViewData.cursorTarget=new se.Z),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}_updateFromIntersection(e,t){if(null==t.mapPoint)return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case F.q7.OBJECT:if(null!=t.graphic){const i=t.graphic,n=(0,L.RL)(i);"on-the-ground"===n.mode&&(n.mode="relative-to-ground",n.offset=0),e.elevationInfo=new le.Z(n),e.feature=i}else e.elevationInfo=null,e.feature=null;break;case F.q7.TERRAIN:case F.q7.I3S:e.elevationInfo=new le.Z({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}const i=t.mapPoint.clone();i.z=(0,L.vQ)(this.view,i,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=i}_manipulatorClick(e,t){if("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==Ve.t.Right||this.analysis.targets.length<=1)return;const{target:i}=e.metadata;this.analysis.targets.remove(i),t.stopPropagation()}get testInfo(){return{laserLineVisualElement:this._laserlineVisualElement,getTargetManipulator:e=>this._getTargetManipulator(e)}}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Re.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Re.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Re.prototype,"state",null),(0,n._)([(0,l.Cb)({readOnly:!0})],Re.prototype,"cursor",null),(0,n._)([(0,l.Cb)()],Re.prototype,"removeIncompleteOnCancel",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Re.prototype,"updating",null),(0,n._)([(0,l.Cb)({constructOnly:!0})],Re.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Re.prototype,"_showTracker",null),(0,n._)([(0,l.Cb)()],Re.prototype,"_latestPointerMovePointerType",void 0),(0,n._)([(0,l.Cb)()],Re.prototype,"_shouldRenderTracker",null),(0,n._)([(0,l.Cb)()],Re.prototype,"_laserlineVisualElement",void 0),(0,n._)([(0,l.Cb)()],Re.prototype,"_grabbedManipulator",void 0),Re=(0,n._)([(0,d.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],Re);const Ee=(0,ae.Ue)();var Ae=i(81949);class He{constructor(e,t,i,n){this.visibleLineVisualElement=e,this.occludedLineVisualElement=t,this.undefinedLineVisualElement=i,this.targetVisualElement=n}destroy(){this.visibleLineVisualElement.destroy(),this.occludedLineVisualElement.destroy(),this.undefinedLineVisualElement.destroy(),this.targetVisualElement.destroy()}}var De=i(33837),ke=i(66730),Me=i(56529);let je=class extends o.Z{constructor(e){super(e),this._lineOfSightVisualElements=new Array,this._computationHandles=new g.Z,this._updatingHandles=new f.R}initialize(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles),this._computationHandles=(0,a.SC)(this._computationHandles),this._observerVisualElement=(0,a.SC)(this._observerVisualElement)}get visible(){return this.analysisViewData.visible}get updating(){return this._updatingHandles.updating}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get test(){return{disablePartialOcclusion:()=>{for(const e of this._lineOfSightVisualElements)e.visibleLineVisualElement.renderOccluded=Me.yD.Occlude,e.occludedLineVisualElement.renderOccluded=Me.yD.Occlude,e.undefinedLineVisualElement.renderOccluded=Me.yD.Occlude},visualizations:this._lineOfSightVisualElements}}_createLineOfSightVisualization(){const e=ve,t=this.view,i=this.isDecoration,n={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth,isDecoration:i},o=oe.Z.toUnitRGBA(e.visibleOuterColor),r=oe.Z.toUnitRGBA(e.visibleInnerColor),s=oe.Z.toUnitRGBA(e.occludedOuterColor),a=oe.Z.toUnitRGBA(e.occludedInnerColor),l=oe.Z.toUnitRGBA(e.undefinedOuterColor),u=oe.Z.toUnitRGBA(e.undefinedInnerColor),d=new De.r({...n,color:o,innerColor:r}),c=new De.r({...n,color:s,innerColor:a}),h=new De.r({...n,color:l,innerColor:u}),p=new ke.L({view:t,attached:!0,...Ze,size:8,isDecoration:i}),v=new He(d,c,h,p);return this._lineOfSightVisualElements.push(v),v}_destroyLineOfSightVisualization(e){e.destroy(),this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(e),1)}_updateLineOfSightVisualization(e,t,i){const n=ve,{computationResult:o,inputPoints:r}=e,{start:s,end:a,intersection:l,isValid:u,isTargetVisible:d}=o,{observer:h}=r,p=Ge;p[12]=h[0],p[13]=h[1],p[14]=h[2];const v=(0,C.f)(Fe,s,h),g=(0,C.f)(ze,a,h),_=(0,C.f)(xe,l,h),{visibleLineVisualElement:b,occludedLineVisualElement:y,undefinedLineVisualElement:m,targetVisualElement:f}=t,w=null==this.analysisViewData.elevationAlignedObserver||null==e.elevationAlignedTargetLocation,O=this.visible&&!w;b.visible=O,y.visible=O,m.visible=O,f.visible=O,f.attached=!i.interactiveAndEditable,O&&(b.geometry=null,y.geometry=null,m.geometry=null,f.geometry=e.elevationAlignedTargetLocation,u?d?(b.geometry=[[(0,c.e)(v),(0,c.e)(g)]],b.transform=p,b.color=oe.Z.toUnitRGBA(n.visibleOuterColor),f.color=oe.Z.toUnitRGBA(n.visibleInnerColor)):(b.geometry=[[(0,c.e)(v),(0,c.e)(_)]],b.transform=p,b.color=oe.Z.toUnitRGBA(n.occludedOuterColor),y.geometry=[[(0,c.e)(_),(0,c.e)(g)]],y.transform=p,f.color=oe.Z.toUnitRGBA(n.occludedInnerColor)):(m.geometry=[[(0,c.e)(v),(0,c.e)(g)]],m.transform=p,f.color=oe.Z.toUnitRGBA(n.undefinedInnerColor)))}_getLineOfSightVisualizationDependencies(e){const{computationResult:t}=e,{occludedOuterColor:i,visibleOuterColor:n}=ve;return{computationResult:t,occludedOuterColor:i,visibleOuterColor:n,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(e){const t=this._computationHandles;if(t.has(e))return;const i=this._createLineOfSightVisualization();t.add([this._updatingHandles.add((()=>this._getLineOfSightVisualizationDependencies(e)),(t=>this._updateLineOfSightVisualization(e,i,t)),{initial:!0,equals:()=>!1}),(0,_.kB)((()=>this._destroyLineOfSightVisualization(i)))],e)}_disconnectComputation(e){this._computationHandles.remove(e)}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_createObserverVisualization(){const e=oe.Z.toUnitRGBA(ve.visibleInnerColor),t=new ke.L({view:this.view,color:e,...Ze,isDecoration:this.isDecoration});this._observerVisualElement=t,this.addHandles(this._updatingHandles.add((()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible})),(e=>{let{observer:i,interactiveAndEditable:n,visible:o}=e;null!=i&&!n&&o?(t.geometry=i,this._observerVisualElement.attached=!0):t.attached=!1}),m.nn))}};(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"view",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],je.prototype,"visible",null),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"isDecoration",void 0),(0,n._)([(0,l.Cb)()],je.prototype,"updating",null),(0,n._)([(0,l.Cb)()],je.prototype,"interactiveAndEditable",null),(0,n._)([(0,l.Cb)()],je.prototype,"test",null),je=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],je);const Ze={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},Fe=(0,c.c)(),ze=(0,c.c)(),xe=(0,c.c)(),Ge=(0,Ae.a)();var Be=i(70209);let Ne=class extends((0,h.p)(s.Z.EventedMixin(o.Z))){constructor(e){super(e),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new r.Z,this.elevationAlignedObserver=null,this.observerEngineLocation=(0,c.c)(),this.cursorTarget=null,this.editable=!0}initialize(){const e=this.view,t=this.analysis;this._analysisController=new K({analysis:t,analysisViewData:this,view:e}),this._analysisVisualization=new je({analysis:t,analysisViewData:this,view:e,isDecoration:!this.parent}),this.addHandles([this._analysisController.on("result-changed",(e=>{e.target!==this.cursorTarget&&this.emit("result-changed",e)})),(0,Be.Lp)(this,Re)])}destroy(){(0,Be.Yq)(this),this._analysisController=(0,a.SC)(this._analysisController),this._analysisVisualization=(0,a.SC)(this._analysisVisualization)}get results(){return this.computations.map((e=>e.result))}get priority(){return this._analysisController.priority}set priority(e){this._analysisController.priority=e}get updating(){return null!=this._analysisController&&this._analysisController.updating||null!=this._analysisVisualization&&this._analysisVisualization.updating}getResultForTarget(e){var t;return null===(t=this.computations.find((t=>t.target===e)))||void 0===t?void 0:t.result}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}};(0,n._)([(0,l.Cb)({readOnly:!0})],Ne.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ne.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"tool",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ne.prototype,"results",null),(0,n._)([(0,l.Cb)()],Ne.prototype,"priority",null),(0,n._)([(0,l.Cb)()],Ne.prototype,"computations",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"elevationAlignedObserver",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"observerEngineLocation",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"cursorTarget",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"updating",null),(0,n._)([(0,l.Cb)()],Ne.prototype,"editable",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"_analysisController",void 0),(0,n._)([(0,l.Cb)()],Ne.prototype,"_analysisVisualization",void 0),Ne=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Ne);const Ue=Ne}}]);
//# sourceMappingURL=4664.6aa90da6.chunk.js.map